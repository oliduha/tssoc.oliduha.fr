<!DOCTYPE html>
<html lang="fr" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="description" content="Docs formation Cefim TSSR">
    <meta name="author" content="Olivier Duhamel">
    <title>S√©curiser les acc√®s √† Internet - TSSOC</title>
    <link href="https://www.tssoc.oliduha.fr/at2/at2e2/index.html" rel="canonical" type="text/html" title="S√©curiser les acc√®s √† Internet - TSSOC">
    <link href="../../at2/at2e2/index.xml" rel="alternate" type="application/rss+xml" title="S√©curiser les acc√®s √† Internet - TSSOC">
    <link href="../../images/logo.svg" rel="icon" type="image/svg+xml">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="../../css/fontawesome-all.min.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fontawesome-all.min.css" rel="stylesheet"></noscript>
    <link href="../../css/nucleus.css" rel="stylesheet">
    <link href="../../css/auto-complete.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/auto-complete.css" rel="stylesheet"></noscript>
    <link href="../../css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="../../css/fonts.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fonts.css" rel="stylesheet"></noscript>
    <link href="../../css/theme.css" rel="stylesheet">
    <link href="../../css/theme-auto.css" rel="stylesheet" id="variant-style">
    <link href="../../css/variant.css" rel="stylesheet">
    <link href="../../css/print.css" rel="stylesheet" media="print">
    <link href="../../css/format-print.css" rel="stylesheet">
    <link href="../../css/ie.css" rel="stylesheet">
    <script src="../../js/url.js"></script>
    <script src="../../js/variant.js"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="../../index.search.js";
      var root_url="../../";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copier dans le presse-papiers';
      window.T_Copied_to_clipboard = 'Copi√© dans le presse-papiers !';
      window.T_Copy_link_to_clipboard = 'Copier le lien dans le presse-papiers';
      window.T_Link_copied_to_clipboard = 'Lien copi√© dans le presse-papiers !';
      window.T_No_results_found = 'Aucun r√©sultat trouv√© pour \u0022{0}\u0022';
      window.T_N_results_found = '{1} r√©sultats trouv√©s pour \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/www.tssoc.oliduha.fr/';
      window.variants && variants.init( [ 'auto', 'relearn-bright', 'relearn-light', 'relearn-dark', 'learn', 'neon', 'blue', 'green', 'red' ] );
    </script>
    <style>
      #body img.bg-white {
        background-color: white;
      }
    </style>
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../at2/at2e2/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../index.html"><span itemprop="name">TSSOC</span></a><meta itemprop="position" content="1"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../at2/index.html"><span itemprop="name">Maintenir, exploiter et s√©curiser une infrastructure centralis√©e</span></a><meta itemprop="position" content="2"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">S√©curiser les acc√®s √† Internet</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable chapter narrow" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="chapter">
<div class="article-subheading">Chapitre 2</div>
<h1 id="s√©curiser-les-acc√®s-√†-internet">S√©curiser les acc√®s √† Internet</h1>

<hr>
<h4 id="1-stage-cefimat2at2e2stage-cefim">1. <a href="../../at2/at2e2/stage-cefim/">Stage Cefim</a></h4>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Sous-sections de S√©curiser les acc√®s √† Internet</h1>
          <article class="chapter">
<div class="article-subheading">Exemple 1</div>
<h1 id="stage-cefim">Stage Cefim</h1>

<h2 id="automatisation-vouchers-cefim_pedago"><strong>Automatisation vouchers CEFIM_PEDAGO</strong></h2>
<p><em><strong>Les vouchers sont des codes d&rsquo;acc√®s temporaires √† un r√©seau WiFi s√©curis√©.</strong></em></p>
<hr>
<h2 id="mission-initiale">Mission initiale</h2>
<p>Simplifier l&rsquo;extraction de vouchers pour connexion au r√©seau WiFi CEFIM_PEDAGO des utilisateurs apportant leur propre mat√©riel (ordinateur, tablette, smartphone).</p>
<hr>
<h2 id="contexte">Contexte</h2>
<p>Dans les locaux du CEFIM, le r√©seau WiFi CEFIM_PEDAGO est utilis√© par la majorit√© des √©tudiants, formateurs, intervenants ext√©rieurs et jurys.</p>
<p>L&rsquo;acc√®s courant au r√©seau est autoris√© par un syst√®me de filtrage MAC au niveau du portail captif de la passerelle/pare-feu (pfSense).
Les adresses MAC des machines CEFIM (pc/mac) fournies aux √©tudiants et formateurs internes sont enregistr√©es dans la configuration du portail captif.</p>
<p>Pour autoriser la connexion d&rsquo;une machine inconnue, un syst√®me d&rsquo;authentification par vouchers est mis en place au niveau du portail captif.
Il s&rsquo;agit de s√©ries (appel√©es Rolls) de codes d&rsquo;acc√®s temporaires g√©n√©r√©s manuellement dans l&rsquo;interface web du pfSense (menu &lsquo;Services&rsquo; &gt; &lsquo;Captive Portal&rsquo; &gt; &lsquo;Edit Zone&rsquo; &gt; &lsquo;Vouchers&rsquo;).</p>
<p>En g√©n√©ral, une s√©rie de 1000 vouchers valides pendant cinq jours est g√©n√©r√©e par l&rsquo;administrateur quand la s√©rie pr√©c√©dente arrive √† √©puisement.
La s√©rie g√©n√©r√©e est t√©l√©charg√©e depuis l&rsquo;interface web du pfSense au format .csv puis import√©e dans un google sheet partag√©.</p>
<p>Lorsqu&rsquo;un groupe d&rsquo;utilisateurs a besoin de se connecter temporairement √† Internet avec des machines non connues du portail captif, il faut lui fournir une liste de vouchers (1 par personne).
Pour cela, un op√©rateur doit renseigner les divers √©l√©ments du tableau (le statut r√©serv√©, son nom, la date et le nom du groupe ou de la personne) pour chaque voucher, puis copier le nombre de codes souhait√©s depuis le tableau partag√© et les coller dans un autre document (tableur ou texte) qu&rsquo;il doit ensuite imprimer.
L&rsquo;utilisateur final peut ainsi se connecter au r√©seau en renseignant le voucher qui lui est fourni lorsque le portail captif lui demande.</p>
<hr>
<h2 id="probl√®mes-relev√©s">Probl√®mes relev√©s</h2>
<ol>
<li>Plusieurs manipulations sont n√©cessaires pour imprimer les vouchers.</li>
<li>Les op√©rateurs n&rsquo;utilisent pas toujours des codes contigus dans la liste, rendant parfois encore plus fastidieuses les extractions ult√©rieures.</li>
<li>L&rsquo;administrateur doit surveiller l&rsquo;√©volution de l&rsquo;utilisation de la liste de vouchers afin d&rsquo;en g√©n√©rer de nouveau lorsqu&rsquo;elle arrive √† √©puisement.</li>
<li>Les vouchers sont le plus souvent attribu√©s √† des groupes d&rsquo;utilisateurs. Une fois la formation termin√©e il n&rsquo;y a aucun moyen de relier un utilisateur au code de connexion utilis√©, ce qui repr√©sente un risque l√©gal.</li>
<li>Une partie des vouchers n&rsquo;a pas √©t√© utilis√©e une fois la formation termin√©e, ce qui repr√©sente un autre risque car ces codes se retrouvent alors &ldquo;dans la nature&rdquo;.</li>
</ol>
<hr>
<h2 id="objectifs-fonctionnels">Objectifs fonctionnels</h2>
<ul>
<li>Simplifier et rationaliser le syst√®me.</li>
<li>Avertir l&rsquo;administrateur lorsque la liste de vouchers atteint un seuil critique.</li>
<li>Relier les utilisateurs aux vouchers qu&rsquo;ils ont utilis√©.</li>
<li>Invalider les vouchers non utilis√©s.</li>
</ul>
<hr>
<h2 id="solution-envisag√©e">Solution envisag√©e</h2>
<p>D√©velopper un script &lsquo;Apps Script&rsquo; (le langage de script Google Workspace - une version de javascript sp√©cifiquement d√©velopp√©e par Google) qui devra :</p>
<ul>
<li>Afficher un formulaire simplifiant la saisie des informations n√©cessaires √† l&rsquo;extraction par les op√©rateurs.</li>
<li>Extraire et r√©server le nombre de vouchers n√©cessaires de la liste.</li>
<li>Cr√©er un Google Document pr√©sentant les vouchers mis en page, pr√™t √† √™tre imprim√©.</li>
<li>Envoyer un email d&rsquo;alerte √† l&rsquo;administrateur lorsque la liste de vouchers disponibles arrive √† √©puisement.</li>
</ul>
<p>Fonctionnalit√© suppl√©mentaire : Disposer d&rsquo;une liste de secours afin de simplifier l&rsquo;ajout de vouchers par l&rsquo;admin s&rsquo;il n&rsquo;est pas pr√©sent sur site (en cong√©s, en d√©placement, etc.) lorsque la liste courante arrive √† √©puisement.</p>
<p>L&rsquo;invalidation des vouchers non utilis√©s n&rsquo;est possible que par l&rsquo;interm√©diaire de l&rsquo;interface web du pfSense et donc rel√®ve de la responsabilit√© de l&rsquo;administrateur. Il faut simplement int√©grer cette op√©ration dans une proc√©dure de maintenance.</p>
<hr>
<h2 id="pr√©requis">Pr√©requis</h2>
<p>Arborescence Google Drive :</p>
<ul>
<li>1 dossier principal Google Drive partag√© avec :
<ul>
<li>1 sous-dossier accessible uniquement par l&rsquo;administrateur.</li>
<li>1 sous-dossier partag√©</li>
</ul>
</li>
</ul>
<p>Documents Google :</p>
<ul>
<li>1 Google Sheet dans le dossier principal contenant la liste courante de vouchers disponibles. Le partage de ce fichier doit √™tre nominatif (l&rsquo;acc√®s n√©cessite une connection aux services Google). Il contiendra :
<ul>
<li>1 feuille de calcul pour la liste des vouchers disponible.</li>
<li>1 feuille de calcul pour la liste des vouchers utilis√©s.</li>
<li>1 feuille de calcul masqu√©e contenant les param√®tres g√©n√©raux des scripts :
<ul>
<li>L&rsquo;Id du mod√®le de document.</li>
<li>L&rsquo;Id du sous-dossier contenant les documents g√©n√©r√©s.</li>
<li>L&rsquo;adresse email de l&rsquo;administrateur.</li>
<li>Le seuil d&rsquo;alerte.</li>
</ul>
</li>
</ul>
</li>
<li>1 mod√®le Google Document dans le dossier principal pour impression des vouchers sur demande contenant :
<ul>
<li>Le logo du CEFIM.</li>
<li>1 emplacement pour le nom du groupe ou de la personne.</li>
<li>1 emplacement pour la date.</li>
<li>1 tableau sur 2 colonnes avec :
<ul>
<li>1 ligne de titres</li>
<li>25 lignes avec chacune 1 emplacement pour un voucher dans la 1√®re colonne et 1 cellule vide pour recevoir les nom et pr√©nom de l&rsquo;utilisateur dans la 2√®me colonne.</li>
</ul>
</li>
<li>Un message &ldquo;Bonne formation&rdquo; sous le tableau.</li>
</ul>
</li>
<li>1 Google Sheet dans le dossier priv√© contenant la liste des vouchers de secours.</li>
</ul>
<hr>
<h2 id="mise-en-oeuvre">Mise en oeuvre</h2>
<h3 id="c√¥t√©-serveur">C√¥t√© serveur</h3>
<p>Un script serveur attach√© √† la liste courante qui impl√©mente les fonctionnalit√©s suivantes :</p>
<ul>
<li>Ajout d&rsquo;un menu permettant d&rsquo;afficher le formulaire de demande de vouchers.</li>
<li>Ajout d&rsquo;un d√©clencheur personnalis√© affichant le formulaire √† l&rsquo;ouverture de la feuille de calcul.</li>
<li>Le formulaire est affich√© de mani√®re modale.</li>
<li>Post-traitement du formulaire :
<ul>
<li>R√©cup√©ration des donn√©es saisies.</li>
<li>R√©cup√©ration de l&rsquo;adresse email de l&rsquo;op√©rateur.</li>
<li>Extraction du nombre de vouchers demand√©s vers une autre feuille de calcul avec les infos de r√©servation.</li>
<li>Mise en forme des donn√©es d√©plac√©es.</li>
<li>Cr√©ation d&rsquo;un Google Document √† partir d&rsquo;un mod√®le.</li>
<li>Insertion des donn√©es dans le Document.</li>
<li>Suppression des √©l√©ments inutiles.</li>
<li>Enregistrement du Document dans un sous-dossier sp√©cifique du Drive.</li>
<li>Affichage du lien vers le Document g√©n√©r√©.</li>
</ul>
</li>
<li>Envoi d&rsquo;un email d&rsquo;alerte √† l&rsquo;administrateur lorsque le nombre de vouchers disponibles est en dessous du seuil d√©fini, avec :
<ul>
<li>1 lien vers l&rsquo;interface web du pfSense pour g√©n√©rer un nouveau roll.</li>
<li>1 lien pour ouvrir la liste de secours.</li>
<li>1 lien vers la liste courante.</li>
</ul>
</li>
</ul>
<p>Un script serveur attach√© √† la liste de secours qui impl√©mente ces fonctionnalit√©s :</p>
<ul>
<li>Ajout d&rsquo;un menu permettant de lancer la proc√©dure d&rsquo;ajout de vouchers de secours √† la liste courante.</li>
<li>Le chargement de la configuration contenue dans une feuille sp√©cifique du classeur.</li>
<li>La proc√©dure d&rsquo;ajout de vouchers de secours √† la liste courante avec demande de confirmation pr√©alable et gestion des erreurs (authentification, ouverture de fichier).</li>
<li>Envoi d&rsquo;un email indiquant le succ√®s ou l&rsquo;√©chec √©ventuel de l&rsquo;op√©ration ainsi que le nombre de vouchers de secours restants.</li>
</ul>
<h3 id="cot√©-client">Cot√© client</h3>
<p>Un fichier html contenant le formulaire de r√©servation de vouchers avec :</p>
<ul>
<li>1 champ pour renseigner le nom du ou des destinataires (groupe ou personne).</li>
<li>1 champ pour la date.</li>
<li>1 champ pour le nombre de vouchers √† r√©server.</li>
<li>Formatage CSS :
<ul>
<li>Mise en page g√©n√©rale.</li>
<li>Indication des champs requis.</li>
</ul>
</li>
<li>Javascript :
<ul>
<li>Validation des donn√©es saisies pour √©viter les erreurs, avec retour visuel.</li>
<li>Indication de chargement.</li>
<li>D√©clenchement du script serveur suite √† la validation du formulaire.</li>
</ul>
</li>
</ul>
<p>Un fichier Html d&rsquo;indication de chargement comportant :</p>
<ul>
<li>1 titre</li>
<li>1 gif anim√© h√©berg√© sur le Google Drive partag√©</li>
</ul>
<hr>
<h2 id="utilisation">Utilisation</h2>
<h3 id="par-les-op√©rateurs">Par les op√©rateurs</h3>
<p>√Ä l&rsquo;ouverture du Google Sheet partag√© contenant la liste des vouchers disponibles, un script est automatiquement ex√©cut√©. Il ajoute une entr√©e de menu et affiche le formulaire permettant de saisir les informations n√©cessaires √† la r√©servation de vouchers :</p>
<ul>
<li>Un nom de groupe ou personne.</li>
<li>La date de d√©but de formation.</li>
<li>Le nombre de vouchers √† r√©server.</li>
</ul>
<p>L&rsquo;op√©rateur √©tant connect√© pour avoir acc√®s au document, son adresse email est automatiquement r√©cup√©r√©e par le script.</p>
<p>Une fois le formulaire correctement renseign√© (les donn√©es saisies sont v√©rifi√©es) le script d√©place le nombre de vouchers r√©serv√©s dans une autre feuille o√π sont √©galement renseign√©s les informations propres √† la r√©servation, puis g√©n√®re une copie du mod√®le Google Document en y ins√©rant le nom du groupe, la date et la liste de vouchers r√©serv√©s.</p>
<p>Une boite de dialogue affichant le lien vers le document g√©n√©r√© est alors pr√©sent√©e √† l&rsquo;op√©rateur. En suivant ce lien le document s&rsquo;ouvre dans un nouvel onglet de son navigateur, il peut directement l&rsquo;imprimer ou le modifier au pr√©alable si besoin (par ex. : renseigner la colonne des noms d&rsquo;utilisateurs si connus par l&rsquo;op√©rateur). Si non remplis avant impression, les utilisateurs devront renseigner leur nom et pr√©nom en regard du voucher utilis√©.</p>
<p>Une fois le tableau rempli et r√©cup√©r√©, l&rsquo;op√©rateur devra reporter ces renseignements dans le tableau des vouchers utilis√©s. Pour se conformer √† la l√©gislation, ces donn√©es devront √™tre conserv√©es pendant une dur√©e minimum d'1 an.</p>
<h3 id="par-ladministrateur">Par l&rsquo;administrateur</h3>
<p>L&rsquo;administrateur g√©n√®re un roll initial de 1000 vouchers ayants une dur√©e de validit√© de 5 jours.</p>
<p>Lorsque le nombre de vouchers disponible atteint le seuil minimal, il re√ßoit un email d&rsquo;alerte lui indiquant le nombre de vouchers disponibles restant et lui pr√©sentant :</p>
<ul>
<li>Un lien vers l&rsquo;interface web du pfSense (adresse ip publique accessible de l&rsquo;ext√©rieur).</li>
<li>Un lien vers le Google Sheet contenant les vouchers de secours pour un ajout rapide.</li>
<li>Un lien vers la liste courante pour v√©rification.</li>
</ul>
<p>S&rsquo;il d√©cide d&rsquo;activer des vouchers de secours, un menu ou un bouton lui permettent d&rsquo;ajouter 100 vouchers de secours √† la liste courante. Il peut r√©p√©ter l&rsquo;op√©ration jusqu&rsquo;√† √©puisement de la liste de secours. Un email de confirmation (ou d&rsquo;erreur) lui est automatiquement envoy√© √† chaque ajout lui indiquant le succ√®s (ou l&rsquo;√©chec le cas √©ch√©ant) de l&rsquo;op√©ration ainsi que le nombre de vouchers de secours restants.</p>
<p>Ensuite, lorsque son emploi du temps lui permettra, il devra g√©n√©rer un nouveau roll de vouchers par le biais de l&rsquo;interface web du pfSense et les ajouter √† la liste courante. Il devra √©galement s&rsquo;assurer de disposer d&rsquo;un nombre suffisant de vouchers de secours en cas de besoin.</p>
<hr>
<h2 id="mise-en-production">Mise en production</h2>
<p>Le document Google Sheet contenant la liste courante de voucher doit √™tre stock√© dans un dossier principal Google Drive (&lsquo;CEFIM_PEDAGO&rsquo;). Ce document doit √™tre partag√© nominativement (utiliser le partage &ldquo;Limit√©&rdquo;) en renseignant une adresse email pour chaque collaborateur devant avoir un acc√®s √† cette liste. Ceci est n√©cessaire pour pouvoir r√©cup√©rer automatiquement son adresse email via le script. Ce document comportera 3 feuilles de calcul :</p>
<ul>
<li>1 feuille nomm√©e <strong>&ldquo;Vouchers&rdquo;</strong> contenant la liste des vouchers disponibles.</li>
<li>1 feuille nomm√©e <strong>&ldquo;Utilis√©s&rdquo;</strong> contenant la liste des vouchers r√©serv√©s.</li>
<li>1 feuille nomm√©e <strong>&ldquo;Config&rdquo;</strong> (masqu√©e) contenant les param√®tres des scripts.</li>
</ul>
<p>Le mod√®le Google Document sera h√©berg√© dans le dossier principal avec la liste courante et pourra √™tre partag√© de mani√®re plus permissive (option de partage &ldquo;Tous les utilisateurs qui ont le lien&rdquo;).</p>
<p>Le document Google Sheet contenant les vouchers de secours doit √™tre, quant-√†-lui, stock√© dans un sous dossier priv√© (&lsquo;PRIVATE&rsquo;) du dossier principal et n&rsquo;√™tre accessible que par l&rsquo;administrateur en charge de la g√©n√©ration des rolls de vouchers (d√©tenant un acc√®s au pfSense). Il ne comportera qu&rsquo;une seule feuille nomm√©e <strong>&ldquo;Liste_Secours&rdquo;</strong>.</p>
<p><strong>Important : Bien respecter les noms des feuilles de calcul pour les 2 Google Sheet tels qu&rsquo;indiqu√©s ci-dessus en gras : Les scripts s&rsquo;appuient sur ces noms de feuille.</strong></p>
<h3 id="partages">Partages</h3>
<ul>
<li>Dossier principal &lsquo;CEFIM_PEDAGO&rsquo; : Tous les utilisateurs qui ont le lien</li>
<li>Sous-dossier &lsquo;DOCS&rsquo; : Tous les utilisateurs qui ont le lien</li>
<li>Sous-dossier &lsquo;PRIVATE&rsquo; : Non partag√©</li>
<li>Google Sheet &lsquo;Vouchers_CEFIM_PEDAGO&rsquo; : Partage limit√©</li>
<li>Google Document &lsquo;Template_Vouchers_CEFIM_PEAGO&rsquo; : Tous les utilisateurs qui ont le lien</li>
<li>Google Sheet &lsquo;Vouchers_CEFIM_PEDAGO_SECOURS&rsquo; : Non partag√©</li>
</ul>
<hr>
<h2 id="am√©liorations-ult√©rieures-√©ventuelles">Am√©liorations ult√©rieures √©ventuelles</h2>
<ul>
<li>
<p>Cr√©ation et gestion de plusieurs rolls avec des dur√©es de validit√© diff√©rentes (1/2 journ√©e - 1 jour - 2 jours - 3 jours - 4 jours - 1 semaine - 2 semaines - 1 mois) pour correspondre aux dur√©es des diff√©rentes formations dispens√©es. Autant de rolls de secours devront √™tre pr√©vus.</p>
</li>
<li>
<p>Dans le cas o√π l&rsquo;op√©rateur renseigne les noms/pr√©noms des utilisateurs avant impression, disposer d&rsquo;un script attach√© au document permettant de reporter automatiquement ces infos dans le tableau des vouchers utilis√©s.</p>
</li>
<li>
<p>Export des vouchers r√©serv√©s √† l&rsquo;issue de chaque formation afin d&rsquo;en faciliter la v√©rification (s&rsquo;ils ont √©t√© utilis√©s ou non) ou l&rsquo;invalidation (interface web du pfSense dans les 2 cas).</p>
</li>
</ul>
<hr>
<h2 id="annexes">Annexes</h2>
<h3 id="caract√©ristiques-des-rolls-de-vouchers">Caract√©ristiques des rolls de vouchers</h3>
<ul>
<li>Ils comportent un num√©ro unique parmi les rolls actifs.</li>
<li>On leur affecte un nombre de vouchers (1023 maximum avec le nombre de bits de ticket par d√©faut).</li>
<li>On leur d√©finit une dur√©e de validit√© en heures.</li>
<li>Une description leur est associ√©e.</li>
</ul>
<p><strong>Attention : Tout changement dans les champs de nombre de bits (roll, ticket ou somme de contr√¥le - voir ci-apr√®s) invalide imm√©diatement tout roll cr√©√© pr√©c√©demment.</strong></p>
<h3 id="caract√©ristiques-g√©n√©rales-des-vouchers-pfsense">Caract√©ristiques g√©n√©rales des vouchers pfSense</h3>
<blockquote>
<p><em>Le texte en italique ci-dessous est une traduction de la documentation officielle.</em></p>
</blockquote>
<ul>
<li>Cl√©s RSA : <code>64 bits maximum</code> (32 bits par d√©faut).</li>
<li>Jeu de caract√®res (utilis√© pour la cr√©ation des vouchers) : <code>2345678abcdefhijkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ</code> (par d√©faut - les caract√®res pouvant pr√™ter √† confusion sont retir√©s).</li>
</ul>
<p>Bits des vouchers : <em>Les champs de bits suivants contr√¥lent la mani√®re dont les vouchers sont g√©n√©r√© par le portail. Il est recommand√© d&rsquo;utiliser les valeurs par d√©faut mais celles-ci peuvent √™tre ajust√©es si n√©cessaire. Le total de tous les champs de bits doit √™tre inf√©rieur au nombre de bits de la cl√© RSA (exemple avec les valeurs par d√©faut : 16 + 10 + 5 = 31 =&gt; 32 - 1).</em></p>
<ul>
<li>Bits de roll : [1-31], d√©faut : <code>16</code> =&gt; d√©finit le nombre maximum de rolls actifs simultan√©ment = 65535 avec 16 bits (2^16 - 1, d√©faut).</li>
<li>Bits de ticket : [1-16], d√©faut : <code>10</code> =&gt; d√©finit le nombre maximum de vouchers par roll = 1023 avec 10 bits (2^10 - 1, d√©faut).</li>
<li>Bits de somme de contr√¥le : [0-31], d√©faut : <code>5</code> =&gt; bits de contr√¥le d&rsquo;int√©grit√©.</li>
</ul>
<p><em>Le &rsquo;nombre magique&rsquo; est pr√©sent dans chaque voucher et est v√©rifi√© par le portail lors de la v√©rification du voucher. La taille du nombre magique d√©pend du nombre de bits restant apr√®s avoir additionn√© les bits de roll, voucher et somme de contr√¥le. S&rsquo;il ne reste aucun bit disponible, le nombre magique n&rsquo;est pas utilis√©.</em></p>
<p>Les deux derniers champs de la page de configuration permettent de personnaliser les messages d&rsquo;erreur en cas de tentative de connexion avec un code invalide ou avec un code expir√©.</p>
<p>En r√©sum√© : Pour augmenter le nombre maximum de vouchers g√©n√©r√©s par roll il faut augmenter le nombre de bits de ticket tout en diminuant d&rsquo;autant le nombre de bits de roll (en cons√©quence les vouchers g√©n√©r√©s comporteront davantage de caract√®res).</p>
<h3 id="caract√©ristiques-des-vouchers-pour-cefim_pedago">Caract√©ristiques des vouchers pour CEFIM_PEDAGO</h3>
<ul>
<li>G√©n√©r√©s par roll de 1000 vouchers.</li>
<li>Dur√©e de validit√© de 5 jours √† compter du moment d&rsquo;activation par l&rsquo;utilisateur.</li>
</ul>
<p>Les options suivantes conservent les valeurs par d√©faut :</p>
<ul>
<li>Cl√©s RSA de 32 Bit (Public/Private).</li>
<li>Jeu de caract√®res : 2345678abcdefhijkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ</li>
<li>Bits de roll : 16</li>
<li>Bits de tickets : 10</li>
<li>Bits de somme de contr√¥le : 5</li>
<li>Nombre magique √† 10 chiffres.</li>
</ul>
<hr>
<h3 id="captures-d√©crans">Captures d&rsquo;√©crans</h3>
<ul>
<li>Le formulaire de r√©servation :</li>
</ul>
<p>
<a href="#image-1e83b01ad60228dee135e0b13a331ed0" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/01-Furmulaire%20r%C3%A9servation.png" alt="Formulaire de r√©servation" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1e83b01ad60228dee135e0b13a331ed0">
<img src="../../at2/at2e2/stage-cefim/01-Furmulaire%20r%C3%A9servation.png" alt="Formulaire de r√©servation" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Le mod√®le de document :</li>
</ul>
<p>
<a href="#image-b649b1843cfdb917db1ccc7a9d12181d" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/02-Template%20Vouchers%20CEFIM_PEDAGO.png" alt="Mod√®le de document" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-b649b1843cfdb917db1ccc7a9d12181d">
<img src="../../at2/at2e2/stage-cefim/02-Template%20Vouchers%20CEFIM_PEDAGO.png" alt="Mod√®le de document" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>La pr√©sentation du lien vers le document g√©n√©r√© :</li>
</ul>
<p>
<a href="#image-67252af4202bf90628256836518fbc85" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/03-Lien%20document%20g%C3%A9n%C3%A9r%C3%A9.png" alt="Lien document g√©n√©r√©" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-67252af4202bf90628256836518fbc85">
<img src="../../at2/at2e2/stage-cefim/03-Lien%20document%20g%C3%A9n%C3%A9r%C3%A9.png" alt="Lien document g√©n√©r√©" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Le document g√©n√©r√© :</li>
</ul>
<p>
<a href="#image-fd056ce9f2feb1070d023e22abb2190e" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/04-Document%20g%C3%A9n%C3%A9r%C3%A9.png" alt="Document g√©n√©r√©" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-fd056ce9f2feb1070d023e22abb2190e">
<img src="../../at2/at2e2/stage-cefim/04-Document%20g%C3%A9n%C3%A9r%C3%A9.png" alt="Document g√©n√©r√©" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Le document g√©n√©r√© modifi√© :</li>
</ul>
<p>
<a href="#image-28500d744ad1d25d44d33bd3ec6b6bbe" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/05-Document%20g%C3%A9n%C3%A9r%C3%A9%20modifi%C3%A9.png" alt="Document g√©n√©r√© modifi√©" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-28500d744ad1d25d44d33bd3ec6b6bbe">
<img src="../../at2/at2e2/stage-cefim/05-Document%20g%C3%A9n%C3%A9r%C3%A9%20modifi%C3%A9.png" alt="Document g√©n√©r√© modifi√©" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>L&rsquo;email d&rsquo;alerte de liste √©puis√©e :</li>
</ul>
<p>
<a href="#image-4de9246d2a07f8688a3899353595ab56" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/06-email%20alete%20liste%20%C3%A9puis%C3%A9e.png" alt="Email alerte liste √©puis√©e" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-4de9246d2a07f8688a3899353595ab56">
<img src="../../at2/at2e2/stage-cefim/06-email%20alete%20liste%20%C3%A9puis%C3%A9e.png" alt="Email alerte liste √©puis√©e" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>L&rsquo;email de confirmation d&rsquo;activation de vouchers de secours :</li>
</ul>
<p>
<a href="#image-a7e5229864f1fc805c91b5bd9d7bbb34" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/07-email%20confirm%20secours.png" alt="Email confirmation secours" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-a7e5229864f1fc805c91b5bd9d7bbb34">
<img src="../../at2/at2e2/stage-cefim/07-email%20confirm%20secours.png" alt="Email confirmation secours" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h3 id="code">Code</h3>
<p>Vouchers CEFIM_PEDAGO</p>
<p>Code.gs :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// Global config object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Add a menu entry to UI
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">onOpen</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getUi</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">createMenu</span><span class="p">(</span><span class="s1">&#39;üîëVOUCHERS&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">addItem</span><span class="p">(</span><span class="s1">&#39;Reserver&#39;</span><span class="p">,</span> <span class="s1">&#39;openFormDialog&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">addToUi</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Open the form dialog (triggered by opening the spreadsheet or by the VOUCHERS menu)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">openFormDialog</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActive</span><span class="p">().</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s1">&#39;Vouchers&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sheet</span><span class="p">.</span><span class="nx">activate</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createHtmlOutputFromFile</span><span class="p">(</span><span class="s1">&#39;Form&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">setWidth</span><span class="p">(</span><span class="mi">520</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">setHeight</span><span class="p">(</span><span class="mi">320</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getUi</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">showModalDialog</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="s1">&#39;Vouchers CEFIM_PEDAGO&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Show the loading dialog
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">openLoadingModal</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createHtmlOutputFromFile</span><span class="p">(</span><span class="s1">&#39;Loading&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">setWidth</span><span class="p">(</span><span class="mi">520</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">setHeight</span><span class="p">(</span><span class="mi">360</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getUi</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">showModalDialog</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="s1">&#39;Chargement...&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Populate the config object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">getConfig</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">configSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActive</span><span class="p">().</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s1">&#39;Config&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span><span class="p">.</span><span class="nx">templateId</span> <span class="o">=</span> <span class="nx">configSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span><span class="p">.</span><span class="nx">docFolderId</span> <span class="o">=</span> <span class="nx">configSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="nx">configSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span><span class="p">.</span><span class="nx">lowlimit</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">configSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="nx">getValue</span><span class="p">(),</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`*CONFIG* templateId: </span><span class="si">${</span><span class="nx">config</span><span class="p">.</span><span class="nx">templateId</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">        docFolderId: </span><span class="si">${</span><span class="nx">config</span><span class="p">.</span><span class="nx">docFolderId</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">        email: </span><span class="si">${</span><span class="nx">config</span><span class="p">.</span><span class="nx">email</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">        lowlimit: </span><span class="si">${</span><span class="nx">config</span><span class="p">.</span><span class="nx">lowLimit</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Create a Google Document with form response data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">createDocumentFromFormData</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span> <span class="o">=</span> <span class="nx">getConfig</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">ui</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Form response (or test data if debugging)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">grp</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">group</span> <span class="o">?</span> <span class="nx">form</span><span class="p">.</span><span class="nx">group</span> <span class="o">:</span> <span class="s1">&#39;DEBUG TEST GRP [&#39;</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">date</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">date</span> <span class="o">?</span> <span class="nx">form</span><span class="p">.</span><span class="nx">date</span> <span class="o">:</span> <span class="s1">&#39;2022-12-31&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">nb</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">nb</span> <span class="o">?</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">nb</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Localized date
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">fdate</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">),</span> <span class="s1">&#39;Europe/Paris&#39;</span><span class="p">,</span> <span class="s1">&#39;dd/MM/yyyy&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Get email of the user executing the script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">Session</span><span class="p">.</span><span class="nx">getActiveUser</span><span class="p">().</span><span class="nx">getEmail</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">ss</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActive</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Store the working Sheets
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">vlist</span> <span class="o">=</span> <span class="nx">ss</span><span class="p">.</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s1">&#39;Vouchers&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">used</span> <span class="o">=</span> <span class="nx">ss</span><span class="p">.</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s1">&#39;Utilis√©s&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">rows</span> <span class="o">=</span> <span class="nx">vlist</span><span class="p">.</span><span class="nx">getDataRange</span><span class="p">().</span><span class="nx">getValues</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Make a copy of the template Document &amp; store its ID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">documentId</span> <span class="o">=</span> <span class="nx">DriveApp</span><span class="p">.</span><span class="nx">getFileById</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">templateId</span><span class="p">).</span><span class="nx">makeCopy</span><span class="p">().</span><span class="nx">getId</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Using string interpolation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">date</span><span class="si">}</span><span class="sb"> - </span><span class="si">${</span><span class="nx">grp</span><span class="si">}</span><span class="sb"> - </span><span class="si">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">docFile</span> <span class="o">=</span> <span class="nx">DriveApp</span><span class="p">.</span><span class="nx">getFileById</span><span class="p">(</span><span class="nx">documentId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">docFile</span><span class="p">.</span><span class="nx">setName</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Add the docFile to the doc sub-folder
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">DriveApp</span><span class="p">.</span><span class="nx">getFolderById</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">docFolderId</span><span class="p">).</span><span class="nx">addFile</span><span class="p">(</span><span class="nx">docFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Remove the docFile ref from the current folder
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">docFile</span><span class="p">.</span><span class="nx">getParents</span><span class="p">().</span><span class="nx">next</span><span class="p">().</span><span class="nx">removeFile</span><span class="p">(</span><span class="nx">docFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">documentUrl</span> <span class="o">=</span> <span class="sb">`https://docs.google.com/document/d/</span><span class="si">${</span><span class="nx">documentId</span><span class="si">}</span><span class="sb">/edit`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">docBody</span> <span class="o">=</span> <span class="nx">DocumentApp</span><span class="p">.</span><span class="nx">openById</span><span class="p">(</span><span class="nx">documentId</span><span class="p">).</span><span class="nx">getBody</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">docBody</span><span class="p">.</span><span class="nx">replaceText</span><span class="p">(</span><span class="s1">&#39;##Groupe##&#39;</span><span class="p">,</span> <span class="nx">grp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">docBody</span><span class="p">.</span><span class="nx">replaceText</span><span class="p">(</span><span class="s1">&#39;##Date##&#39;</span><span class="p">,</span> <span class="nx">fdate</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">placeholder</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Store the 1st empty row from the used Sheet before insertion
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">firstRow</span> <span class="o">=</span> <span class="nx">used</span><span class="p">.</span><span class="nx">getLastRow</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Get &amp; move the needed number of Vouchers from the vlist Sheet to the used Sheet,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// starting from the end of the list (one by one to timestamp each of them)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">row</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">nb</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">,</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">row</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">vlist</span><span class="p">.</span><span class="nx">deleteRow</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">placeholder</span> <span class="o">=</span> <span class="sb">`##voucher</span><span class="si">${</span><span class="nx">j</span><span class="si">}</span><span class="sb">##`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// row[0] is the voucher
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">docBody</span><span class="p">.</span><span class="nx">replaceText</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span> <span class="nx">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// add the timestamp
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="s1">&#39;Europe/Paris&#39;</span><span class="p">,</span> <span class="s1">&#39;yyyy/MM/dd  HH:mm:ss.SSS&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Following data need to be written 1 time only
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">j</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fdate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nx">grp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">row</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="nx">documentUrl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Append the row to the used list
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">used</span><span class="p">.</span><span class="nx">appendRow</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Count remaining vouchers en send an alert if &lt;= config.lowlimit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">rows</span> <span class="o">=</span> <span class="nx">vlist</span><span class="p">.</span><span class="nx">getDataRange</span><span class="p">().</span><span class="nx">getValues</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">vouchersLeft</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">vouchersLeft</span> <span class="o">&lt;=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">lowlimit</span><span class="p">)</span> <span class="p">{</span><span class="nx">sendAlertEmail</span><span class="p">(</span><span class="nx">vouchersLeft</span><span class="p">);}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Format inserted data inside the used Sheet (merge - valign - borders - columns auto resize)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">lastRow</span> <span class="o">=</span> <span class="nx">used</span><span class="p">.</span><span class="nx">getLastRow</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">range</span> <span class="o">=</span> <span class="sb">`D</span><span class="si">${</span><span class="nx">firstRow</span><span class="si">}</span><span class="sb">:G</span><span class="si">${</span><span class="nx">lastRow</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// merge &amp; align
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">used</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">range</span><span class="p">).</span><span class="nx">mergeVertically</span><span class="p">().</span><span class="nx">setVerticalAlignment</span><span class="p">(</span><span class="s1">&#39;middle&#39;</span><span class="p">).</span><span class="nx">setHorizontalAlignment</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">range</span> <span class="o">=</span> <span class="sb">`A</span><span class="si">${</span><span class="nx">firstRow</span><span class="si">}</span><span class="sb">:G</span><span class="si">${</span><span class="nx">lastRow</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// borders
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">used</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">range</span><span class="p">).</span><span class="nx">setBorder</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// autoresize colums
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">used</span><span class="p">.</span><span class="nx">autoResizeColumns</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">// Delete unused placeholders in the Document
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">nb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">25</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">placeholder</span> <span class="o">=</span> <span class="sb">`##voucher</span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">##`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">docBody</span><span class="p">.</span><span class="nx">replaceText</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">search</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">tables</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Extract all the tables inside the Document
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">while</span> <span class="p">(</span><span class="nx">search</span> <span class="o">=</span> <span class="nx">docBody</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">DocumentApp</span><span class="p">.</span><span class="nx">ElementType</span><span class="p">.</span><span class="nx">TABLE</span><span class="p">,</span> <span class="nx">search</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">tables</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">search</span><span class="p">.</span><span class="nx">getElement</span><span class="p">().</span><span class="nx">asTable</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Delete all empty rows from the Document tables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">tables</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">trows</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">getNumRows</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Iterate through each row of the table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">trows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">r</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">r</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// If the table row contains no text, delete it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">if</span> <span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">getRow</span><span class="p">(</span><span class="nx">r</span><span class="p">).</span><span class="nx">getText</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">table</span><span class="p">.</span><span class="nx">removeRow</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Show the ready to print Document link in a modal dialog
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActive</span><span class="p">().</span><span class="nx">toast</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">nb</span><span class="si">}</span><span class="sb"> vouchers r√©serv√©s pour le groupe </span><span class="si">${</span><span class="nx">grp</span><span class="si">}</span><span class="sb"> pour le </span><span class="si">${</span><span class="nx">fdate</span><span class="si">}</span><span class="sb"> par </span><span class="si">${</span><span class="nx">user</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;&lt;head&gt;&lt;style&gt;* {font-family: &#34;Google Sans&#34;,Roboto,RobotoDraft,Helvetica,Arial,sans-serif;}&lt;/style&gt;&lt;/head&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;body&gt;&lt;h1&gt;&lt;a href=&#34;&#39;</span> <span class="o">+</span> <span class="nx">documentUrl</span> <span class="o">+</span> <span class="s1">&#39;&#34; target=&#34;_blank&#34;&gt;Ouvrir le document&lt;/a&gt;&lt;/h1&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;h3&gt;Une fois ouvert, le document peut √™tre modifi√© et/ou imprim√©.&lt;/h3&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;p&gt;Le lien du document est √©galement accessible via la feuille &#34;Utilis√©s&#34;.&lt;/p&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;div style=&#34;margin: 80px auto auto 200px;&#34;&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;input type=&#34;button&#34; value=&#34;Fermer&#34; id=&#34;btnclose&#34; onclick=&#34;google.script.host.close();&#34; style=&#34; width: 80px; height: 30px;&#34; /&gt;&lt;/div&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ui</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createHtmlOutput</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getUi</span><span class="p">().</span><span class="nx">showModalDialog</span><span class="p">(</span><span class="nx">ui</span><span class="p">,</span> <span class="nx">title</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">sendAlertEmail</span><span class="p">(</span><span class="nx">nbleft</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`sendAlertEmail a d√©marr√© avec le param√®tre nbleft=</span><span class="si">${</span><span class="nx">nbleft</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">subject</span> <span class="o">=</span> <span class="s1">&#39;Alerte CEFIM_PEDAGO Vouchers : Liste √©puis√©e&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">body</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;&lt;body&gt;&lt;h1 style=&#34;color: red;&#34;&gt;La liste de vouchers CEFIM_PEDAGO disponibles arrive √† √©puisement.&lt;/h1&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;h2&gt;Il reste &lt;b&gt;&#39;</span> <span class="o">+</span> <span class="nx">nbleft</span> <span class="o">+</span> <span class="s1">&#39; vouchers disponibles&lt;/b&gt; dans la liste courante.&lt;/h2&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;h3&gt;&lt;p&gt;Options :&lt;/p&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;ul&gt;&lt;li&gt;&lt;a href=&#34;https://46.247.250.13:666//&#34; target=&#34;_blank&#34;&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;Se connecter √† l\&#39;inteface web du pfSense CEFIM_PEDAGO afin de g√©n√©rer un nouveau Roll&lt;/a&gt;&lt;/li&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;li&gt;&lt;a href=&#34;https://docs.google.com/spreadsheets/d/12vdKWwv6jeDFzN9X8V79do9gQrcitEgQPXLvzj6H91w&#34; target=&#34;_blank&#34;&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;Ouvrir la liste de secours pour ajout rapide de vouchers&lt;/a&gt;&lt;/li&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;li&gt;&lt;a href=&#34;https://docs.google.com/spreadsheets/d/16eqNvG-Z5y9pHuQbCb80A3K3q3gIcX9S6Ja_7TwtFZ0/edit#gid=1505767989&#34; target=&#34;_blank&#34;&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;Ouvrir la liste r√©guli√®re pour v√©rifications&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">MailApp</span><span class="p">.</span><span class="nx">sendEmail</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">to</span><span class="o">:</span><span class="nx">config</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subject</span><span class="o">:</span><span class="nx">subject</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">htmlBody</span><span class="o">:</span><span class="nx">body</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;CEFIM_PEDAGO - Vouchers alerte&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Form.html :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">base</span> <span class="nx">target</span><span class="o">=</span><span class="s2">&#34;_top&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">*</span> <span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">family</span><span class="o">:</span> <span class="s2">&#34;Google Sans&#34;</span><span class="p">,</span><span class="nx">Roboto</span><span class="p">,</span><span class="nx">RobotoDraft</span><span class="p">,</span><span class="nx">Helvetica</span><span class="p">,</span><span class="nx">Arial</span><span class="p">,</span><span class="nx">sans</span><span class="o">-</span><span class="nx">serif</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">info</span> <span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span> <span class="mi">14</span><span class="nx">px</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="nx">red</span><span class="p">;</span> <span class="nx">margin</span><span class="o">-</span><span class="nx">bottom</span><span class="o">:</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">p</span> <span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">weight</span><span class="o">:</span> <span class="mi">600</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">label</span> <span class="p">{</span><span class="nx">display</span><span class="o">:</span> <span class="nx">inline</span><span class="o">-</span><span class="nx">block</span><span class="p">;</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">210</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">label</span><span class="o">::</span><span class="nx">after</span> <span class="p">{</span><span class="nx">content</span><span class="o">:</span> <span class="s2">&#34; *&#34;</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="nx">red</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">input</span> <span class="p">{</span><span class="nx">display</span><span class="o">:</span> <span class="nx">inline</span><span class="o">-</span><span class="nx">block</span><span class="p">;</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">260</span><span class="nx">px</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="nx">blue</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">date</span> <span class="p">{</span><span class="nx">width</span><span class="o">:</span> <span class="mi">120</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">nb</span> <span class="p">{</span><span class="nx">width</span><span class="o">:</span> <span class="mi">40</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">sep</span> <span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">msg</span> <span class="p">{</span><span class="nx">display</span><span class="o">:</span> <span class="nx">none</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="nx">red</span><span class="p">;</span> <span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;</span> <span class="nx">margin</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span> <span class="mi">110</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">btnsubmit</span><span class="p">,</span> <span class="err">#</span><span class="nx">btncancel</span> <span class="p">{</span><span class="nx">width</span><span class="o">:</span> <span class="mi">210</span><span class="nx">px</span><span class="p">;</span> <span class="nx">margin</span><span class="o">:</span> <span class="mi">0</span> <span class="mi">12</span><span class="nx">px</span> <span class="mi">0</span> <span class="mi">12</span><span class="nx">px</span><span class="p">;</span> <span class="nx">padding</span><span class="o">:</span> <span class="mi">5</span><span class="nx">px</span> <span class="mi">0</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">loading</span> <span class="p">{</span><span class="nx">display</span><span class="o">:</span> <span class="nx">none</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">loadtxt</span> <span class="p">{</span><span class="nx">position</span><span class="o">:</span> <span class="nx">absolute</span><span class="p">;</span> <span class="nx">top</span><span class="o">:</span> <span class="mi">2</span><span class="nx">px</span><span class="p">;</span> <span class="nx">left</span><span class="o">:</span> <span class="mi">2</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">loadimg</span> <span class="p">{</span><span class="nx">position</span><span class="o">:</span> <span class="nx">relative</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/style&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/head&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;form&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Les</span> <span class="nx">vouchers</span> <span class="nx">CEFIM_PEDAGO</span> <span class="nx">sont</span> <span class="nx">valides</span> <span class="mi">5</span> <span class="nx">jours</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">hr</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;info&#34;</span><span class="o">&gt;*</span> <span class="nx">Requis</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;resaForm&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&#34;grp&#34;</span><span class="o">&gt;</span><span class="nx">Nom</span> <span class="nx">ou</span> <span class="nx">Groupe</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;text&#34;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;grp&#34;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;group&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;badgrp&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;msg&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Indiquer</span> <span class="nx">un</span> <span class="nx">nom</span> <span class="nx">de</span> <span class="nx">personne</span> <span class="nx">ou</span> <span class="nx">de</span> <span class="nx">groupe</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;sepgrp&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;sep&#34;</span><span class="o">&gt;&lt;</span><span class="nx">p</span><span class="o">&gt;&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/p&gt;&lt;/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&#34;date&#34;</span><span class="o">&gt;</span><span class="nb">Date</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;date&#34;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;date&#34;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;date&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;baddate&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;msg&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Choisir</span> <span class="nx">une</span> <span class="nx">date</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;sepdate&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;sep&#34;</span><span class="o">&gt;&lt;</span><span class="nx">p</span><span class="o">&gt;&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/p&gt;&lt;/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&#34;nb&#34;</span><span class="o">&gt;</span><span class="nx">Nombre</span> <span class="nx">de</span> <span class="nx">vouchers</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">25</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;number&#34;</span> <span class="nx">min</span><span class="o">=</span><span class="s2">&#34;1&#34;</span> <span class="nx">max</span><span class="o">=</span><span class="s2">&#34;25&#34;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;nb&#34;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;nb&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;badnb&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;msg&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Choisir</span> <span class="nx">un</span> <span class="nx">nombre</span> <span class="nx">entre</span> <span class="mi">1</span> <span class="nx">et</span> <span class="mi">25</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;sepnb&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;sep&#34;</span><span class="o">&gt;&lt;</span><span class="nx">p</span><span class="o">&gt;&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/p&gt;&lt;/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">hr</span> <span class="o">/&gt;&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;button&#34;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&#34;Annuler&#34;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;btncancel&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onclick</span><span class="o">=</span><span class="s2">&#34;google.script.host.close();&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;button&#34;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&#34;Valider&#34;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;btnsubmit&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onclick</span><span class="o">=</span><span class="s2">&#34;submitForm();&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/form&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="err">¬†¬†</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;grp&#34;</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Called right after the form is submited
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kd">function</span> <span class="nx">submitForm</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">grp</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;grp&#34;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">grp</span> <span class="o">===</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;badgrp&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepgrp&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">err</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;badgrp&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepgrp&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">dat</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;date&#34;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">dat</span> <span class="o">===</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;baddate&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepdate&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">err</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;baddate&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepdate&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">num</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;nb&#34;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">((</span><span class="nx">num</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">num</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;badnb&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepnb&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">err</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;badnb&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepnb&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">google</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">run</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">openLoadingModal</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">google</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">run</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">withSuccessHandler</span><span class="p">(</span><span class="nx">onSubmitSuccess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">createDocumentFromFormData</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;resaForm&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Called when the form is successfully submited - google.script.run is asynchronous
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kd">function</span> <span class="nx">onSubmitSuccess</span><span class="p">(</span><span class="cm">/*serverFunctionOutput, userObj*/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">google</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">run</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">withSuccessHandler</span><span class="p">(</span><span class="nx">onLoadSuccess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">openLoadingModal</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Called when the process is finished
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kd">function</span> <span class="nx">onLoadSuccess</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">google</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">host</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/body&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/html&gt;</span>
</span></span></code></pre></div><p>Loading.html :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">base</span> <span class="nx">target</span><span class="o">=</span><span class="s2">&#34;_top&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">*</span> <span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">family</span><span class="o">:</span> <span class="s2">&#34;Google Sans&#34;</span><span class="p">,</span><span class="nx">Roboto</span><span class="p">,</span><span class="nx">RobotoDraft</span><span class="p">,</span><span class="nx">Helvetica</span><span class="p">,</span><span class="nx">Arial</span><span class="p">,</span><span class="nx">sans</span><span class="o">-</span><span class="nx">serif</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">img</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">display</span><span class="o">:</span> <span class="nx">block</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">margin</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span> <span class="nx">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">margin</span><span class="o">-</span><span class="nx">right</span><span class="o">:</span> <span class="nx">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">width</span><span class="o">:</span> <span class="mi">90</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">h2</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">position</span><span class="o">:</span> <span class="nx">absolute</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">top</span><span class="o">:</span> <span class="mi">2</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">left</span><span class="o">:</span> <span class="mi">50</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/style&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/head&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;loading&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;loadimg&#34;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://lh3.googleusercontent.com/M7YzZMHlX9FO4tQC_o3FbCHXzA1GpYKSmP1h-w0EeGR40CNppuVzEkNZio8lRI9ZwLM=w2400&#34;</span> <span class="nx">title</span><span class="o">=</span><span class="s2">&#34;Loading...&#34;</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">h2</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;loadtxt&#34;</span><span class="o">&gt;</span><span class="nx">Patientez</span> <span class="nx">svp</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/body&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/html&gt;</span>
</span></span></code></pre></div>
            <footer class="footline">
            </footer>
          </article>

          </section>        </div>
      </main>
    </div>
    <script src="../../js/clipboard.min.js" defer></script>
    <script src="../../js/perfect-scrollbar.min.js" defer></script>
    <script src="../../js/theme.js" defer></script>
  </body>
</html>
