<!DOCTYPE html>
<html lang="fr" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="description" content="Docs formation Cefim TSSR">
    <meta name="author" content="Olivier Duhamel">
    <title>Sécuriser les accès à Internet - TSSOC</title>
    <link href="https://www.tssoc.oliduha.fr/at2/at2e2/index.html" rel="canonical" type="text/html" title="Sécuriser les accès à Internet - TSSOC">
    <link href="../../at2/at2e2/index.xml" rel="alternate" type="application/rss+xml" title="Sécuriser les accès à Internet - TSSOC">
    <link href="../../images/logo.svg" rel="icon" type="image/svg+xml">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="../../css/fontawesome-all.min.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fontawesome-all.min.css" rel="stylesheet"></noscript>
    <link href="../../css/nucleus.css" rel="stylesheet">
    <link href="../../css/auto-complete.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/auto-complete.css" rel="stylesheet"></noscript>
    <link href="../../css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="../../css/fonts.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fonts.css" rel="stylesheet"></noscript>
    <link href="../../css/theme.css" rel="stylesheet">
    <link href="../../css/theme-auto.css" rel="stylesheet" id="variant-style">
    <link href="../../css/variant.css" rel="stylesheet">
    <link href="../../css/print.css" rel="stylesheet" media="print">
    <link href="../../css/format-print.css" rel="stylesheet">
    <link href="../../css/ie.css" rel="stylesheet">
    <script src="../../js/url.js"></script>
    <script src="../../js/variant.js"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="../../index.search.js";
      var root_url="../../";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copier dans le presse-papiers';
      window.T_Copied_to_clipboard = 'Copié dans le presse-papiers !';
      window.T_Copy_link_to_clipboard = 'Copier le lien dans le presse-papiers';
      window.T_Link_copied_to_clipboard = 'Lien copié dans le presse-papiers !';
      window.T_No_results_found = 'Aucun résultat trouvé pour \u0022{0}\u0022';
      window.T_N_results_found = '{1} résultats trouvés pour \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/www.tssoc.oliduha.fr/';
      window.variants && variants.init( [ 'auto', 'relearn-bright', 'relearn-light', 'relearn-dark', 'learn', 'neon', 'blue', 'green', 'red' ] );
    </script>
    <style>
      #body img.bg-white {
        background-color: white;
      }
    </style>
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../at2/at2e2/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../index.html"><span itemprop="name">TSSOC</span></a><meta itemprop="position" content="1"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../at2/index.html"><span itemprop="name">Maintenir, exploiter et sécuriser une infrastructure centralisée</span></a><meta itemprop="position" content="2"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Sécuriser les accès à Internet</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable chapter narrow" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="chapter">
<div class="article-subheading">Chapitre 2</div>
<h1 id="sécuriser-les-accès-à-internet">Sécuriser les accès à Internet</h1>

<hr>
<h4 id="1-stage-cefimat2at2e2stage-cefim">1. <a href="../../at2/at2e2/stage-cefim/">Stage Cefim</a></h4>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Sous-sections de Sécuriser les accès à Internet</h1>
          <article class="chapter">
<div class="article-subheading">Exemple 1</div>
<h1 id="stage-cefim">Stage Cefim</h1>

<h2 id="automatisation-vouchers-cefim_pedago"><strong>Automatisation vouchers CEFIM_PEDAGO</strong></h2>
<p><em><strong>Les vouchers sont des codes d&rsquo;accès temporaires à un réseau WiFi sécurisé.</strong></em></p>
<hr>
<h2 id="mission-initiale">Mission initiale</h2>
<p>Simplifier l&rsquo;extraction de vouchers pour connexion au réseau WiFi CEFIM_PEDAGO des utilisateurs apportant leur propre matériel (ordinateur, tablette, smartphone).</p>
<hr>
<h2 id="contexte">Contexte</h2>
<p>Dans les locaux du CEFIM, le réseau WiFi CEFIM_PEDAGO est utilisé par la majorité des étudiants, formateurs, intervenants extérieurs et jurys.</p>
<p>L&rsquo;accès courant au réseau est autorisé par un système de filtrage MAC au niveau du portail captif de la passerelle/pare-feu (pfSense).
Les adresses MAC des machines CEFIM (pc/mac) fournies aux étudiants et formateurs internes sont enregistrées dans la configuration du portail captif.</p>
<p>Pour autoriser la connexion d&rsquo;une machine inconnue, un système d&rsquo;authentification par vouchers est mis en place au niveau du portail captif.
Il s&rsquo;agit de séries (appelées Rolls) de codes d&rsquo;accès temporaires générés manuellement dans l&rsquo;interface web du pfSense (menu &lsquo;Services&rsquo; &gt; &lsquo;Captive Portal&rsquo; &gt; &lsquo;Edit Zone&rsquo; &gt; &lsquo;Vouchers&rsquo;).</p>
<p>En général, une série de 1000 vouchers valides pendant cinq jours est générée par l&rsquo;administrateur quand la série précédente arrive à épuisement.
La série générée est téléchargée depuis l&rsquo;interface web du pfSense au format .csv puis importée dans un google sheet partagé.</p>
<p>Lorsqu&rsquo;un groupe d&rsquo;utilisateurs a besoin de se connecter temporairement à Internet avec des machines non connues du portail captif, il faut lui fournir une liste de vouchers (1 par personne).
Pour cela, un opérateur doit renseigner les divers éléments du tableau (le statut réservé, son nom, la date et le nom du groupe ou de la personne) pour chaque voucher, puis copier le nombre de codes souhaités depuis le tableau partagé et les coller dans un autre document (tableur ou texte) qu&rsquo;il doit ensuite imprimer.
L&rsquo;utilisateur final peut ainsi se connecter au réseau en renseignant le voucher qui lui est fourni lorsque le portail captif lui demande.</p>
<hr>
<h2 id="problèmes-relevés">Problèmes relevés</h2>
<ol>
<li>Plusieurs manipulations sont nécessaires pour imprimer les vouchers.</li>
<li>Les opérateurs n&rsquo;utilisent pas toujours des codes contigus dans la liste, rendant parfois encore plus fastidieuses les extractions ultérieures.</li>
<li>L&rsquo;administrateur doit surveiller l&rsquo;évolution de l&rsquo;utilisation de la liste de vouchers afin d&rsquo;en générer de nouveau lorsqu&rsquo;elle arrive à épuisement.</li>
<li>Les vouchers sont le plus souvent attribués à des groupes d&rsquo;utilisateurs. Une fois la formation terminée il n&rsquo;y a aucun moyen de relier un utilisateur au code de connexion utilisé, ce qui représente un risque légal.</li>
<li>Une partie des vouchers n&rsquo;a pas été utilisée une fois la formation terminée, ce qui représente un autre risque car ces codes se retrouvent alors &ldquo;dans la nature&rdquo;.</li>
</ol>
<hr>
<h2 id="objectifs-fonctionnels">Objectifs fonctionnels</h2>
<ul>
<li>Simplifier et rationaliser le système.</li>
<li>Avertir l&rsquo;administrateur lorsque la liste de vouchers atteint un seuil critique.</li>
<li>Relier les utilisateurs aux vouchers qu&rsquo;ils ont utilisé.</li>
<li>Invalider les vouchers non utilisés.</li>
</ul>
<hr>
<h2 id="solution-envisagée">Solution envisagée</h2>
<p>Développer un script &lsquo;Apps Script&rsquo; (le langage de script Google Workspace - une version de javascript spécifiquement développée par Google) qui devra :</p>
<ul>
<li>Afficher un formulaire simplifiant la saisie des informations nécessaires à l&rsquo;extraction par les opérateurs.</li>
<li>Extraire et réserver le nombre de vouchers nécessaires de la liste.</li>
<li>Créer un Google Document présentant les vouchers mis en page, prêt à être imprimé.</li>
<li>Envoyer un email d&rsquo;alerte à l&rsquo;administrateur lorsque la liste de vouchers disponibles arrive à épuisement.</li>
</ul>
<p>Fonctionnalité supplémentaire : Disposer d&rsquo;une liste de secours afin de simplifier l&rsquo;ajout de vouchers par l&rsquo;admin s&rsquo;il n&rsquo;est pas présent sur site (en congés, en déplacement, etc.) lorsque la liste courante arrive à épuisement.</p>
<p>L&rsquo;invalidation des vouchers non utilisés n&rsquo;est possible que par l&rsquo;intermédiaire de l&rsquo;interface web du pfSense et donc relève de la responsabilité de l&rsquo;administrateur. Il faut simplement intégrer cette opération dans une procédure de maintenance.</p>
<hr>
<h2 id="prérequis">Prérequis</h2>
<p>Arborescence Google Drive :</p>
<ul>
<li>1 dossier principal Google Drive partagé avec :
<ul>
<li>1 sous-dossier accessible uniquement par l&rsquo;administrateur.</li>
<li>1 sous-dossier partagé</li>
</ul>
</li>
</ul>
<p>Documents Google :</p>
<ul>
<li>1 Google Sheet dans le dossier principal contenant la liste courante de vouchers disponibles. Le partage de ce fichier doit être nominatif (l&rsquo;accès nécessite une connection aux services Google). Il contiendra :
<ul>
<li>1 feuille de calcul pour la liste des vouchers disponible.</li>
<li>1 feuille de calcul pour la liste des vouchers utilisés.</li>
<li>1 feuille de calcul masquée contenant les paramètres généraux des scripts :
<ul>
<li>L&rsquo;Id du modèle de document.</li>
<li>L&rsquo;Id du sous-dossier contenant les documents générés.</li>
<li>L&rsquo;adresse email de l&rsquo;administrateur.</li>
<li>Le seuil d&rsquo;alerte.</li>
</ul>
</li>
</ul>
</li>
<li>1 modèle Google Document dans le dossier principal pour impression des vouchers sur demande contenant :
<ul>
<li>Le logo du CEFIM.</li>
<li>1 emplacement pour le nom du groupe ou de la personne.</li>
<li>1 emplacement pour la date.</li>
<li>1 tableau sur 2 colonnes avec :
<ul>
<li>1 ligne de titres</li>
<li>25 lignes avec chacune 1 emplacement pour un voucher dans la 1ère colonne et 1 cellule vide pour recevoir les nom et prénom de l&rsquo;utilisateur dans la 2ème colonne.</li>
</ul>
</li>
<li>Un message &ldquo;Bonne formation&rdquo; sous le tableau.</li>
</ul>
</li>
<li>1 Google Sheet dans le dossier privé contenant la liste des vouchers de secours.</li>
</ul>
<hr>
<h2 id="mise-en-oeuvre">Mise en oeuvre</h2>
<h3 id="côté-serveur">Côté serveur</h3>
<p>Un script serveur attaché à la liste courante qui implémente les fonctionnalités suivantes :</p>
<ul>
<li>Ajout d&rsquo;un menu permettant d&rsquo;afficher le formulaire de demande de vouchers.</li>
<li>Ajout d&rsquo;un déclencheur personnalisé affichant le formulaire à l&rsquo;ouverture de la feuille de calcul.</li>
<li>Le formulaire est affiché de manière modale.</li>
<li>Post-traitement du formulaire :
<ul>
<li>Récupération des données saisies.</li>
<li>Récupération de l&rsquo;adresse email de l&rsquo;opérateur.</li>
<li>Extraction du nombre de vouchers demandés vers une autre feuille de calcul avec les infos de réservation.</li>
<li>Mise en forme des données déplacées.</li>
<li>Création d&rsquo;un Google Document à partir d&rsquo;un modèle.</li>
<li>Insertion des données dans le Document.</li>
<li>Suppression des éléments inutiles.</li>
<li>Enregistrement du Document dans un sous-dossier spécifique du Drive.</li>
<li>Affichage du lien vers le Document généré.</li>
</ul>
</li>
<li>Envoi d&rsquo;un email d&rsquo;alerte à l&rsquo;administrateur lorsque le nombre de vouchers disponibles est en dessous du seuil défini, avec :
<ul>
<li>1 lien vers l&rsquo;interface web du pfSense pour générer un nouveau roll.</li>
<li>1 lien pour ouvrir la liste de secours.</li>
<li>1 lien vers la liste courante.</li>
</ul>
</li>
</ul>
<p>Un script serveur attaché à la liste de secours qui implémente ces fonctionnalités :</p>
<ul>
<li>Ajout d&rsquo;un menu permettant de lancer la procédure d&rsquo;ajout de vouchers de secours à la liste courante.</li>
<li>Le chargement de la configuration contenue dans une feuille spécifique du classeur.</li>
<li>La procédure d&rsquo;ajout de vouchers de secours à la liste courante avec demande de confirmation préalable et gestion des erreurs (authentification, ouverture de fichier).</li>
<li>Envoi d&rsquo;un email indiquant le succès ou l&rsquo;échec éventuel de l&rsquo;opération ainsi que le nombre de vouchers de secours restants.</li>
</ul>
<h3 id="coté-client">Coté client</h3>
<p>Un fichier html contenant le formulaire de réservation de vouchers avec :</p>
<ul>
<li>1 champ pour renseigner le nom du ou des destinataires (groupe ou personne).</li>
<li>1 champ pour la date.</li>
<li>1 champ pour le nombre de vouchers à réserver.</li>
<li>Formatage CSS :
<ul>
<li>Mise en page générale.</li>
<li>Indication des champs requis.</li>
</ul>
</li>
<li>Javascript :
<ul>
<li>Validation des données saisies pour éviter les erreurs, avec retour visuel.</li>
<li>Indication de chargement.</li>
<li>Déclenchement du script serveur suite à la validation du formulaire.</li>
</ul>
</li>
</ul>
<p>Un fichier Html d&rsquo;indication de chargement comportant :</p>
<ul>
<li>1 titre</li>
<li>1 gif animé hébergé sur le Google Drive partagé</li>
</ul>
<hr>
<h2 id="utilisation">Utilisation</h2>
<h3 id="par-les-opérateurs">Par les opérateurs</h3>
<p>À l&rsquo;ouverture du Google Sheet partagé contenant la liste des vouchers disponibles, un script est automatiquement exécuté. Il ajoute une entrée de menu et affiche le formulaire permettant de saisir les informations nécessaires à la réservation de vouchers :</p>
<ul>
<li>Un nom de groupe ou personne.</li>
<li>La date de début de formation.</li>
<li>Le nombre de vouchers à réserver.</li>
</ul>
<p>L&rsquo;opérateur étant connecté pour avoir accès au document, son adresse email est automatiquement récupérée par le script.</p>
<p>Une fois le formulaire correctement renseigné (les données saisies sont vérifiées) le script déplace le nombre de vouchers réservés dans une autre feuille où sont également renseignés les informations propres à la réservation, puis génère une copie du modèle Google Document en y insérant le nom du groupe, la date et la liste de vouchers réservés.</p>
<p>Une boite de dialogue affichant le lien vers le document généré est alors présentée à l&rsquo;opérateur. En suivant ce lien le document s&rsquo;ouvre dans un nouvel onglet de son navigateur, il peut directement l&rsquo;imprimer ou le modifier au préalable si besoin (par ex. : renseigner la colonne des noms d&rsquo;utilisateurs si connus par l&rsquo;opérateur). Si non remplis avant impression, les utilisateurs devront renseigner leur nom et prénom en regard du voucher utilisé.</p>
<p>Une fois le tableau rempli et récupéré, l&rsquo;opérateur devra reporter ces renseignements dans le tableau des vouchers utilisés. Pour se conformer à la législation, ces données devront être conservées pendant une durée minimum d'1 an.</p>
<h3 id="par-ladministrateur">Par l&rsquo;administrateur</h3>
<p>L&rsquo;administrateur génère un roll initial de 1000 vouchers ayants une durée de validité de 5 jours.</p>
<p>Lorsque le nombre de vouchers disponible atteint le seuil minimal, il reçoit un email d&rsquo;alerte lui indiquant le nombre de vouchers disponibles restant et lui présentant :</p>
<ul>
<li>Un lien vers l&rsquo;interface web du pfSense (adresse ip publique accessible de l&rsquo;extérieur).</li>
<li>Un lien vers le Google Sheet contenant les vouchers de secours pour un ajout rapide.</li>
<li>Un lien vers la liste courante pour vérification.</li>
</ul>
<p>S&rsquo;il décide d&rsquo;activer des vouchers de secours, un menu ou un bouton lui permettent d&rsquo;ajouter 100 vouchers de secours à la liste courante. Il peut répéter l&rsquo;opération jusqu&rsquo;à épuisement de la liste de secours. Un email de confirmation (ou d&rsquo;erreur) lui est automatiquement envoyé à chaque ajout lui indiquant le succès (ou l&rsquo;échec le cas échéant) de l&rsquo;opération ainsi que le nombre de vouchers de secours restants.</p>
<p>Ensuite, lorsque son emploi du temps lui permettra, il devra générer un nouveau roll de vouchers par le biais de l&rsquo;interface web du pfSense et les ajouter à la liste courante. Il devra également s&rsquo;assurer de disposer d&rsquo;un nombre suffisant de vouchers de secours en cas de besoin.</p>
<hr>
<h2 id="mise-en-production">Mise en production</h2>
<p>Le document Google Sheet contenant la liste courante de voucher doit être stocké dans un dossier principal Google Drive (&lsquo;CEFIM_PEDAGO&rsquo;). Ce document doit être partagé nominativement (utiliser le partage &ldquo;Limité&rdquo;) en renseignant une adresse email pour chaque collaborateur devant avoir un accès à cette liste. Ceci est nécessaire pour pouvoir récupérer automatiquement son adresse email via le script. Ce document comportera 3 feuilles de calcul :</p>
<ul>
<li>1 feuille nommée <strong>&ldquo;Vouchers&rdquo;</strong> contenant la liste des vouchers disponibles.</li>
<li>1 feuille nommée <strong>&ldquo;Utilisés&rdquo;</strong> contenant la liste des vouchers réservés.</li>
<li>1 feuille nommée <strong>&ldquo;Config&rdquo;</strong> (masquée) contenant les paramètres des scripts.</li>
</ul>
<p>Le modèle Google Document sera hébergé dans le dossier principal avec la liste courante et pourra être partagé de manière plus permissive (option de partage &ldquo;Tous les utilisateurs qui ont le lien&rdquo;).</p>
<p>Le document Google Sheet contenant les vouchers de secours doit être, quant-à-lui, stocké dans un sous dossier privé (&lsquo;PRIVATE&rsquo;) du dossier principal et n&rsquo;être accessible que par l&rsquo;administrateur en charge de la génération des rolls de vouchers (détenant un accès au pfSense). Il ne comportera qu&rsquo;une seule feuille nommée <strong>&ldquo;Liste_Secours&rdquo;</strong>.</p>
<p><strong>Important : Bien respecter les noms des feuilles de calcul pour les 2 Google Sheet tels qu&rsquo;indiqués ci-dessus en gras : Les scripts s&rsquo;appuient sur ces noms de feuille.</strong></p>
<h3 id="partages">Partages</h3>
<ul>
<li>Dossier principal &lsquo;CEFIM_PEDAGO&rsquo; : Tous les utilisateurs qui ont le lien</li>
<li>Sous-dossier &lsquo;DOCS&rsquo; : Tous les utilisateurs qui ont le lien</li>
<li>Sous-dossier &lsquo;PRIVATE&rsquo; : Non partagé</li>
<li>Google Sheet &lsquo;Vouchers_CEFIM_PEDAGO&rsquo; : Partage limité</li>
<li>Google Document &lsquo;Template_Vouchers_CEFIM_PEAGO&rsquo; : Tous les utilisateurs qui ont le lien</li>
<li>Google Sheet &lsquo;Vouchers_CEFIM_PEDAGO_SECOURS&rsquo; : Non partagé</li>
</ul>
<hr>
<h2 id="améliorations-ultérieures-éventuelles">Améliorations ultérieures éventuelles</h2>
<ul>
<li>
<p>Création et gestion de plusieurs rolls avec des durées de validité différentes (1/2 journée - 1 jour - 2 jours - 3 jours - 4 jours - 1 semaine - 2 semaines - 1 mois) pour correspondre aux durées des différentes formations dispensées. Autant de rolls de secours devront être prévus.</p>
</li>
<li>
<p>Dans le cas où l&rsquo;opérateur renseigne les noms/prénoms des utilisateurs avant impression, disposer d&rsquo;un script attaché au document permettant de reporter automatiquement ces infos dans le tableau des vouchers utilisés.</p>
</li>
<li>
<p>Export des vouchers réservés à l&rsquo;issue de chaque formation afin d&rsquo;en faciliter la vérification (s&rsquo;ils ont été utilisés ou non) ou l&rsquo;invalidation (interface web du pfSense dans les 2 cas).</p>
</li>
</ul>
<hr>
<h2 id="annexes">Annexes</h2>
<h3 id="caractéristiques-des-rolls-de-vouchers">Caractéristiques des rolls de vouchers</h3>
<ul>
<li>Ils comportent un numéro unique parmi les rolls actifs.</li>
<li>On leur affecte un nombre de vouchers (1023 maximum avec le nombre de bits de ticket par défaut).</li>
<li>On leur définit une durée de validité en heures.</li>
<li>Une description leur est associée.</li>
</ul>
<p><strong>Attention : Tout changement dans les champs de nombre de bits (roll, ticket ou somme de contrôle - voir ci-après) invalide immédiatement tout roll créé précédemment.</strong></p>
<h3 id="caractéristiques-générales-des-vouchers-pfsense">Caractéristiques générales des vouchers pfSense</h3>
<blockquote>
<p><em>Le texte en italique ci-dessous est une traduction de la documentation officielle.</em></p>
</blockquote>
<ul>
<li>Clés RSA : <code>64 bits maximum</code> (32 bits par défaut).</li>
<li>Jeu de caractères (utilisé pour la création des vouchers) : <code>2345678abcdefhijkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ</code> (par défaut - les caractères pouvant prêter à confusion sont retirés).</li>
</ul>
<p>Bits des vouchers : <em>Les champs de bits suivants contrôlent la manière dont les vouchers sont généré par le portail. Il est recommandé d&rsquo;utiliser les valeurs par défaut mais celles-ci peuvent être ajustées si nécessaire. Le total de tous les champs de bits doit être inférieur au nombre de bits de la clé RSA (exemple avec les valeurs par défaut : 16 + 10 + 5 = 31 =&gt; 32 - 1).</em></p>
<ul>
<li>Bits de roll : [1-31], défaut : <code>16</code> =&gt; définit le nombre maximum de rolls actifs simultanément = 65535 avec 16 bits (2^16 - 1, défaut).</li>
<li>Bits de ticket : [1-16], défaut : <code>10</code> =&gt; définit le nombre maximum de vouchers par roll = 1023 avec 10 bits (2^10 - 1, défaut).</li>
<li>Bits de somme de contrôle : [0-31], défaut : <code>5</code> =&gt; bits de contrôle d&rsquo;intégrité.</li>
</ul>
<p><em>Le &rsquo;nombre magique&rsquo; est présent dans chaque voucher et est vérifié par le portail lors de la vérification du voucher. La taille du nombre magique dépend du nombre de bits restant après avoir additionné les bits de roll, voucher et somme de contrôle. S&rsquo;il ne reste aucun bit disponible, le nombre magique n&rsquo;est pas utilisé.</em></p>
<p>Les deux derniers champs de la page de configuration permettent de personnaliser les messages d&rsquo;erreur en cas de tentative de connexion avec un code invalide ou avec un code expiré.</p>
<p>En résumé : Pour augmenter le nombre maximum de vouchers générés par roll il faut augmenter le nombre de bits de ticket tout en diminuant d&rsquo;autant le nombre de bits de roll (en conséquence les vouchers générés comporteront davantage de caractères).</p>
<h3 id="caractéristiques-des-vouchers-pour-cefim_pedago">Caractéristiques des vouchers pour CEFIM_PEDAGO</h3>
<ul>
<li>Générés par roll de 1000 vouchers.</li>
<li>Durée de validité de 5 jours à compter du moment d&rsquo;activation par l&rsquo;utilisateur.</li>
</ul>
<p>Les options suivantes conservent les valeurs par défaut :</p>
<ul>
<li>Clés RSA de 32 Bit (Public/Private).</li>
<li>Jeu de caractères : 2345678abcdefhijkmnpqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ</li>
<li>Bits de roll : 16</li>
<li>Bits de tickets : 10</li>
<li>Bits de somme de contrôle : 5</li>
<li>Nombre magique à 10 chiffres.</li>
</ul>
<hr>
<h3 id="captures-décrans">Captures d&rsquo;écrans</h3>
<ul>
<li>Le formulaire de réservation :</li>
</ul>
<p>
<a href="#image-1e83b01ad60228dee135e0b13a331ed0" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/01-Furmulaire%20r%C3%A9servation.png" alt="Formulaire de réservation" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1e83b01ad60228dee135e0b13a331ed0">
<img src="../../at2/at2e2/stage-cefim/01-Furmulaire%20r%C3%A9servation.png" alt="Formulaire de réservation" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Le modèle de document :</li>
</ul>
<p>
<a href="#image-b649b1843cfdb917db1ccc7a9d12181d" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/02-Template%20Vouchers%20CEFIM_PEDAGO.png" alt="Modèle de document" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-b649b1843cfdb917db1ccc7a9d12181d">
<img src="../../at2/at2e2/stage-cefim/02-Template%20Vouchers%20CEFIM_PEDAGO.png" alt="Modèle de document" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>La présentation du lien vers le document généré :</li>
</ul>
<p>
<a href="#image-67252af4202bf90628256836518fbc85" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/03-Lien%20document%20g%C3%A9n%C3%A9r%C3%A9.png" alt="Lien document généré" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-67252af4202bf90628256836518fbc85">
<img src="../../at2/at2e2/stage-cefim/03-Lien%20document%20g%C3%A9n%C3%A9r%C3%A9.png" alt="Lien document généré" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Le document généré :</li>
</ul>
<p>
<a href="#image-fd056ce9f2feb1070d023e22abb2190e" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/04-Document%20g%C3%A9n%C3%A9r%C3%A9.png" alt="Document généré" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-fd056ce9f2feb1070d023e22abb2190e">
<img src="../../at2/at2e2/stage-cefim/04-Document%20g%C3%A9n%C3%A9r%C3%A9.png" alt="Document généré" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Le document généré modifié :</li>
</ul>
<p>
<a href="#image-28500d744ad1d25d44d33bd3ec6b6bbe" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/05-Document%20g%C3%A9n%C3%A9r%C3%A9%20modifi%C3%A9.png" alt="Document généré modifié" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-28500d744ad1d25d44d33bd3ec6b6bbe">
<img src="../../at2/at2e2/stage-cefim/05-Document%20g%C3%A9n%C3%A9r%C3%A9%20modifi%C3%A9.png" alt="Document généré modifié" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>L&rsquo;email d&rsquo;alerte de liste épuisée :</li>
</ul>
<p>
<a href="#image-4de9246d2a07f8688a3899353595ab56" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/06-email%20alete%20liste%20%C3%A9puis%C3%A9e.png" alt="Email alerte liste épuisée" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-4de9246d2a07f8688a3899353595ab56">
<img src="../../at2/at2e2/stage-cefim/06-email%20alete%20liste%20%C3%A9puis%C3%A9e.png" alt="Email alerte liste épuisée" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>L&rsquo;email de confirmation d&rsquo;activation de vouchers de secours :</li>
</ul>
<p>
<a href="#image-a7e5229864f1fc805c91b5bd9d7bbb34" class="lightbox-link">
<img src="../../at2/at2e2/stage-cefim/07-email%20confirm%20secours.png" alt="Email confirmation secours" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-a7e5229864f1fc805c91b5bd9d7bbb34">
<img src="../../at2/at2e2/stage-cefim/07-email%20confirm%20secours.png" alt="Email confirmation secours" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h3 id="code">Code</h3>
<p>Vouchers CEFIM_PEDAGO</p>
<p>Code.gs :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="c1">// Global config object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">let</span> <span class="nx">config</span> <span class="o">=</span> <span class="p">{};</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Add a menu entry to UI
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">onOpen</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getUi</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">createMenu</span><span class="p">(</span><span class="s1">&#39;🔑VOUCHERS&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">addItem</span><span class="p">(</span><span class="s1">&#39;Reserver&#39;</span><span class="p">,</span> <span class="s1">&#39;openFormDialog&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">addToUi</span><span class="p">();</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Open the form dialog (triggered by opening the spreadsheet or by the VOUCHERS menu)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">openFormDialog</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">sheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActive</span><span class="p">().</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s1">&#39;Vouchers&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">sheet</span><span class="p">.</span><span class="nx">activate</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createHtmlOutputFromFile</span><span class="p">(</span><span class="s1">&#39;Form&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">setWidth</span><span class="p">(</span><span class="mi">520</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">setHeight</span><span class="p">(</span><span class="mi">320</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getUi</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">showModalDialog</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="s1">&#39;Vouchers CEFIM_PEDAGO&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Show the loading dialog
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">openLoadingModal</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createHtmlOutputFromFile</span><span class="p">(</span><span class="s1">&#39;Loading&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">setWidth</span><span class="p">(</span><span class="mi">520</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">setHeight</span><span class="p">(</span><span class="mi">360</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getUi</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">showModalDialog</span><span class="p">(</span><span class="nx">html</span><span class="p">,</span> <span class="s1">&#39;Chargement...&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Populate the config object
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">getConfig</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">configSheet</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActive</span><span class="p">().</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s1">&#39;Config&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span><span class="p">.</span><span class="nx">templateId</span> <span class="o">=</span> <span class="nx">configSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">2</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span><span class="p">.</span><span class="nx">docFolderId</span> <span class="o">=</span> <span class="nx">configSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">3</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span><span class="p">.</span><span class="nx">email</span> <span class="o">=</span> <span class="nx">configSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">4</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="nx">getValue</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span><span class="p">.</span><span class="nx">lowlimit</span> <span class="o">=</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">configSheet</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="mi">5</span><span class="p">,</span> <span class="mi">2</span><span class="p">).</span><span class="nx">getValue</span><span class="p">(),</span> <span class="mi">10</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`*CONFIG* templateId: </span><span class="si">${</span><span class="nx">config</span><span class="p">.</span><span class="nx">templateId</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">        docFolderId: </span><span class="si">${</span><span class="nx">config</span><span class="p">.</span><span class="nx">docFolderId</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">        email: </span><span class="si">${</span><span class="nx">config</span><span class="p">.</span><span class="nx">email</span><span class="si">}</span><span class="sb">
</span></span></span><span class="line"><span class="cl"><span class="sb">        lowlimit: </span><span class="si">${</span><span class="nx">config</span><span class="p">.</span><span class="nx">lowLimit</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1">// Create a Google Document with form response data
</span></span></span><span class="line"><span class="cl"><span class="c1"></span><span class="kd">function</span> <span class="nx">createDocumentFromFormData</span><span class="p">(</span><span class="nx">form</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">config</span> <span class="o">=</span> <span class="nx">getConfig</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">ui</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Form response (or test data if debugging)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">grp</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">group</span> <span class="o">?</span> <span class="nx">form</span><span class="p">.</span><span class="nx">group</span> <span class="o">:</span> <span class="s1">&#39;DEBUG TEST GRP [&#39;</span> <span class="o">+</span> <span class="k">new</span> <span class="nb">Date</span><span class="p">()</span> <span class="o">+</span> <span class="s1">&#39;]&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">date</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">date</span> <span class="o">?</span> <span class="nx">form</span><span class="p">.</span><span class="nx">date</span> <span class="o">:</span> <span class="s1">&#39;2022-12-31&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">nb</span> <span class="o">=</span> <span class="nx">form</span><span class="p">.</span><span class="nx">nb</span> <span class="o">?</span> <span class="nb">parseInt</span><span class="p">(</span><span class="nx">form</span><span class="p">.</span><span class="nx">nb</span><span class="p">,</span> <span class="mi">10</span><span class="p">)</span> <span class="o">:</span> <span class="mi">2</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Localized date
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">fdate</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(</span><span class="nx">date</span><span class="p">),</span> <span class="s1">&#39;Europe/Paris&#39;</span><span class="p">,</span> <span class="s1">&#39;dd/MM/yyyy&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Get email of the user executing the script
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">user</span> <span class="o">=</span> <span class="nx">Session</span><span class="p">.</span><span class="nx">getActiveUser</span><span class="p">().</span><span class="nx">getEmail</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">ss</span> <span class="o">=</span> <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActive</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Store the working Sheets
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">vlist</span> <span class="o">=</span> <span class="nx">ss</span><span class="p">.</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s1">&#39;Vouchers&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">used</span> <span class="o">=</span> <span class="nx">ss</span><span class="p">.</span><span class="nx">getSheetByName</span><span class="p">(</span><span class="s1">&#39;Utilisés&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">rows</span> <span class="o">=</span> <span class="nx">vlist</span><span class="p">.</span><span class="nx">getDataRange</span><span class="p">().</span><span class="nx">getValues</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Make a copy of the template Document &amp; store its ID
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">documentId</span> <span class="o">=</span> <span class="nx">DriveApp</span><span class="p">.</span><span class="nx">getFileById</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">templateId</span><span class="p">).</span><span class="nx">makeCopy</span><span class="p">().</span><span class="nx">getId</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Using string interpolation
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">title</span> <span class="o">=</span> <span class="sb">`</span><span class="si">${</span><span class="nx">date</span><span class="si">}</span><span class="sb"> - </span><span class="si">${</span><span class="nx">grp</span><span class="si">}</span><span class="sb"> - </span><span class="si">${</span><span class="nb">Date</span><span class="p">.</span><span class="nx">now</span><span class="p">()</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">docFile</span> <span class="o">=</span> <span class="nx">DriveApp</span><span class="p">.</span><span class="nx">getFileById</span><span class="p">(</span><span class="nx">documentId</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">  <span class="nx">docFile</span><span class="p">.</span><span class="nx">setName</span><span class="p">(</span><span class="nx">title</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Add the docFile to the doc sub-folder
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">DriveApp</span><span class="p">.</span><span class="nx">getFolderById</span><span class="p">(</span><span class="nx">config</span><span class="p">.</span><span class="nx">docFolderId</span><span class="p">).</span><span class="nx">addFile</span><span class="p">(</span><span class="nx">docFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Remove the docFile ref from the current folder
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">docFile</span><span class="p">.</span><span class="nx">getParents</span><span class="p">().</span><span class="nx">next</span><span class="p">().</span><span class="nx">removeFile</span><span class="p">(</span><span class="nx">docFile</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">documentUrl</span> <span class="o">=</span> <span class="sb">`https://docs.google.com/document/d/</span><span class="si">${</span><span class="nx">documentId</span><span class="si">}</span><span class="sb">/edit`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">docBody</span> <span class="o">=</span> <span class="nx">DocumentApp</span><span class="p">.</span><span class="nx">openById</span><span class="p">(</span><span class="nx">documentId</span><span class="p">).</span><span class="nx">getBody</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="nx">docBody</span><span class="p">.</span><span class="nx">replaceText</span><span class="p">(</span><span class="s1">&#39;##Groupe##&#39;</span><span class="p">,</span> <span class="nx">grp</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">docBody</span><span class="p">.</span><span class="nx">replaceText</span><span class="p">(</span><span class="s1">&#39;##Date##&#39;</span><span class="p">,</span> <span class="nx">fdate</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">placeholder</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Store the 1st empty row from the used Sheet before insertion
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">firstRow</span> <span class="o">=</span> <span class="nx">used</span><span class="p">.</span><span class="nx">getLastRow</span><span class="p">()</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Get &amp; move the needed number of Vouchers from the vlist Sheet to the used Sheet,
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="c1">// starting from the end of the list (one by one to timestamp each of them)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">length</span><span class="p">,</span> <span class="nx">j</span> <span class="o">=</span> <span class="mi">1</span><span class="p">,</span> <span class="nx">row</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&gt;=</span> <span class="mi">2</span> <span class="o">&amp;&amp;</span> <span class="nx">j</span> <span class="o">&lt;=</span> <span class="nx">nb</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">,</span> <span class="nx">j</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">row</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">[</span><span class="nx">i</span> <span class="o">-</span> <span class="mi">1</span><span class="p">];</span>
</span></span><span class="line"><span class="cl">    <span class="nx">vlist</span><span class="p">.</span><span class="nx">deleteRow</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">placeholder</span> <span class="o">=</span> <span class="sb">`##voucher</span><span class="si">${</span><span class="nx">j</span><span class="si">}</span><span class="sb">##`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// row[0] is the voucher
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">docBody</span><span class="p">.</span><span class="nx">replaceText</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span> <span class="nx">row</span><span class="p">[</span><span class="mi">0</span><span class="p">]);</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// add the timestamp
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">row</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="nx">Utilities</span><span class="p">.</span><span class="nx">formatDate</span><span class="p">(</span><span class="k">new</span> <span class="nb">Date</span><span class="p">(),</span> <span class="s1">&#39;Europe/Paris&#39;</span><span class="p">,</span> <span class="s1">&#39;yyyy/MM/dd  HH:mm:ss.SSS&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">    <span class="nx">row</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">=</span> <span class="s1">&#39;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Following data need to be written 1 time only
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="k">if</span> <span class="p">(</span><span class="nx">j</span> <span class="o">===</span> <span class="mi">1</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">row</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span> <span class="o">=</span> <span class="nx">fdate</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">row</span><span class="p">[</span><span class="mi">4</span><span class="p">]</span> <span class="o">=</span> <span class="nx">user</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">row</span><span class="p">[</span><span class="mi">5</span><span class="p">]</span> <span class="o">=</span> <span class="nx">grp</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="nx">row</span><span class="p">[</span><span class="mi">6</span><span class="p">]</span> <span class="o">=</span> <span class="nx">documentUrl</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="c1">// Append the row to the used list
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>    <span class="nx">used</span><span class="p">.</span><span class="nx">appendRow</span><span class="p">(</span><span class="nx">row</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Count remaining vouchers en send an alert if &lt;= config.lowlimit
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">rows</span> <span class="o">=</span> <span class="nx">vlist</span><span class="p">.</span><span class="nx">getDataRange</span><span class="p">().</span><span class="nx">getValues</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">vouchersLeft</span> <span class="o">=</span> <span class="nx">rows</span><span class="p">.</span><span class="nx">length</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="p">(</span><span class="nx">vouchersLeft</span> <span class="o">&lt;=</span> <span class="nx">config</span><span class="p">.</span><span class="nx">lowlimit</span><span class="p">)</span> <span class="p">{</span><span class="nx">sendAlertEmail</span><span class="p">(</span><span class="nx">vouchersLeft</span><span class="p">);}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Format inserted data inside the used Sheet (merge - valign - borders - columns auto resize)
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="kd">let</span> <span class="nx">lastRow</span> <span class="o">=</span> <span class="nx">used</span><span class="p">.</span><span class="nx">getLastRow</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">range</span> <span class="o">=</span> <span class="sb">`D</span><span class="si">${</span><span class="nx">firstRow</span><span class="si">}</span><span class="sb">:G</span><span class="si">${</span><span class="nx">lastRow</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// merge &amp; align
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">used</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">range</span><span class="p">).</span><span class="nx">mergeVertically</span><span class="p">().</span><span class="nx">setVerticalAlignment</span><span class="p">(</span><span class="s1">&#39;middle&#39;</span><span class="p">).</span><span class="nx">setHorizontalAlignment</span><span class="p">(</span><span class="s1">&#39;center&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">range</span> <span class="o">=</span> <span class="sb">`A</span><span class="si">${</span><span class="nx">firstRow</span><span class="si">}</span><span class="sb">:G</span><span class="si">${</span><span class="nx">lastRow</span><span class="si">}</span><span class="sb">`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// borders
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">used</span><span class="p">.</span><span class="nx">getRange</span><span class="p">(</span><span class="nx">range</span><span class="p">).</span><span class="nx">setBorder</span><span class="p">(</span><span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">true</span><span class="p">,</span> <span class="kc">null</span><span class="p">,</span> <span class="kc">null</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// autoresize colums
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">used</span><span class="p">.</span><span class="nx">autoResizeColumns</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">7</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  
</span></span><span class="line"><span class="cl">  <span class="c1">// Delete unused placeholders in the Document
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">nb</span> <span class="o">+</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="mi">25</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nx">placeholder</span> <span class="o">=</span> <span class="sb">`##voucher</span><span class="si">${</span><span class="nx">i</span><span class="si">}</span><span class="sb">##`</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">    <span class="nx">docBody</span><span class="p">.</span><span class="nx">replaceText</span><span class="p">(</span><span class="nx">placeholder</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">search</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">tables</span> <span class="o">=</span> <span class="p">[];</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Extract all the tables inside the Document
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="k">while</span> <span class="p">(</span><span class="nx">search</span> <span class="o">=</span> <span class="nx">docBody</span><span class="p">.</span><span class="nx">findElement</span><span class="p">(</span><span class="nx">DocumentApp</span><span class="p">.</span><span class="nx">ElementType</span><span class="p">.</span><span class="nx">TABLE</span><span class="p">,</span> <span class="nx">search</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="nx">tables</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">search</span><span class="p">.</span><span class="nx">getElement</span><span class="p">().</span><span class="nx">asTable</span><span class="p">());</span>
</span></span><span class="line"><span class="cl">  <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="c1">// Delete all empty rows from the Document tables
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">tables</span><span class="p">.</span><span class="nx">forEach</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">table</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="kd">let</span> <span class="nx">trows</span> <span class="o">=</span> <span class="nx">table</span><span class="p">.</span><span class="nx">getNumRows</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Iterate through each row of the table
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="k">for</span> <span class="p">(</span><span class="kd">let</span> <span class="nx">r</span> <span class="o">=</span> <span class="nx">trows</span> <span class="o">-</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">r</span> <span class="o">&gt;=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">r</span><span class="o">--</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="c1">// If the table row contains no text, delete it
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>          <span class="k">if</span> <span class="p">(</span><span class="nx">table</span><span class="p">.</span><span class="nx">getRow</span><span class="p">(</span><span class="nx">r</span><span class="p">).</span><span class="nx">getText</span><span class="p">().</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\s/g</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="o">===</span> <span class="s1">&#39;&#39;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">              <span class="nx">table</span><span class="p">.</span><span class="nx">removeRow</span><span class="p">(</span><span class="nx">r</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">          <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">  <span class="c1">// Show the ready to print Document link in a modal dialog
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>  <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getActive</span><span class="p">().</span><span class="nx">toast</span><span class="p">(</span><span class="sb">`</span><span class="si">${</span><span class="nx">nb</span><span class="si">}</span><span class="sb"> vouchers réservés pour le groupe </span><span class="si">${</span><span class="nx">grp</span><span class="si">}</span><span class="sb"> pour le </span><span class="si">${</span><span class="nx">fdate</span><span class="si">}</span><span class="sb"> par </span><span class="si">${</span><span class="nx">user</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">html</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;&lt;head&gt;&lt;style&gt;* {font-family: &#34;Google Sans&#34;,Roboto,RobotoDraft,Helvetica,Arial,sans-serif;}&lt;/style&gt;&lt;/head&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;body&gt;&lt;h1&gt;&lt;a href=&#34;&#39;</span> <span class="o">+</span> <span class="nx">documentUrl</span> <span class="o">+</span> <span class="s1">&#39;&#34; target=&#34;_blank&#34;&gt;Ouvrir le document&lt;/a&gt;&lt;/h1&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;h3&gt;Une fois ouvert, le document peut être modifié et/ou imprimé.&lt;/h3&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;p&gt;Le lien du document est également accessible via la feuille &#34;Utilisés&#34;.&lt;/p&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;div style=&#34;margin: 80px auto auto 200px;&#34;&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;input type=&#34;button&#34; value=&#34;Fermer&#34; id=&#34;btnclose&#34; onclick=&#34;google.script.host.close();&#34; style=&#34; width: 80px; height: 30px;&#34; /&gt;&lt;/div&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">ui</span> <span class="o">=</span> <span class="nx">HtmlService</span><span class="p">.</span><span class="nx">createHtmlOutput</span><span class="p">(</span><span class="nx">html</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="nx">SpreadsheetApp</span><span class="p">.</span><span class="nx">getUi</span><span class="p">().</span><span class="nx">showModalDialog</span><span class="p">(</span><span class="nx">ui</span><span class="p">,</span> <span class="nx">title</span><span class="p">);</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="kd">function</span> <span class="nx">sendAlertEmail</span><span class="p">(</span><span class="nx">nbleft</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">  <span class="nx">Logger</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="sb">`sendAlertEmail a démarré avec le paramètre nbleft=</span><span class="si">${</span><span class="nx">nbleft</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">subject</span> <span class="o">=</span> <span class="s1">&#39;Alerte CEFIM_PEDAGO Vouchers : Liste épuisée&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="kd">let</span> <span class="nx">body</span> <span class="o">=</span> <span class="s1">&#39;&lt;html&gt;&lt;body&gt;&lt;h1 style=&#34;color: red;&#34;&gt;La liste de vouchers CEFIM_PEDAGO disponibles arrive à épuisement.&lt;/h1&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;h2&gt;Il reste &lt;b&gt;&#39;</span> <span class="o">+</span> <span class="nx">nbleft</span> <span class="o">+</span> <span class="s1">&#39; vouchers disponibles&lt;/b&gt; dans la liste courante.&lt;/h2&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;h3&gt;&lt;p&gt;Options :&lt;/p&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;ul&gt;&lt;li&gt;&lt;a href=&#34;https://46.247.250.13:666//&#34; target=&#34;_blank&#34;&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;Se connecter à l\&#39;inteface web du pfSense CEFIM_PEDAGO afin de générer un nouveau Roll&lt;/a&gt;&lt;/li&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;li&gt;&lt;a href=&#34;https://docs.google.com/spreadsheets/d/12vdKWwv6jeDFzN9X8V79do9gQrcitEgQPXLvzj6H91w&#34; target=&#34;_blank&#34;&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;Ouvrir la liste de secours pour ajout rapide de vouchers&lt;/a&gt;&lt;/li&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;&lt;li&gt;&lt;a href=&#34;https://docs.google.com/spreadsheets/d/16eqNvG-Z5y9pHuQbCb80A3K3q3gIcX9S6Ja_7TwtFZ0/edit#gid=1505767989&#34; target=&#34;_blank&#34;&gt;&#39;</span>
</span></span><span class="line"><span class="cl">    <span class="o">+</span> <span class="s1">&#39;Ouvrir la liste régulière pour vérifications&lt;/a&gt;&lt;/li&gt;&lt;/ul&gt;&lt;/h3&gt;&lt;/body&gt;&lt;/html&gt;&#39;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">  <span class="nx">MailApp</span><span class="p">.</span><span class="nx">sendEmail</span><span class="p">({</span>
</span></span><span class="line"><span class="cl">    <span class="nx">to</span><span class="o">:</span><span class="nx">config</span><span class="p">.</span><span class="nx">email</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">subject</span><span class="o">:</span><span class="nx">subject</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">htmlBody</span><span class="o">:</span><span class="nx">body</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">    <span class="nx">name</span><span class="o">:</span><span class="s1">&#39;CEFIM_PEDAGO - Vouchers alerte&#39;</span>
</span></span><span class="line"><span class="cl">  <span class="p">});</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div><p>Form.html :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">base</span> <span class="nx">target</span><span class="o">=</span><span class="s2">&#34;_top&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">*</span> <span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">family</span><span class="o">:</span> <span class="s2">&#34;Google Sans&#34;</span><span class="p">,</span><span class="nx">Roboto</span><span class="p">,</span><span class="nx">RobotoDraft</span><span class="p">,</span><span class="nx">Helvetica</span><span class="p">,</span><span class="nx">Arial</span><span class="p">,</span><span class="nx">sans</span><span class="o">-</span><span class="nx">serif</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">info</span> <span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span> <span class="mi">14</span><span class="nx">px</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="nx">red</span><span class="p">;</span> <span class="nx">margin</span><span class="o">-</span><span class="nx">bottom</span><span class="o">:</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">p</span> <span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">weight</span><span class="o">:</span> <span class="mi">600</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">label</span> <span class="p">{</span><span class="nx">display</span><span class="o">:</span> <span class="nx">inline</span><span class="o">-</span><span class="nx">block</span><span class="p">;</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">210</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">label</span><span class="o">::</span><span class="nx">after</span> <span class="p">{</span><span class="nx">content</span><span class="o">:</span> <span class="s2">&#34; *&#34;</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="nx">red</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">input</span> <span class="p">{</span><span class="nx">display</span><span class="o">:</span> <span class="nx">inline</span><span class="o">-</span><span class="nx">block</span><span class="p">;</span> <span class="nx">width</span><span class="o">:</span> <span class="mi">260</span><span class="nx">px</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="nx">blue</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">date</span> <span class="p">{</span><span class="nx">width</span><span class="o">:</span> <span class="mi">120</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">nb</span> <span class="p">{</span><span class="nx">width</span><span class="o">:</span> <span class="mi">40</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">sep</span> <span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="p">.</span><span class="nx">msg</span> <span class="p">{</span><span class="nx">display</span><span class="o">:</span> <span class="nx">none</span><span class="p">;</span> <span class="nx">color</span><span class="o">:</span> <span class="nx">red</span><span class="p">;</span> <span class="nx">font</span><span class="o">-</span><span class="nx">size</span><span class="o">:</span> <span class="mi">10</span><span class="nx">px</span><span class="p">;</span> <span class="nx">margin</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span> <span class="mi">110</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">btnsubmit</span><span class="p">,</span> <span class="err">#</span><span class="nx">btncancel</span> <span class="p">{</span><span class="nx">width</span><span class="o">:</span> <span class="mi">210</span><span class="nx">px</span><span class="p">;</span> <span class="nx">margin</span><span class="o">:</span> <span class="mi">0</span> <span class="mi">12</span><span class="nx">px</span> <span class="mi">0</span> <span class="mi">12</span><span class="nx">px</span><span class="p">;</span> <span class="nx">padding</span><span class="o">:</span> <span class="mi">5</span><span class="nx">px</span> <span class="mi">0</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">loading</span> <span class="p">{</span><span class="nx">display</span><span class="o">:</span> <span class="nx">none</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">loadtxt</span> <span class="p">{</span><span class="nx">position</span><span class="o">:</span> <span class="nx">absolute</span><span class="p">;</span> <span class="nx">top</span><span class="o">:</span> <span class="mi">2</span><span class="nx">px</span><span class="p">;</span> <span class="nx">left</span><span class="o">:</span> <span class="mi">2</span><span class="nx">px</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="err">#</span><span class="nx">loadimg</span> <span class="p">{</span><span class="nx">position</span><span class="o">:</span> <span class="nx">relative</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/style&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/head&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;form&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Les</span> <span class="nx">vouchers</span> <span class="nx">CEFIM_PEDAGO</span> <span class="nx">sont</span> <span class="nx">valides</span> <span class="mi">5</span> <span class="nx">jours</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">hr</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;info&#34;</span><span class="o">&gt;*</span> <span class="nx">Requis</span><span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">form</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;resaForm&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&#34;grp&#34;</span><span class="o">&gt;</span><span class="nx">Nom</span> <span class="nx">ou</span> <span class="nx">Groupe</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;text&#34;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;grp&#34;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;group&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;badgrp&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;msg&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Indiquer</span> <span class="nx">un</span> <span class="nx">nom</span> <span class="nx">de</span> <span class="nx">personne</span> <span class="nx">ou</span> <span class="nx">de</span> <span class="nx">groupe</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;sepgrp&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;sep&#34;</span><span class="o">&gt;&lt;</span><span class="nx">p</span><span class="o">&gt;&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/p&gt;&lt;/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&#34;date&#34;</span><span class="o">&gt;</span><span class="nb">Date</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;date&#34;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;date&#34;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;date&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;baddate&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;msg&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Choisir</span> <span class="nx">une</span> <span class="nx">date</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;sepdate&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;sep&#34;</span><span class="o">&gt;&lt;</span><span class="nx">p</span><span class="o">&gt;&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/p&gt;&lt;/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="s2">&#34;nb&#34;</span><span class="o">&gt;</span><span class="nx">Nombre</span> <span class="nx">de</span> <span class="nx">vouchers</span> <span class="p">(</span><span class="mi">1</span><span class="o">-</span><span class="mi">25</span><span class="p">)</span><span class="o">&lt;</span><span class="err">/label&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;number&#34;</span> <span class="nx">min</span><span class="o">=</span><span class="s2">&#34;1&#34;</span> <span class="nx">max</span><span class="o">=</span><span class="s2">&#34;25&#34;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;nb&#34;</span> <span class="nx">name</span><span class="o">=</span><span class="s2">&#34;nb&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;badnb&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;msg&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">          <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="nx">Choisir</span> <span class="nx">un</span> <span class="nx">nombre</span> <span class="nx">entre</span> <span class="mi">1</span> <span class="nx">et</span> <span class="mi">25</span><span class="o">&lt;</span><span class="err">/p&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;sepnb&#34;</span> <span class="kr">class</span><span class="o">=</span><span class="s2">&#34;sep&#34;</span><span class="o">&gt;&lt;</span><span class="nx">p</span><span class="o">&gt;&amp;</span><span class="nx">nbsp</span><span class="p">;</span><span class="o">&lt;</span><span class="err">/p&gt;&lt;/div&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">hr</span> <span class="o">/&gt;&lt;</span><span class="nx">br</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;button&#34;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&#34;Annuler&#34;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;btncancel&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onclick</span><span class="o">=</span><span class="s2">&#34;google.script.host.close();&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="s2">&#34;button&#34;</span> <span class="nx">value</span><span class="o">=</span><span class="s2">&#34;Valider&#34;</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;btnsubmit&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="nx">onclick</span><span class="o">=</span><span class="s2">&#34;submitForm();&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="err">/form&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nb">window</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">      <span class="err">  </span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;grp&#34;</span><span class="p">).</span><span class="nx">focus</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Called right after the form is submited
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kd">function</span> <span class="nx">submitForm</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">err</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">grp</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;grp&#34;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">grp</span> <span class="o">===</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;badgrp&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepgrp&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">err</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;badgrp&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepgrp&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">dat</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;date&#34;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">dat</span> <span class="o">===</span> <span class="s2">&#34;&#34;</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;baddate&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepdate&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">err</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;baddate&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepdate&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="kd">let</span> <span class="nx">num</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;nb&#34;</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">((</span><span class="nx">num</span> <span class="o">&lt;</span> <span class="mi">1</span><span class="p">)</span> <span class="o">||</span> <span class="p">(</span><span class="nx">num</span> <span class="o">&gt;</span> <span class="mi">25</span><span class="p">))</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;badnb&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepnb&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nx">err</span> <span class="o">+=</span> <span class="mi">1</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;badnb&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;none&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">          <span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;sepnb&#34;</span><span class="p">).</span><span class="nx">style</span><span class="p">.</span><span class="nx">display</span> <span class="o">=</span> <span class="s2">&#34;block&#34;</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="p">}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="p">(</span><span class="nx">err</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span><span class="k">return</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">        <span class="nx">google</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">run</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">openLoadingModal</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">        <span class="nx">google</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">run</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">withSuccessHandler</span><span class="p">(</span><span class="nx">onSubmitSuccess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">createDocumentFromFormData</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">getElementById</span><span class="p">(</span><span class="s2">&#34;resaForm&#34;</span><span class="p">));</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Called when the form is successfully submited - google.script.run is asynchronous
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kd">function</span> <span class="nx">onSubmitSuccess</span><span class="p">(</span><span class="cm">/*serverFunctionOutput, userObj*/</span><span class="p">)</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">google</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">run</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">withSuccessHandler</span><span class="p">(</span><span class="nx">onLoadSuccess</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">          <span class="p">.</span><span class="nx">openLoadingModal</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="c1">// Called when the process is finished
</span></span></span><span class="line"><span class="cl"><span class="c1"></span>      <span class="kd">function</span> <span class="nx">onLoadSuccess</span><span class="p">()</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">google</span><span class="p">.</span><span class="nx">script</span><span class="p">.</span><span class="nx">host</span><span class="p">.</span><span class="nx">close</span><span class="p">();</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/script&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/body&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/html&gt;</span>
</span></span></code></pre></div><p>Loading.html :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-javascript" data-lang="javascript"><span class="line"><span class="cl"><span class="o">&lt;!</span><span class="nx">DOCTYPE</span> <span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">base</span> <span class="nx">target</span><span class="o">=</span><span class="s2">&#34;_top&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">style</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">*</span> <span class="p">{</span><span class="nx">font</span><span class="o">-</span><span class="nx">family</span><span class="o">:</span> <span class="s2">&#34;Google Sans&#34;</span><span class="p">,</span><span class="nx">Roboto</span><span class="p">,</span><span class="nx">RobotoDraft</span><span class="p">,</span><span class="nx">Helvetica</span><span class="p">,</span><span class="nx">Arial</span><span class="p">,</span><span class="nx">sans</span><span class="o">-</span><span class="nx">serif</span><span class="p">;}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">img</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">display</span><span class="o">:</span> <span class="nx">block</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">margin</span><span class="o">-</span><span class="nx">left</span><span class="o">:</span> <span class="nx">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">margin</span><span class="o">-</span><span class="nx">right</span><span class="o">:</span> <span class="nx">auto</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">width</span><span class="o">:</span> <span class="mi">90</span><span class="o">%</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">      <span class="nx">h2</span> <span class="p">{</span>
</span></span><span class="line"><span class="cl">        <span class="nx">position</span><span class="o">:</span> <span class="nx">absolute</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">top</span><span class="o">:</span> <span class="mi">2</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">        <span class="nx">left</span><span class="o">:</span> <span class="mi">50</span><span class="nx">px</span><span class="p">;</span>
</span></span><span class="line"><span class="cl">      <span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/style&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/head&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="nx">div</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;loading&#34;</span><span class="o">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">img</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;loadimg&#34;</span> <span class="nx">src</span><span class="o">=</span><span class="s2">&#34;https://lh3.googleusercontent.com/M7YzZMHlX9FO4tQC_o3FbCHXzA1GpYKSmP1h-w0EeGR40CNppuVzEkNZio8lRI9ZwLM=w2400&#34;</span> <span class="nx">title</span><span class="o">=</span><span class="s2">&#34;Loading...&#34;</span> <span class="nx">style</span><span class="o">=</span><span class="s2">&#34;&#34;</span> <span class="o">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="o">&lt;</span><span class="nx">h2</span> <span class="nx">id</span><span class="o">=</span><span class="s2">&#34;loadtxt&#34;</span><span class="o">&gt;</span><span class="nx">Patientez</span> <span class="nx">svp</span><span class="o">&lt;</span><span class="err">/h2&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="o">&lt;</span><span class="err">/div&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="o">&lt;</span><span class="err">/body&gt;</span>
</span></span><span class="line"><span class="cl"><span class="o">&lt;</span><span class="err">/html&gt;</span>
</span></span></code></pre></div>
            <footer class="footline">
            </footer>
          </article>

          </section>        </div>
      </main>
    </div>
    <script src="../../js/clipboard.min.js" defer></script>
    <script src="../../js/perfect-scrollbar.min.js" defer></script>
    <script src="../../js/theme.js" defer></script>
  </body>
</html>
