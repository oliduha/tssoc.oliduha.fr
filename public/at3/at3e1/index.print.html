<!DOCTYPE html>
<html lang="fr" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="description" content="Docs formation Cefim TSSR">
    <meta name="author" content="Olivier Duhamel">
    <title>Configurer serveur de déploiement et de terminaux légers - TSSOC</title>
    <link href="https://www.tssoc.oliduha.fr/at3/at3e1/index.html" rel="canonical" type="text/html" title="Configurer serveur de déploiement et de terminaux légers - TSSOC">
    <link href="../../at3/at3e1/index.xml" rel="alternate" type="application/rss+xml" title="Configurer serveur de déploiement et de terminaux légers - TSSOC">
    <link href="../../images/logo.svg" rel="icon" type="image/svg+xml">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="../../css/fontawesome-all.min.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fontawesome-all.min.css" rel="stylesheet"></noscript>
    <link href="../../css/nucleus.css" rel="stylesheet">
    <link href="../../css/auto-complete.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/auto-complete.css" rel="stylesheet"></noscript>
    <link href="../../css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="../../css/fonts.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../../css/fonts.css" rel="stylesheet"></noscript>
    <link href="../../css/theme.css" rel="stylesheet">
    <link href="../../css/theme-auto.css" rel="stylesheet" id="variant-style">
    <link href="../../css/variant.css" rel="stylesheet">
    <link href="../../css/print.css" rel="stylesheet" media="print">
    <link href="../../css/format-print.css" rel="stylesheet">
    <link href="../../css/ie.css" rel="stylesheet">
    <script src="../../js/url.js"></script>
    <script src="../../js/variant.js"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="../../index.search.js";
      var root_url="../../";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copier dans le presse-papiers';
      window.T_Copied_to_clipboard = 'Copié dans le presse-papiers !';
      window.T_Copy_link_to_clipboard = 'Copier le lien dans le presse-papiers';
      window.T_Link_copied_to_clipboard = 'Lien copié dans le presse-papiers !';
      window.T_No_results_found = 'Aucun résultat trouvé pour \u0022{0}\u0022';
      window.T_N_results_found = '{1} résultats trouvés pour \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/www.tssoc.oliduha.fr/';
      window.variants && variants.init( [ 'auto', 'relearn-bright', 'relearn-light', 'relearn-dark', 'learn', 'neon', 'blue', 'green', 'red' ] );
    </script>
    <style>
      #body img.bg-white {
        background-color: white;
      }
    </style>
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../../at3/at3e1/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../index.html"><span itemprop="name">TSSOC</span></a><meta itemprop="position" content="1"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../../at3/index.html"><span itemprop="name">Maintenir et exploiter une infrastructure distribuée et contribuer à sa sécurisation</span></a><meta itemprop="position" content="2"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Configurer serveur de déploiement et de terminaux légers</span><meta itemprop="position" content="3"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable chapter narrow" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="chapter">
<div class="article-subheading">Chapitre 1</div>
<h1 id="configurer-serveur-de-déploiement-et-de-terminaux-légers">Configurer serveur de déploiement et de terminaux légers</h1>

<hr>
<h4 id="1-wds---mdtat3at3e1wds-mdt">1. <a href="../../at3/at3e1/wds-mdt/">WDS - MDT</a></h4>
<h4 id="2-fogat3at3e1fog">2. <a href="../../at3/at3e1/fog/">FOG</a></h4>
<h4 id="3-stage-armatisat3at3e1stage-armatis">3. <a href="../../at3/at3e1/stage-armatis/">stage Armatis</a></h4>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Sous-sections de Configurer serveur de déploiement et de terminaux légers</h1>
          <article class="chapter">
<div class="article-subheading">Exemple 1</div>
<h1 id="wds---mdt">WDS - MDT</h1>

<hr>
<h1 id="wds">WDS</h1>
<h2 id="window-deployment-system">Window Deployment System</h2>
<p><strong>TP</strong></p>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p>Avec VMWare :</p>
<ul>
<li>1 VM IPFire avec la carte &ldquo;green&rdquo; sur 192.168.13.0/24 en Host Only côté lan</li>
<li>1 VM Windows Server AD-DS + DHCP en Host Only</li>
<li>1 VM Windows CLient vierge en Host Only</li>
</ul>
  </div>
</div>
<hr>
<h2 id="1---serveur-ad-ds-et-dhcp">1 - Serveur AD-DS et DHCP</h2>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<ul>
<li>Une VM Windows Server 2022 avec :
<ul>
<li>3-4 Go Ram</li>
<li>1 DD 40 GO (C:)</li>
<li>1 DD 60 GO (D:)</li>
<li>Host Only en 192.168.13.250/24 (fixe)</li>
<li>Rôle AD-DS puis</li>
<li>Rôle DHCP puis</li>
<li>Rôle WDS</li>
</ul>
</li>
</ul>
  </div>
</div>
<h3 id="installation-des-rôle">Installation des rôle</h3>
<p>Avant d&rsquo;installer le moindre rôle, on s&rsquo;assure de paramétrer le nom de la machine et sa carte réseau en IP fixe (192.168.13.250/24 ici) et on la reboot.</p>
<p>On installe d&rsquo;abord le rôle AD-DS puis promotion en Domain Controler et configuration d&rsquo;une forêt pour notre réseau local.</p>
<p>Ensuite vient le rôle DHCP et sa configuration.</p>
<p>Et enfin le rôle WDS et sa configuration :</p>
<blockquote>
<p>Durant l&rsquo;installation, à l&rsquo;étape de sélection des services de rôle, bien cocher les 2 options :</p>
<ul>
<li><code>Serveur de déploiement</code><br>
et</li>
<li><code>Serveur de transport</code></li>
</ul>
</blockquote>
<h3 id="configuration-initiale-de-wds">Configuration initiale de WDS</h3>
<ul>
<li>Une fois l&rsquo;installation du rôle WDS achevée, dans le  Gestionnaire de serveur, menu Outils, choisir <strong>Services de déploiement Windows</strong></li>
<li>Cliquer droit sur le serveur pour le configurer (il a une icone d&rsquo;alerte).</li>
<li>La 1ère fenêtre rappelle les prérequis pour le service. <em>Suivant</em></li>
<li>Choisir <strong>Intégré à Active Directory</strong>. <em>Suivant</em></li>
<li>Entrer le chemin où les images seront stoquées. Lui indiquer de créer le dossier <code>RemoteInstall</code> à la racine du disque <strong>D:</strong> <em>Suivant</em></li>
<li>Choisir <strong>Répondre à tous les ordinateurs clients (connus et inconnus)</strong>. <em>Suivant</em></li>
<li>Attentre que la configuration se termine et une nouvelle fenêtre apparaît. Ne pas sélectionner &ldquo;Ajouter les images au serveur maintenant&rdquo; et <em>Terminer</em></li>
</ul>
<p>
<a href="#image-7ef42d4d95c53238b31a9e95b2f4202b" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/01_1_Gestionnaire_WDS.png" alt="Gestionnaire_wds" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-7ef42d4d95c53238b31a9e95b2f4202b">
<img src="../../at3/at3e1/wds-mdt/01_1_Gestionnaire_WDS.png" alt="Gestionnaire_wds" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="ajout-dimages">Ajout d&rsquo;images</h2>
<p>Il faut ajouter une image d&rsquo;un Windows qui servira de modèle pour nos futures déploiements :</p>
<ul>
<li>Ouvrir les &ldquo;Settings&rdquo; de la machine virtuelle (dans VMWare) et insérer l&rsquo;iso souhaité dans le lecteur CD-ROm de la VM.</li>
<li>Dans le gestionnaire WDS du serveur, sous le nom de notre serveur : clique droit sur <strong>Images d&rsquo;installation</strong> &gt; <strong>Ajouter une image d&rsquo;installation&hellip;</strong></li>
<li>Créer un groupe d&rsquo;images nommé : <code>nom_du_groupe</code> puis bouton <em>Suivant</em></li>
<li><em>Parcourir</em> puis, dans le dossier <strong>sources</strong> du CD-Rom, sélectionner le fichier <strong>install.wim</strong> et <em>Suivant</em></li>
<li>Si l&rsquo;ISO contient plusieurs versions, sélectionner uniquement celle que l&rsquo;on souhaite en décochant les autres, puis <em>Suivant</em></li>
<li>L&rsquo;assistant nous présente la version choisie, cliquer <em>Suivant</em></li>
<li>Après chargement du fichier, cliquer <em>Terminer</em></li>
</ul>
<p>
<a href="#image-38fe821fc9cf6df11295cd5abb7cd9a1" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/01_2_Image_Install.png" alt="Image_install_ajoutée" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-38fe821fc9cf6df11295cd5abb7cd9a1">
<img src="../../at3/at3e1/wds-mdt/01_2_Image_Install.png" alt="Image_install_ajoutée" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Répéter le même principe pour l&rsquo;image de démarrage qui correspont au fichier <strong>boot.wim</strong> situé dans le même dossier du CD-Rom (pas de groupe ici).</li>
</ul>
<p>
<a href="#image-ebd53278c9bcd20deaabd74dd7066653" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/01_3_Image_Boot.png" alt="Image_boot_ajoutée" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ebd53278c9bcd20deaabd74dd7066653">
<img src="../../at3/at3e1/wds-mdt/01_3_Image_Boot.png" alt="Image_boot_ajoutée" class="lightbox-image" loading="lazy">
</a></p>

<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Remarque</div>
  <div class="box-content">
<p>Pour une machine physique, il est possible que l’image de démarrage ne se charge pas du à une erreur de pilote, nous verrons plus loin comment ajouter des drivers aux services WDS et comment les intégrés aux images de démarrage et de capture.</p>
  </div>
</div>
<hr>
<h2 id="2---client-windows-10-vierge">2 - CLient Windows 10 vierge</h2>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p>Une VM Windows 10 vierge avec :</p>
<ul>
<li>1-2 GO Ram</li>
<li>1 DD de 30 GO</li>
<li>Host Only en DHCP</li>
<li>UEFI <em>(sans problème à partir de WinSrv 2022)</em></li>
<li>Boot en PXE</li>
<li>faire un snapshot pour éviter de recréer une VM pour chacun des tests.</li>
</ul>
  </div>
</div>
<p>Démarrer la machine sans OS ni ISO dans le lecteur CD et attendre qu&rsquo;elle boot en PXE.</p>
<p>Après choix de la langue et authentification (<a href="mailto:user@domaine.lan">user@domaine.lan</a> + mdp), l&rsquo;installation doit démarrer comme avec une version CD ordinaire. Si tout se passe bien l&rsquo;installation se poursuit jusqu&rsquo;à la fin, WDS est fonctionnel !</p>
<hr>
<h2 id="3---optimisation-avec-un-fichier-de-réponses">3 - Optimisation avec un fichier de réponses</h2>
<h5 id="prérequis-">Prérequis :</h5>
<ul>
<li>ADK et son outil WSIM (<strong>Assitant Gestion d&rsquo;Installation</strong>)</li>
<li>Une copie du fichier install.win (l&rsquo;image) de notre version de Windows à configurer</li>
</ul>
<p>
<a href="#image-069ce7787d799f15e70e4fe6a99d7bf7" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/02_1_WDSIM.png" alt="Assistant_Gestion_Installation" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-069ce7787d799f15e70e4fe6a99d7bf7">
<img src="../../at3/at3e1/wds-mdt/02_1_WDSIM.png" alt="Assistant_Gestion_Installation" class="lightbox-image" loading="lazy">
</a></p>
<p>Il faut d&rsquo;abord ouvrir une image Windows : <code>Menu Fichier &gt; Sélectionner l'image Windows</code> et indiquer le fichier <strong>install.wim</strong> puis la verion souhaitée et enfin Valider la création du catalogue. La zone en bas à gauche <em>(Image Windows)</em> doit se peupler.</p>
<p>
<a href="#image-9a9b5f3d28ec64dbb05dd478c396c6dd" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/02_2_Image_Windows.png" alt="WSIM_image_win" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-9a9b5f3d28ec64dbb05dd478c396c6dd">
<img src="../../at3/at3e1/wds-mdt/02_2_Image_Windows.png" alt="WSIM_image_win" class="lightbox-image" loading="lazy">
</a></p>
<h3 id="créer-un-nouveau-fichier-de-réponse">Créer un nouveau fichier de réponse</h3>
<p><strong>Paramètres régionaux</strong></p>
<p>Ajouter les paramètres amd64_Microsoft-Windows-International-Core-WinPE et configurer les propriétés suivantes :</p>
<ul>
<li>InputLocale : fr-FR</li>
<li>SystemLocale : fr-FR</li>
<li>UILanguage : fr-FR</li>
<li>UserLocale : fr-FR</li>
<li>SeteupUILanguage / UILanguage : fr-FR</li>
</ul>
<p><strong>Crédentials WDS</strong></p>
<p>Ajouter le paramètre WindowsDeploymentServices dans amd64_Microsoft-Windows-Setup et configurer les propriétés suivantes :</p>
<ul>
<li>Login / Credentials / Domain</li>
<li>Login / Credentials / Password</li>
<li>Login / Credentials / username</li>
</ul>
<p><strong>Licence et fuseau horaire</strong></p>
<p>Ajouter le paramètre WindowsDeploymentServices dans amd64_Microsoft-Windows-Shell-Setup et configurer les propriétés suivantes :</p>
<ul>
<li>TimeZone : (GMT+01:00) Brussels, Copenhagen, Madrid, Paris</li>
<li>OOBE / HideEULAPage : true</li>
<li>OOBE / NetworkLocation : Work</li>
<li>OOBE / SkipMachineOOBE : true</li>
<li>OOBE / SkipUserOOBE : true</li>
</ul>
<p><strong>Mot de passe de l’administrateur local</strong></p>
<p>Ajouter les paramètres UserAccounts qui se trouve dans amd64_Microsoft-Windows-Shell-Setup et configurer les propriétés suivantes :</p>
<ul>
<li>AdministratorPassword / Value : mot de passe</li>
</ul>
<blockquote>
<p>Enregistrer le fichier de réponse en unatended.xml <em>(par exemple)</em></p>
</blockquote>
<p>Fichier de réponse complet :</p>
<p><code>WDS_w10Pro_unatended.xml</code></p>
<p>
<a href="#image-bd692f514e1a3291b03a3950d7c9859e" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/02_3_WSIM_Comolet.png" alt="WSIM_complet" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-bd692f514e1a3291b03a3950d7c9859e">
<img src="../../at3/at3e1/wds-mdt/02_3_WSIM_Comolet.png" alt="WSIM_complet" class="lightbox-image" loading="lazy">
</a></p>
<p>et son code xml :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;unattend</span> <span class="na">xmlns=</span><span class="s">&#34;urn:schemas-microsoft-com:unattend&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;settings</span> <span class="na">pass=</span><span class="s">&#34;windowsPE&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&#34;Microsoft-Windows-International-Core-WinPE&#34;</span> <span class="na">processorArchitecture=</span><span class="s">&#34;amd64&#34;</span> <span class="na">publicKeyToken=</span><span class="s">&#34;31bf3856ad364e35&#34;</span> <span class="na">language=</span><span class="s">&#34;neutral&#34;</span> <span class="na">versionScope=</span><span class="s">&#34;nonSxS&#34;</span> <span class="na">xmlns:wcm=</span><span class="s">&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;SetupUILanguage&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;UILanguage&gt;</span>fr-FR<span class="nt">&lt;/UILanguage&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/SetupUILanguage&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;InputLocale&gt;</span>fr-FR<span class="nt">&lt;/InputLocale&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;SystemLocale&gt;</span>fr-FR<span class="nt">&lt;/SystemLocale&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UILanguage&gt;</span>fr-FR<span class="nt">&lt;/UILanguage&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UILanguageFallback&gt;</span>fr-FR<span class="nt">&lt;/UILanguageFallback&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UserLocale&gt;</span>fr-FR<span class="nt">&lt;/UserLocale&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/component&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&#34;Microsoft-Windows-Setup&#34;</span> <span class="na">processorArchitecture=</span><span class="s">&#34;amd64&#34;</span> <span class="na">publicKeyToken=</span><span class="s">&#34;31bf3856ad364e35&#34;</span> <span class="na">language=</span><span class="s">&#34;neutral&#34;</span> <span class="na">versionScope=</span><span class="s">&#34;nonSxS&#34;</span> <span class="na">xmlns:wcm=</span><span class="s">&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;DiskConfiguration&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;WillShowUI&gt;</span>OnError<span class="nt">&lt;/WillShowUI&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Disk</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;CreatePartitions&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;CreatePartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>1<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Size&gt;</span>500<span class="nt">&lt;/Size&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Type&gt;</span>Primary<span class="nt">&lt;/Type&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/CreatePartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;CreatePartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>2<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Size&gt;</span>100<span class="nt">&lt;/Size&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Type&gt;</span>EFI<span class="nt">&lt;/Type&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/CreatePartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;CreatePartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>3<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Size&gt;</span>16<span class="nt">&lt;/Size&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Type&gt;</span>MSR<span class="nt">&lt;/Type&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/CreatePartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;CreatePartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>4<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Type&gt;</span>Primary<span class="nt">&lt;/Type&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Extend&gt;</span>true<span class="nt">&lt;/Extend&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/CreatePartition&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/CreatePartitions&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;ModifyPartitions&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ModifyPartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Format&gt;</span>NTFS<span class="nt">&lt;/Format&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Label&gt;</span>WinRE<span class="nt">&lt;/Label&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>1<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;PartitionID&gt;</span>1<span class="nt">&lt;/PartitionID&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;TypeID&gt;</span>DE94BBA4-06D1-4D40-A16A-BFD50179D6AC<span class="nt">&lt;/TypeID&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/ModifyPartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ModifyPartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Format&gt;</span>FAT32<span class="nt">&lt;/Format&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Label&gt;</span>System<span class="nt">&lt;/Label&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>2<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;PartitionID&gt;</span>2<span class="nt">&lt;/PartitionID&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/ModifyPartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ModifyPartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>3<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;PartitionID&gt;</span>3<span class="nt">&lt;/PartitionID&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/ModifyPartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ModifyPartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Format&gt;</span>NTFS<span class="nt">&lt;/Format&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Label&gt;</span>Windows<span class="nt">&lt;/Label&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Letter&gt;</span>C<span class="nt">&lt;/Letter&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>4<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;PartitionID&gt;</span>4<span class="nt">&lt;/PartitionID&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/ModifyPartition&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/ModifyPartitions&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;DiskID&gt;</span>0<span class="nt">&lt;/DiskID&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;WillWipeDisk&gt;</span>true<span class="nt">&lt;/WillWipeDisk&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/Disk&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/DiskConfiguration&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;WindowsDeploymentServices&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Login&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;Credentials&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Domain&gt;</span>wds.local<span class="nt">&lt;/Domain&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Password&gt;</span>1nfr@2022NG<span class="nt">&lt;/Password&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Username&gt;</span>Administrateur<span class="nt">&lt;/Username&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/Credentials&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/Login&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;ImageSelection&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;InstallImage&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Filename&gt;</span>install.wim<span class="nt">&lt;/Filename&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ImageGroup&gt;</span>ImageGroup1<span class="nt">&lt;/ImageGroup&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ImageName&gt;</span>Windows 10 Pro<span class="nt">&lt;/ImageName&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/InstallImage&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;InstallTo&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;DiskID&gt;</span>0<span class="nt">&lt;/DiskID&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;PartitionID&gt;</span>4<span class="nt">&lt;/PartitionID&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/InstallTo&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/ImageSelection&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/WindowsDeploymentServices&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/component&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/settings&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;settings</span> <span class="na">pass=</span><span class="s">&#34;oobeSystem&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&#34;Microsoft-Windows-International-Core&#34;</span> <span class="na">processorArchitecture=</span><span class="s">&#34;amd64&#34;</span> <span class="na">publicKeyToken=</span><span class="s">&#34;31bf3856ad364e35&#34;</span> <span class="na">language=</span><span class="s">&#34;neutral&#34;</span> <span class="na">versionScope=</span><span class="s">&#34;nonSxS&#34;</span> <span class="na">xmlns:wcm=</span><span class="s">&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;InputLocale&gt;</span>fr-FR<span class="nt">&lt;/InputLocale&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;SystemLocale&gt;</span>fr-FR<span class="nt">&lt;/SystemLocale&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UILanguage&gt;</span>fr-FR<span class="nt">&lt;/UILanguage&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UILanguageFallback&gt;</span>fr-FR<span class="nt">&lt;/UILanguageFallback&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UserLocale&gt;</span>fr-FR<span class="nt">&lt;/UserLocale&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/component&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&#34;Microsoft-Windows-Shell-Setup&#34;</span> <span class="na">processorArchitecture=</span><span class="s">&#34;amd64&#34;</span> <span class="na">publicKeyToken=</span><span class="s">&#34;31bf3856ad364e35&#34;</span> <span class="na">language=</span><span class="s">&#34;neutral&#34;</span> <span class="na">versionScope=</span><span class="s">&#34;nonSxS&#34;</span> <span class="na">xmlns:wcm=</span><span class="s">&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;OOBE&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;HideEULAPage&gt;</span>true<span class="nt">&lt;/HideEULAPage&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;HideLocalAccountScreen&gt;</span>true<span class="nt">&lt;/HideLocalAccountScreen&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;HideOEMRegistrationScreen&gt;</span>true<span class="nt">&lt;/HideOEMRegistrationScreen&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;HideOnlineAccountScreens&gt;</span>true<span class="nt">&lt;/HideOnlineAccountScreens&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;HideWirelessSetupInOOBE&gt;</span>true<span class="nt">&lt;/HideWirelessSetupInOOBE&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;ProtectYourPC&gt;</span>1<span class="nt">&lt;/ProtectYourPC&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/OOBE&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UserAccounts&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;AdministratorPassword&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;Value&gt;</span>MQBuAGYAcgBAADIAMAAyADIATgBHAEEAZABtAGkAbgBpAHMAdAByAGEAdABvAHIAUABhAHMAcwB3AG8AcgBkAA==<span class="nt">&lt;/Value&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;PlainText&gt;</span>false<span class="nt">&lt;/PlainText&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/AdministratorPassword&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;LocalAccounts&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;LocalAccount</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Password&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Value&gt;</span>MQBuAGYAcgBAADIAMAAyADIATgBHAFAAYQBzAHMAdwBvAHIAZAA=<span class="nt">&lt;/Value&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;PlainText&gt;</span>false<span class="nt">&lt;/PlainText&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/Password&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;DisplayName&gt;</span>adissoir<span class="nt">&lt;/DisplayName&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Group&gt;</span>Administrateurs<span class="nt">&lt;/Group&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Name&gt;</span>adissoir<span class="nt">&lt;/Name&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/LocalAccount&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/LocalAccounts&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;DomainAccounts&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;DomainAccountList</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Domain&gt;</span>wds.local<span class="nt">&lt;/Domain&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;DomainAccount</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Group&gt;</span>Administrateurs<span class="nt">&lt;/Group&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Name&gt;</span>adissoir<span class="nt">&lt;/Name&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/DomainAccount&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/DomainAccountList&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/DomainAccounts&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/UserAccounts&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;AutoLogon&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Password&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;Value&gt;</span>MQBuAGYAcgBAADIAMAAyADIATgBHAFAAYQBzAHMAdwBvAHIAZAA=<span class="nt">&lt;/Value&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;PlainText&gt;</span>false<span class="nt">&lt;/PlainText&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/Password&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Domain&gt;</span>wds.local<span class="nt">&lt;/Domain&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Enabled&gt;</span>true<span class="nt">&lt;/Enabled&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Username&gt;</span>adissoir<span class="nt">&lt;/Username&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/AutoLogon&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/component&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/settings&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;cpi:offlineImage</span> <span class="na">cpi:source=</span><span class="s">&#34;wim:c:/users/olivier/d/iso/windows_10_pro_cefim_21h2_fev22/sources/install.wim#Windows 10 Pro&#34;</span> <span class="na">xmlns:cpi=</span><span class="s">&#34;urn:schemas-microsoft-com:cpi&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/unattend&gt;</span>
</span></span></code></pre></div><h3 id="ajour-du-fichier-de-réponse-à-wds">Ajour du fichier de réponse à WDS</h3>
<ul>
<li>
<p>Copier le fichier dans le dossier <strong><code>RemoteInstall</code></strong> du serveur WDS.</p>
</li>
<li>
<p>Depuis la console faire un clic droit sur le serveur et cliquer sur <code>Propriétés</code> &gt; onglet <code>Client</code> et ajouter le fichier de réponse aux 2 sections de l&rsquo;architecture adéquate (x86 ou x64) normale et UEFI. Puis Valider.</p>
</li>
</ul>
<p>
<a href="#image-f9127ad2ec4f741e9acd497d74f3712f" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/03_1_Propri%C3%A9t%C3%A9s_WDS_Clients.png" alt="Propriétés_WDS_Clients" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-f9127ad2ec4f741e9acd497d74f3712f">
<img src="../../at3/at3e1/wds-mdt/03_1_Propri%C3%A9t%C3%A9s_WDS_Clients.png" alt="Propriétés_WDS_Clients" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Clique droit sur l&rsquo;image et <code>Propriétés</code>. Sélectionner <code>Autoriser l'image à s'installer en mode sans assistance</code> et <code>Selectionner un fichier...</code> pour indiquer le fichier de réponse. Valider.</li>
</ul>
<p>
<a href="#image-819a87a5c53dc08215693b1c49fcb220" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/03_2_Propri%C3%A9t%C3%A9s_Image.png" alt="Propriétés_Image" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-819a87a5c53dc08215693b1c49fcb220">
<img src="../../at3/at3e1/wds-mdt/03_2_Propri%C3%A9t%C3%A9s_Image.png" alt="Propriétés_Image" class="lightbox-image" loading="lazy">
</a></p>
<blockquote>
<p>Tester le fichier de réponse</p>
</blockquote>
<hr>
<h3 id="ajout-de-pilotes-pour-des-machines-réelleshttpsrdr-itcomwds-installation-et-configuration9"><a href="https://rdr-it.com/wds-installation-et-configuration/9/" target="_blank">Ajout de pilotes pour des machines réelles</a></h3>
<hr>
<h2 id="créer-une-image-de-capture">Créer une image de capture</h2>
<p>Pour créer une capture d&rsquo;une VM existante, il faut préparer le serveur et la machine à capturer.</p>
<p><em><code>Sur le serveur WDS</code></em> :</p>
<p>Ajouter une image de capture (boot) sur le serveur :</p>
<p>Cliquer droit sur l&rsquo;image de boot créée précédemment et choisir <strong>Créer une image de capture&hellip;</strong> ; lui donner un nom (capture), une description et lui indiquer le chemin du dossier partagé du serveur et un nom de fichier : <code>D:\RemoteInstall\WdsClientUnattend\capture.wim</code>.</p>
<p>
<a href="#image-adfb5e36df3dc90ac974a5a584a3cde5" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/04_capture_wim.png" alt="capture.wim" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-adfb5e36df3dc90ac974a5a584a3cde5">
<img src="../../at3/at3e1/wds-mdt/04_capture_wim.png" alt="capture.wim" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-e663575dcc7624f792d7af8a3f4ee584" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/05_capture_image_boot.png" alt="capture_image_boot.png" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-e663575dcc7624f792d7af8a3f4ee584">
<img src="../../at3/at3e1/wds-mdt/05_capture_image_boot.png" alt="capture_image_boot.png" class="lightbox-image" loading="lazy">
</a></p>
<p><em><code>Sur la machine à capturer</code></em> :</p>
<ul>
<li>
<p>Aller dans le dossier <code>C:\Windows\system32\sysprep</code> et exécuter <code>sysprep.exe</code></p>
</li>
<li>
<p>Dans la fenêtre de sysprep, sélectionner <strong>Audit</strong> et <strong>ne pas cocher Generalize</strong>, et <strong>Redémarrer</strong> puis Valider.</p>
</li>
</ul>
<p>Sysprep prépare la machine puis la reboot. Une fois redémarrée, installer sur la machine les logiciels à intégrer à l&rsquo;image qui sera capturée.</p>
<p>Une fois tous les logiciels souhaités installés, relancer l&rsquo;outil <code>sysprep</code> en choisissant <strong>OOBE</strong>, <strong>Generalize</strong> et <strong>Eteindre</strong> (<code>ne pas choisir redémarrer</code> ici, car la machine devra booter en PXE au prochain démarrage).</p>
<ul>
<li>À la fin de l&rsquo;opération, la machine doit s&rsquo;éteindre. La redémarrer en forçant le boot sur le firmware (BIOS/UEFI - avec l&rsquo;option de démarrage <code>Power On to Firmware</code> de VMWare), et choisir le démarrage <code>Network</code> (PXE) pour que le serveur puisse l&rsquo;intercepter.</li>
</ul>
<p>Si demandé durant le boot PXE, appuyer sur F12 ou Entrée puis choisir l&rsquo;option de boot <strong>capture</strong>.</p>
<p>L&rsquo;Assistant de Capture d&rsquo;image des services de déploiement Windows affiche une fenêtre de démarrage, cliquer <code>Suivant &gt;</code>.</p>
<ul>
<li>
<p>1 - <code>Répertoire à capturer</code></p>
<ul>
<li>Volume : <strong>C:\</strong></li>
<li>Nom de l&rsquo;image : Un nom pour l&rsquo;image capturée (<strong>win10master</strong>)</li>
<li>Description de l&rsquo;image (<strong>Windows 10 - Master</strong>)</li>
<li>Cliquer <code>Suivant &gt;</code></li>
</ul>
</li>
<li>
<p>2 - <code>Nouvel emplacement de l'image</code></p>
<ul>
<li>Nom et emplacement : Parcourir : <strong>C:\Users\Public\Documents\</strong> et <code>win10master</code> (.wim automatiquement ajouté).</li>
<li><strong>Cocher</strong> Charger l&rsquo;image sur un serveur[&hellip;]</li>
<li>Nom du serveur : Le nom ou l&rsquo;adresse IP du serveur (<strong>winsrv22wds</strong>) puis <code>Connexion</code>
Se rendre sur le serveur &gt; AD Utilisateurs et Ordinateurs et Propriétés de l&rsquo;utilisateur <code>Administrateur</code>, onglet Compte : indiquer <strong>administrateur</strong> et domaine (<strong>wds.local</strong>) puis valider
<ul>
<li>Nom d&rsquo;utilisateur : <strong><a href="mailto:administrateur@wds.local">administrateur@wds.local</a></strong></li>
<li>Mot de passe : Le mote de passe de l&rsquo;administrateur du serveur</li>
<li><code>OK</code></li>
</ul>
</li>
<li>Si la connexion réussit, les groupes d&rsquo;images du serveur sont chargées dans la liste déroulante : choisir celle souhaitée.</li>
<li>Cliquer <code>Suivant &gt;</code></li>
</ul>
</li>
<li>
<p>3 - La capture de l&rsquo;image démarre</p>
</li>
<li>
<p>4 - Une fois terminé, Cliquer <code>Terminer</code></p>
</li>
</ul>
<p>
<a href="#image-9f77a454744daaf67959e312c0e3f0c0" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/07_machine_capture.png" alt="machine_capture" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-9f77a454744daaf67959e312c0e3f0c0">
<img src="../../at3/at3e1/wds-mdt/07_machine_capture.png" alt="machine_capture" class="lightbox-image" loading="lazy">
</a></p>
<p>La machine redémarre et la nouvelle image d&rsquo;installation apparaît dans le groupe choisi du Gestionnaire WDS sur le serveur.</p>
<p>Il ne reste plus qu&rsquo;à lui créer son propre fichier de réponse à partir d&rsquo;une copie du 1er ficher dont on modifie uniquement les propriétés propres à l&rsquo;image WDS (Nom, Groupe et Nom de fichier), copier de xml sur le serveur dans <code>RemoteInstall\WdsClientUnattend\</code> et l&rsquo;affecter à la nouvelle image par ses propriétés.</p>
<p>
<a href="#image-ecb60021c9be9bc0fb7cc56fb6ee9a68" class="lightbox-link">
<img src="../../at3/at3e1/wds-mdt/08_capture_ready_to_deploy.png" alt="capture_ready_to_deploy" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ecb60021c9be9bc0fb7cc56fb6ee9a68">
<img src="../../at3/at3e1/wds-mdt/08_capture_ready_to_deploy.png" alt="capture_ready_to_deploy" class="lightbox-image" loading="lazy">
</a></p>
<p>Lors du prochain déploiement, une nouvelle fenêtre apparaitra permettant de choisir l&rsquo;image à déployer et proposant notre image nouvellement crée. Si le fichier de réponse est correct, l&rsquo;installation se poursuivra sans intervention jusqu&rsquo;au 1er login du système.</p>
<hr>
<h2 id="ajout-de-logiciel-via-une-gpo-dans-ad">Ajout de logiciel via une GPO dans AD</h2>
<p>Il faut, en 1er lieu, intégrer la machine au domaine, et la placer dans une UO (par ex : <code>Ordinateurs</code>). Puis créer un dossier partagé accessible à tous les ordinateurs du domaine et tous les utilisateurs du domaine en Lecture et y placer le logiciel à déployer.</p>
<p>Dans la console Gestion des stratégies de groupe, créer une nouvelle GPO sur cette UO :
Configuration ordinateur/Stratégies/Paramètres du logiciel/ clique droit sur Installation de logiciel &gt; Nouveau &gt; Package&hellip;</p>
<p>Indiquer l&rsquo;emplacement du logiciel <strong>sur le réseau</strong> (ex : \WINSRV22WDS\Share) puis à l&rsquo;onglet <code>Déploiement</code> indiquer le type <strong>Attribué</strong>. Valider et fermer le gestionnaire de GPO.</p>
<p>Patienter quelques minutes, le logiciel devrait s&rsquo;installer sur les postes présents dans l&rsquo;UO concernée.</p>
<p><em>Il est toujours possible de forcer la mise à jour des stratégies via un terminal sur le poste client :</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">gpupdate /Force
</span></span></code></pre></div><hr>
<h1 id="mdt">MDT</h1>
<h2 id="microsoft-deployment-toolkit">Microsoft Deployment Toolkit</h2>
<h2 id="1-déployer-windows-avec-wds-et-mdthttpsrdr-itcomdeployer-windows-avec-mdt-et-wds">1. <a href="https://rdr-it.com/deployer-windows-avec-mdt-et-wds/" target="_blank">Déployer Windows avec WDS et MDT</a></h2>
<h2 id="2-mdt--utilisation-avec-une-base-de-donnéeshttpsrdr-itcommdt-utilisation-base-de-donnees">2. <a href="https://rdr-it.com/mdt-utilisation-base-de-donnees/" target="_blank">MDT : utilisation avec une base de données</a></h2>
<h2 id="3-mdt-installation-des-applications-lors-du-déploiement-de-windowshttpsrdr-itcommdt-installation-des-applications-lors-du-deploiement-de-windows">3. <a href="https://rdr-it.com/mdt-installation-des-applications-lors-du-deploiement-de-windows/" target="_blank">MDT installation des applications lors du déploiement de Windows</a></h2>
<h2 id="4-mdt--personnaliser-les-fenetres-de-lassistant-winpe-ltihttpsrdr-itcommdt-personnaliser-les-fenetres-de-lassistant-winpe-lti">4. <a href="https://rdr-it.com/mdt-personnaliser-les-fenetres-de-lassistant-winpe-lti/" target="_blank">MDT : personnaliser les fenetres de l’assistant WinPE (LTI)</a></h2>
<hr>
<h2 id="les-bonnes-pratiques-itil-lors-de-vos-déploiementshttpsopenclassroomscomfrcourses2013451-mettez-en-place-les-bonnes-pratiques-itil-lors-de-vos-deploiements"><a href="https://openclassrooms.com/fr/courses/2013451-mettez-en-place-les-bonnes-pratiques-itil-lors-de-vos-deploiements" target="_blank">Les bonnes pratiques ITIL lors de vos déploiements</a></h2>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="chapter">
<div class="article-subheading">Exemple 2</div>
<h1 id="fog">FOG</h1>

<hr>
<h2 id="-fog-projecthttpsfogprojectorg">&gt; <a href="https://fogproject.org/" target="_blank">FOG Project</a></h2>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p>TP : On crée 4 VMs dans un réseau en &ldquo;Host Only&rdquo; :</p>
<ul>
<li>1 IPFire avec 2 cartes réseau qui ont des adresses MAC différentes.
<ul>
<li>1 carte RED en Bridge vers l&rsquo;extérieur du réseau (DHCP ou fixe)</li>
<li>1 carte GREEN en Host Only comme passerelle du réseau H.O. en 192.168.13.254 fixe</li>
</ul>
</li>
<li>1 Debian 11 en Serveur FOG (DD 60 GO) en Host Only en 192.168.13.222 fixe - Serveur DHCP ! (+ TFTP &amp;  iPXE)</li>
<li>1 Poste &ldquo;Master&rdquo; Windows 10 en H.O. DHCP</li>
<li>1 Poste sans OS (config pour win10 - DD &gt;= au master)</li>
</ul>
  </div>
</div>
<p>
<a href="#image-0174fd912a27f888e53c642635150736" class="lightbox-link">
<img src="../../at3/at3e1/fog/00_schema_reseau.png" alt="reseau" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-0174fd912a27f888e53c642635150736">
<img src="../../at3/at3e1/fog/00_schema_reseau.png" alt="reseau" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h2 id="1---ipfire">1 - IPFire</h2>
<p>Télécharger l&rsquo;ISO et en faire une VM.</p>
<p>Doc : <a href="https://wiki.ipfire.org/installation" target="_blank">Installation d&rsquo;IPFire</a> ou sur <a href="https://neptunet.fr/ipfire-install/" target="_blank">neptunet</a></p>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<blockquote>
<p>Ne pas activer le DHCP et configurer les cartes réseau comme demandé (noter les adresses MAC de chaque carte pour bien les différencier)</p>
</blockquote>
  </div>
</div>
<p>
<a href="#image-addfcbdded91ef5b3da7a04c37549684" class="lightbox-link">
<img src="../../at3/at3e1/fog/01_ipfire.png" alt="IPFire" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-addfcbdded91ef5b3da7a04c37549684">
<img src="../../at3/at3e1/fog/01_ipfire.png" alt="IPFire" class="lightbox-image" loading="lazy">
</a></p>
<blockquote>
<p>En cas de besoin, on peux entrer dans la configuration d&rsquo;IPFire à posteriori via la commande :</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">setup
</span></span></code></pre></div><hr>
<h2 id="2---fog">2 - FOG</h2>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p>Bien être en <strong>Bridge</strong> jusqu&rsquo;à la fin du téléchargement, puis repasser en <strong>Host Only AVANT</strong> de lancer l&rsquo;installation !</p>
  </div>
</div>

<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Remarque</div>
  <div class="box-content">
<p><em>Une doc en ligne sur <a href="https://chrtophe.developpez.com/tutoriels/deploiement-fogproject/" target="_blank">https://chrtophe.developpez.com/tutoriels/deploiement-fogproject/</a></em></p>
  </div>
</div>
<p>Partir d&rsquo;une debian 11 vierge.</p>
<p>Se logger en root :</p>
<p><strong>Configurer IP Fixe, masque (192.168.13.222/24) et gateway (192.168.13.254)</strong></p>
<p>Puis :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install git -y
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /root
</span></span><span class="line"><span class="cl">git clone https://github.com/fogproject/fogproject.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> fogproject-dev-branch
</span></span></code></pre></div>
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Remarque</div>
  <div class="box-content">
<p>Pour debian 11 il faut passer sur la dev-branch (pour la version actuelle 1.5.9)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git checkout dev-branch
</span></span></code></pre></div>  </div>
</div>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p>Passer la carte réseau en Host Only <strong>MAINTENANT</strong> !</p>
  </div>
</div>
<p>Installation :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> bin
</span></span></code></pre></div><p>&hellip;si toujours dans /root/fogproject-dev-branch ; sinon : <code>cd /root/fogproject-dev-branch/bin</code></p>
<p>puis</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./installfog.sh
</span></span></code></pre></div>
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p><em>Les réponses en MAJUSCULES sont celles par défaut</em></p>
  </div>
</div>
<p><strong><code>Choisir : Debian</code></strong></p>
<p><strong><code>Choisir : installation Normale</code></strong></p>
<p><strong><code>Configurer l'IP</code></strong></p>
<p><strong><code>Ne pas changer la carte réseau par défaut</code></strong></p>
<p><strong><code>Activer DNS et DHCP</code></strong></p>
<p><strong><code>Installer les packs de langues</code></strong></p>
<p><strong><code>Activer HTTPS</code></strong></p>
<p><strong><code>Renommer la machine si besoin (Hostname)</code></strong></p>
<p>Récap. + validation =&gt; le script d&rsquo;install se lance&hellip;</p>
<p>Lorque c&rsquo;est terminé, il affiche une URL qu&rsquo;il demande d&rsquo;ouvrir dans le navigateur avant de pouvoir finaliser l&rsquo;install : <code>https://ip_du_serveur/fog/management</code></p>
<p>Une fois l&rsquo;url ouverte dans le navigateur de notre hôte (la machine qui fait tourner VMWare) on doit cliquer <code>Install/Update Database</code>.</p>
<p>
<a href="#image-ead7b4a0f5901a4a2c69ebe5c44644b3" class="lightbox-link">
<img src="../../at3/at3e1/fog/02_1_Fog_Validate_Database.png" alt="Fog_Validate_Database" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ead7b4a0f5901a4a2c69ebe5c44644b3">
<img src="../../at3/at3e1/fog/02_1_Fog_Validate_Database.png" alt="Fog_Validate_Database" class="lightbox-image" loading="lazy">
</a></p>
<p>On peut ensuite retourner sur la VM FOG pour finaliser l&rsquo;installation avec &ldquo;Entrée&rdquo;.</p>
<p>
<a href="#image-f139018fc29e900d03096affa3849215" class="lightbox-link">
<img src="../../at3/at3e1/fog/02_2_Fog_Install_End.png" alt="Fog_Install_End" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-f139018fc29e900d03096affa3849215">
<img src="../../at3/at3e1/fog/02_2_Fog_Install_End.png" alt="Fog_Install_End" class="lightbox-image" loading="lazy">
</a></p>
<p>Il faut ensuite se rendre dans le navigateur à <code>https://ip_du_serveur/fog/</code></p>
<p>&hellip;et se logger avec <strong><code>fog/password</code></strong> <em>(par défaut)</em> pour atterrir sur le Dashboard de FOG.</p>
<p>
<a href="#image-5e333ae575f68a5c23a1c678c75ff3ca" class="lightbox-link">
<img src="../../at3/at3e1/fog/02_3_fog_dashboard.png" alt="Dashboard FOG" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-5e333ae575f68a5c23a1c678c75ff3ca">
<img src="../../at3/at3e1/fog/02_3_fog_dashboard.png" alt="Dashboard FOG" class="lightbox-image" loading="lazy">
</a></p>
<h3 id="serveur-dhcp">Serveur DHCP</h3>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p><strong>Il faut impérativement désactiver tout DHCP présent sur le réseau local.</strong> Ici c&rsquo;est notre serveur FOG qui servira de DHCP.<br>
<em>Si ce n&rsquo;est pas possible, le client lors du boot PXE demandera l&rsquo;IP du serveur TFTP, il faudra indiquer l&rsquo;IP de FOG</em></p>
  </div>
</div>
<h3 id="désinstallationreconfiguration-de-fog">Désinstallation/Reconfiguration de fog</h3>
<p>En cas d&rsquo;erreur ou simplement de besoin de reconfiguration du serveur FOG, il suffit de renommer le fichier .fogsettings situé dans le dossier /opt/fog/</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mv /opt/fog/.fogsettings /opt/fog/fogsettings.bak
</span></span></code></pre></div><p>On peut ensuite relancer le script shell d&rsquo;installation</p>
<p><strong>En Production il est important de créer un nouvel utilisateur pour remplacer celui par défaut qui doit être ensuite désactivé.</strong></p>
<hr>
<h2 id="3---enregistrement-et-inventaire-du-master">3 - Enregistrement et inventaire du Master</h2>
<hr>
<blockquote>
<p>Un master est une machine qui servira de modèle pour le déploiement sur les autres postes. Elle doit avoir un OS installé et configuré de manière générique (réseau en DHCP&hellip;) et peut contenir des logiciels et/ou des scripts à répliquer sur toutes les autres machines.<br>
<em>Les possibilités de FOG dans ce domaine en font un outil très puissant</em>.</p>
</blockquote>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p><strong>Ne PAS spécifier de domaine dans le master ! Celui-ci devra être intégré post-déploiement, machine par machine, avec nom utilisateur, mdp, et en forçant le reboot.</strong></p>
  </div>
</div>
<p>Pour enregistrer un poste de travail dans fog, il faut le faire démarrer sur la carte réseau en PXE (Network boot dans le bios ou UEFI de la machine).</p>
<p>
<a href="#image-c6f7d7189767b2bcbc1defc0ba98d585" class="lightbox-link">
<img src="../../at3/at3e1/fog/03_vmw_master_bios_pxe.png" alt="Config_Bios" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-c6f7d7189767b2bcbc1defc0ba98d585">
<img src="../../at3/at3e1/fog/03_vmw_master_bios_pxe.png" alt="Config_Bios" class="lightbox-image" loading="lazy">
</a></p>
<blockquote>
<p><em>Une autre méthode pour inventorier le Master (uniquement) automatiquement est d&rsquo;y installer le &ldquo;FOG client smart installer&rdquo; au préalable, en lui spécifiant l&rsquo;IP du serveur FOG à l&rsquo;install.</em></p>
<p><em>Le poste sera alors reconnu et inventorié automatiquement après un redémarrage ordinaire.</em></p>
<p><em>Autre avantage de cette méthode, le client sera intégré à l&rsquo;image de déploiement !</em></p>
<p><em>SmartInstaller à télécharger sur</em> <strong><a href="https://github.com/FOGProject/fog-client/releases" target="_blank">https://github.com/FOGProject/fog-client/releases</a></strong></p>
</blockquote>
<p>Lors du boot PXE, la machine est interceptée par FOG et arrive sur un menu spécifique :</p>
<p>
<a href="#image-50fe88c5ff700e6ed17d7d8c2b8a8ba4" class="lightbox-link">
<img src="../../at3/at3e1/fog/04_1_vwm_master_fog_menu_1.png" alt="Menu_Fog_unregistered" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-50fe88c5ff700e6ed17d7d8c2b8a8ba4">
<img src="../../at3/at3e1/fog/04_1_vwm_master_fog_menu_1.png" alt="Menu_Fog_unregistered" class="lightbox-image" loading="lazy">
</a></p>
<p>Sélectionner <strong><code>Quick Registration and Inventory</code></strong> pour lancer la procédure d&rsquo;enregistrement de la machine qui va se dérouler sans autre intervention, et après un reboot, revenir à ce menu en indiquant le nom qui lui a été affecté par FOG, en en-têtte <em>(peut être son adresse MAC)</em> :</p>
<p>
<a href="#image-56f4053282d8e36a8dffa12de6ea8f80" class="lightbox-link">
<img src="../../at3/at3e1/fog/04_2_vwm_master_fog_menu_2.png" alt="Menu_fog_registered" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-56f4053282d8e36a8dffa12de6ea8f80">
<img src="../../at3/at3e1/fog/04_2_vwm_master_fog_menu_2.png" alt="Menu_fog_registered" class="lightbox-image" loading="lazy">
</a></p>
<p>On peut vérifier dans l&rsquo;interface web de FOG que la machine est enregistrée en cliquant l&rsquo;icone <strong>Hosts</strong> dans la barre du haut puis <strong>List All Hosts</strong> dans le menu de gauche.</p>
<p>
<a href="#image-2d6981eeee20955707a026e0f01bcc94" class="lightbox-link">
<img src="../../at3/at3e1/fog/05_1_fog_host_master.png" alt="Fog_hosts_master" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-2d6981eeee20955707a026e0f01bcc94">
<img src="../../at3/at3e1/fog/05_1_fog_host_master.png" alt="Fog_hosts_master" class="lightbox-image" loading="lazy">
</a></p>
<p>On peut changer ses nom et description en cliquant dessus :</p>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p><strong>Ne pas oublier de valider chaque action effectuée dans l&rsquo;interface web</strong></p>
  </div>
</div>
<p>
<a href="#image-a06a814d8b14148c71c195ceb5bf99fa" class="lightbox-link">
<img src="../../at3/at3e1/fog/05_2_fog_host_master_details.png" alt="Fog_hosts_master_details" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-a06a814d8b14148c71c195ceb5bf99fa">
<img src="../../at3/at3e1/fog/05_2_fog_host_master_details.png" alt="Fog_hosts_master_details" class="lightbox-image" loading="lazy">
</a></p>
<h3 id="4---capture-de-limage-du-master">4 - Capture de l&rsquo;image du Master</h3>
<p><strong>On doit ensuite faire une <em>image</em> de notre master&hellip; Mais avant, il faut créer un conteneur pour la stocker.</strong></p>
<p>Il faut donc cliquer sur l&rsquo;icone <strong>Images</strong> <em>(barre du haut)</em> puis <strong>Create New Image</strong> <em>(menu de gauche)</em> et lui donner un nom explicite. Il faut également lui spécifier le système d&rsquo;exploitation ainsi que le type d&rsquo;image.</p>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p>Pour une image windows 10 il faut choisir l&rsquo;option 3 (ou 2 si 1 seul dd) : <strong>Multiple partition image - All disks (not resizable)</strong></p>
  </div>
</div>
<p>
<a href="#image-dd88007788db9a4b42e752547357852e" class="lightbox-link">
<img src="../../at3/at3e1/fog/06_1_fog_image_master_details.png" alt="Master_Image" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-dd88007788db9a4b42e752547357852e">
<img src="../../at3/at3e1/fog/06_1_fog_image_master_details.png" alt="Master_Image" class="lightbox-image" loading="lazy">
</a></p>
<p>Ce qui donne :</p>
<p>
<a href="#image-adf1b9552d849b00b34fe65818ccd94e" class="lightbox-link">
<img src="../../at3/at3e1/fog/06_2_fog_images_master.png" alt="Imges" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-adf1b9552d849b00b34fe65818ccd94e">
<img src="../../at3/at3e1/fog/06_2_fog_images_master.png" alt="Imges" class="lightbox-image" loading="lazy">
</a></p>
<p>Nous pouvons à présent créer une tâche de capture assignée à notre master : de retours sur la page <strong>Host Management</strong> cliquer sur le nom du master pour lui indiquer le conteneur où stocker l&rsquo;image à la ligne <strong>Host image</strong>. Sélectionner ensuite <strong>Basic Tasks</strong> dans les onglets juste au-dessus et enfin l&rsquo;icone <strong>Capture</strong> :</p>
<p>
<a href="#image-ca3c728dd6887d21b8c40a5c82b2489b" class="lightbox-link">
<img src="../../at3/at3e1/fog/07_1_fog_host_task.png" alt="Master_Capture" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ca3c728dd6887d21b8c40a5c82b2489b">
<img src="../../at3/at3e1/fog/07_1_fog_host_task.png" alt="Master_Capture" class="lightbox-image" loading="lazy">
</a></p>
<p>Dans la fenêtre suivante, sélectionner <strong>Wake On Lan</strong> et <strong>Schedule Instant</strong>. Valider.</p>
<p>La tâche doit apparaître dans la page Task Management acessible via l&rsquo;icone <strong>Tasks</strong> <em>(barre du haut)</em> &gt; <strong>Active Tasks</strong> <em>(menu de gauche)</em>. On peut également suivre sont avancement à cet endroit.</p>
<p>Il suffit désormais de (re)démarrer la VM master en PXE pour obtenir le menu FOG et y choisir l&rsquo;option <strong>Capture</strong> pour démarrer la procédure automatique :</p>
<p>
<a href="#image-3855cfd23539a5c1ba7efd487e641efd" class="lightbox-link">
<img src="../../at3/at3e1/fog/07_2_master_capture.png" alt="Master_Capture_VM" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-3855cfd23539a5c1ba7efd487e641efd">
<img src="../../at3/at3e1/fog/07_2_master_capture.png" alt="Master_Capture_VM" class="lightbox-image" loading="lazy">
</a></p>
<p>Opération qu&rsquo;on peut donc aussi suivre sur l&rsquo;interface web (et donc à distance) :</p>
<p>
<a href="#image-1c4f73432850cbbaf9722314c400e578" class="lightbox-link">
<img src="../../at3/at3e1/fog/07_3_fog_master_capture.png" alt="Master_Capture_Fog" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1c4f73432850cbbaf9722314c400e578">
<img src="../../at3/at3e1/fog/07_3_fog_master_capture.png" alt="Master_Capture_Fog" class="lightbox-image" loading="lazy">
</a></p>
<p>Une fois l&rsquo;opération terminée, l&rsquo;image est disponible pour déploiement&hellip;</p>
<p>
<a href="#image-3471cb9215682d5e44911a23ebbbfc99" class="lightbox-link">
<img src="../../at3/at3e1/fog/07_4_Master_capture_done.png" alt="Master_Capture_Done" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-3471cb9215682d5e44911a23ebbbfc99">
<img src="../../at3/at3e1/fog/07_4_Master_capture_done.png" alt="Master_Capture_Done" class="lightbox-image" loading="lazy">
</a></p>
<p>À ce stade, nous n&rsquo;avons plus besoin de la machine Master. On peut lui remettre son mode de boot précédent et/ou l&rsquo;éteindre.</p>
<hr>
<h2 id="déploiement">Déploiement</h2>
<blockquote>
<p>Nous n&rsquo;allons ici déployer l&rsquo;image créée précédemment que sur une seule machine ; dans le cas d&rsquo;un déploiement sur un parc entier, nous stockerions nos enregistrements de machines dans un groupe afin de l&rsquo;effectuer en une seule opération.</p>
</blockquote>
<p>Nous créons une VM en Host Only, sans OS mais configurée pour recevoir un Windows 10 et avec au moins autant de capacité de disque dur que le master.</p>
<p>Les machines cibles du déploiement doivent au préalable être enregistrées et inventoriées dans FOG par la même procédure que pour le Master (boot en PXE et Quick registration and Inventory).</p>
<p>
<a href="#image-4110266e2c66617f63799c2d2784d984" class="lightbox-link">
<img src="../../at3/at3e1/fog/08_vmw_client_apres_enreg.png" alt="VMW_Client_Inventaire" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-4110266e2c66617f63799c2d2784d984">
<img src="../../at3/at3e1/fog/08_vmw_client_apres_enreg.png" alt="VMW_Client_Inventaire" class="lightbox-image" loading="lazy">
</a></p>
<p>Une fois notre machine inventoriée, on clique sur <strong>Hosts</strong> <em>(barre du haut)</em>, <strong>List All Hosts</strong> <em>(menu de gauche)</em> puis sur notre nouvelle machine pour la renommer et lui spécifier notre image précédemment créée <em>(Host image)</em>. Enfin on clique sur <strong>Basic Tasks</strong> <em>(onglet)</em> et l&rsquo;icone <strong>Deploy</strong> puis les options <strong>Wake On Lan</strong> et <strong>Schedule Instant</strong> dans la fenêtre suivante. On valide cette tâche qui se retrouve à présent dans la liste des tâches actives <em>(comme pour la tâche de capture du master)</em>.</p>
<p>
<a href="#image-1783dc445623e2492817478bc7cb22f8" class="lightbox-link">
<img src="../../at3/at3e1/fog/09_Fog_Hosts_Client.png" alt="Fog_Hosts_Client" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1783dc445623e2492817478bc7cb22f8">
<img src="../../at3/at3e1/fog/09_Fog_Hosts_Client.png" alt="Fog_Hosts_Client" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-d657cabf6a73f2fc90431e0e74ce8cfc" class="lightbox-link">
<img src="../../at3/at3e1/fog/10_1_Client_Deploy_New_Task_.png" alt="Fog_Client_Task_Deploy" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-d657cabf6a73f2fc90431e0e74ce8cfc">
<img src="../../at3/at3e1/fog/10_1_Client_Deploy_New_Task_.png" alt="Fog_Client_Task_Deploy" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-f650122ad20a087ad267e79ea5180268" class="lightbox-link">
<img src="../../at3/at3e1/fog/10_2_Client_Deploy_Task_Options.png" alt="Fog_Client_Tasks_Deploy_Options" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-f650122ad20a087ad267e79ea5180268">
<img src="../../at3/at3e1/fog/10_2_Client_Deploy_Task_Options.png" alt="Fog_Client_Tasks_Deploy_Options" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-7ee0830dc9ea3ad7d4d4de36a8e3c236" class="lightbox-link">
<img src="../../at3/at3e1/fog/10_3_Client_Deploy_Task_Added.png" alt="Fog_Client_Task_added" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-7ee0830dc9ea3ad7d4d4de36a8e3c236">
<img src="../../at3/at3e1/fog/10_3_Client_Deploy_Task_Added.png" alt="Fog_Client_Task_added" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-33b3c1689865f7824b4a962d7e507231" class="lightbox-link">
<img src="../../at3/at3e1/fog/10_4_Client_Active_Tasks.png" alt="fog_Client_Deploy_Active_Tasks" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-33b3c1689865f7824b4a962d7e507231">
<img src="../../at3/at3e1/fog/10_4_Client_Active_Tasks.png" alt="fog_Client_Deploy_Active_Tasks" class="lightbox-image" loading="lazy">
</a></p>
<p>On (re)démarre la machine cliente et le déploiement démarre automatiquement :</p>
<p>
<a href="#image-44f61aa87f1a3fd82b1e023510cbfaee" class="lightbox-link">
<img src="../../at3/at3e1/fog/10_5_Client_VMW_Deploy_Running.png" alt="VMW_Client_Deploy_Running" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-44f61aa87f1a3fd82b1e023510cbfaee">
<img src="../../at3/at3e1/fog/10_5_Client_VMW_Deploy_Running.png" alt="VMW_Client_Deploy_Running" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-4581cf91a20c9c73b2d27770dbf6139a" class="lightbox-link">
<img src="../../at3/at3e1/fog/10_6_Client_Deploy_fog_Running.png" alt="Fog_Client_Deploy_Running" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-4581cf91a20c9c73b2d27770dbf6139a">
<img src="../../at3/at3e1/fog/10_6_Client_Deploy_fog_Running.png" alt="Fog_Client_Deploy_Running" class="lightbox-image" loading="lazy">
</a></p>
<p>** Pour déployer une machine sans avoir créé de tâche au préalable :**</p>
<p>On (re)démarre la machine à déployer et on choisi <strong>Deploy Image</strong> dans le menu FOG pour démarrer la tâche de déploiement. Le processus demande alors un login/mot de passe qu&rsquo;on renseigne avec <code>fog/pqsszord</code> (pour fog/password, le clavier étant en disposition QWERTY à ce moment là).</p>
<p>
<a href="#image-fa503157df35a40c84342359ea6025be" class="lightbox-link">
<img src="../../at3/at3e1/fog/11_1_Client_VMW_Menu_Deploy.png" alt="VMW_Client_Deploy_Menu" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-fa503157df35a40c84342359ea6025be">
<img src="../../at3/at3e1/fog/11_1_Client_VMW_Menu_Deploy.png" alt="VMW_Client_Deploy_Menu" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-1d58d165490e4ed9938d3726db9eeeb4" class="lightbox-link">
<img src="../../at3/at3e1/fog/11_2_Client_VMW_Deploy_Login.png" alt="VMW_Client_Deploy_login" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1d58d165490e4ed9938d3726db9eeeb4">
<img src="../../at3/at3e1/fog/11_2_Client_VMW_Deploy_Login.png" alt="VMW_Client_Deploy_login" class="lightbox-image" loading="lazy">
</a></p>
<p>Une fois l&rsquo;opération terminée, on reboot la machine clonée pour modifier son BIOS afin qu&rsquo;elle boot sur son disque dur. Elle possède la même configuration que la master avec cependant un nom d&rsquo;hôte correspondant au nom qu&rsquo;on a spécifié dans FOG <em>(tout comme le master)</em>.</p>
<p>
<a href="#image-b16e49097d41a02a9105b1dd38b39240" class="lightbox-link">
<img src="../../at3/at3e1/fog/12_Master-Client.png.png" alt="Master-Client" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-b16e49097d41a02a9105b1dd38b39240">
<img src="../../at3/at3e1/fog/12_Master-Client.png.png" alt="Master-Client" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h2 id="installation-de-lagent-fog-client">Installation de l&rsquo;agent FOG Client</h2>
<p><strong>L&rsquo;agent FOG permet de changer le nom de la machine via l&rsquo;interface web, d&rsquo;y ajouter des logiciels, des scripts et d&rsquo;autres fonctionnalités avancées (AD&hellip;)</strong></p>
<p>Sur le(s) poste(s) client(s), l&rsquo;agent FOG peut :</p>
<ul>
<li>avoir été installé sur le master donc automatiquement déployé</li>
<li>être téléchargé manuellement via <em>SmartInstaller sur</em> <strong><a href="https://github.com/FOGProject/fog-client/releases" target="_blank">https://github.com/FOGProject/fog-client/releases</a></strong> <em>(ou avec git)</em></li>
<li>être téléchargé depuis l&rsquo;interface web de FOG dans un navigateur (éviter Edge) par le bouton en bas à gaughe.</li>
</ul>
<p>Durant l&rsquo;installation <em>(procédure classique)</em> il faut renseigner l&rsquo;adresse IP du serveur FOG :</p>
<p>
<a href="#image-e4e8ac6d5ff055efd40046ddfa68d513" class="lightbox-link">
<img src="../../at3/at3e1/fog/13_Install_Agent.png" alt="Install_Agent_Fog" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-e4e8ac6d5ff055efd40046ddfa68d513">
<img src="../../at3/at3e1/fog/13_Install_Agent.png" alt="Install_Agent_Fog" class="lightbox-image" loading="lazy">
</a></p>
<p>&hellip; et sélectionner <code>HTTPS</code> si c&rsquo;est le cas.</p>
<p>Une fois l&rsquo;agent installé, un redémarrage est nécessaire, un fichier log.fog est créé à la racine du disque C:</p>
<p>Si le fichier log n’apparaît pas après un redémarrage, on peut lancer le service &ldquo;FOGService&rdquo; à la main.</p>
<hr>
<h2 id="déploiement-de-logiciels">Déploiement de logiciels</h2>
<p><strong>Pour déployer des logiciels post-déploiement, on utilise les <code>snapins</code></strong></p>
<p>On y accède via l&rsquo;icone <strong>snapin</strong> <em>(barre du haut)</em> et on crée un nouveau via le menu de gauche <strong>Create New Snapin</strong>.</p>
<p>Il faut au minimum lui donner un nom, un template, un fichier d&rsquo;installation + les éventuels arguments de ligne de commande pour installation silencieuse (se référer à la doc du logiciel) et valider.</p>
<p>
<a href="#image-318ba3ecd7353f76a91355791b9ac88b" class="lightbox-link">
<img src="../../at3/at3e1/fog/14_1_New_Snapin.png" alt="New_Snapin" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-318ba3ecd7353f76a91355791b9ac88b">
<img src="../../at3/at3e1/fog/14_1_New_Snapin.png" alt="New_Snapin" class="lightbox-image" loading="lazy">
</a></p>
<p>Ensuite, il faut affecter notre nouveau snapin au(x) poste(s) client(s) en cliquant  <strong>Membership</strong> dans les onglets de la page</p>
<p>
<a href="#image-f6806b34c70942df6765619f2f28f7e2" class="lightbox-link">
<img src="../../at3/at3e1/fog/14_2_Snapin_Membership.png" alt="Snapin_Membership" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-f6806b34c70942df6765619f2f28f7e2">
<img src="../../at3/at3e1/fog/14_2_Snapin_Membership.png" alt="Snapin_Membership" class="lightbox-image" loading="lazy">
</a></p>
<p>On le retrouve dans la liste <strong>All Snapins</strong></p>
<p>
<a href="#image-325061c8700dff6201a85931d9d4e76b" class="lightbox-link">
<img src="../../at3/at3e1/fog/14_3_All_Snapins.png" alt="All_Snapins" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-325061c8700dff6201a85931d9d4e76b">
<img src="../../at3/at3e1/fog/14_3_All_Snapins.png" alt="All_Snapins" class="lightbox-image" loading="lazy">
</a></p>
<p>De retour sur le poste client dans la gestion des hôtes, on clique sur &ldquo;Basic Tasks&rdquo; puis sur &ldquo;Advanced&rdquo;</p>
<p>
<a href="#image-b0c78ebf856621b7fbcbef20448a9a6e" class="lightbox-link">
<img src="../../at3/at3e1/fog/14_4_Snapin_Host_New_Task.png" alt="Snapin_Host_New_Task" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-b0c78ebf856621b7fbcbef20448a9a6e">
<img src="../../at3/at3e1/fog/14_4_Snapin_Host_New_Task.png" alt="Snapin_Host_New_Task" class="lightbox-image" loading="lazy">
</a></p>
<p>Et enfin, dans la liste, sur &ldquo;Single Snapin&rdquo; car nous n&rsquo;avons qu&rsquo;un logiciel à installer.</p>
<p>
<a href="#image-1bc74bc7fdf8f37249dbb12ea4978b11" class="lightbox-link">
<img src="../../at3/at3e1/fog/14_5_Snapin_Host_New_Task_Config.png" alt="Snapin_Host_New_Task_Config" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1bc74bc7fdf8f37249dbb12ea4978b11">
<img src="../../at3/at3e1/fog/14_5_Snapin_Host_New_Task_Config.png" alt="Snapin_Host_New_Task_Config" class="lightbox-image" loading="lazy">
</a></p>
<p>Sélectionner le package à installer et valider</p>
<p>
<a href="#image-51161974d3c0a0dbe9865475cd64347f" class="lightbox-link">
<img src="../../at3/at3e1/fog/14_6_Single_Snapin_Task.png" alt="Single_Snapin_Task" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-51161974d3c0a0dbe9865475cd64347f">
<img src="../../at3/at3e1/fog/14_6_Single_Snapin_Task.png" alt="Single_Snapin_Task" class="lightbox-image" loading="lazy">
</a></p>
<p>La tâche apparaît dans les tâches actives</p>
<p>Quand l&rsquo;agent entrera en contact avec le serveur FOG, il recevra l&rsquo;ordre de télécharger le snapin sur le serveur FOG et l&rsquo;installera sur le poste client.</p>
<p>Le fichier log.fog contiendra un rapport d&rsquo;installation</p>
<hr>
<h2 id="déploiement-doffice">Déploiement d&rsquo;Office</h2>
<p>Pour office on crée un dossier partagé Samba publique sur le serveur FOG.</p>
<h3 id="samba"><strong>Samba</strong></h3>
<ul>
<li>Création et configuration du dossier partagé sur le serveur FOG :</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /
</span></span><span class="line"><span class="cl">mkdir share
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> share
</span></span><span class="line"><span class="cl">mkdir partage
</span></span><span class="line"><span class="cl">chmod <span class="m">777</span> partage
</span></span></code></pre></div><ul>
<li>Installation et configuration de Samba :</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install samba
</span></span><span class="line"><span class="cl">nano /etc/samba/smb.conf
</span></span></code></pre></div><p>smb.conf :</p>
<pre tabindex="0"><code>[global]
   workgroup = WORKGROUP
   log file = /var/log/samba/log.%m
   max log size = 1000
   logging = file
   panic action = /usr/share/samba/panic-action %d
   server role = standalone server
   obey pam restrictions = yes
   unix password sync = yes
   passwd program = /usr/bin/passwd %u
   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .
   pam password change = yes
   map to guest = bad user
   usershare allow guests = yes
[partage]
   comment = Partage de fichiers
   path = /share/partage
   guest ok = yes
   read only = no
   browseable = yes
</code></pre><h3 id="odt"><strong>ODT</strong></h3>
<h3 id="sur-la-machine-hôte-qui-fait-tourner-les-vms-télécharger-et-décompresser-odt-dans-un-dossier-où-on-mettra-tous-nos-scripts-et-fichiers-de-configuration-suivants">Sur la machine hôte qui fait tourner les VMs, télécharger et décompresser ODT <strong>dans un dossier où on mettra tous nos scripts et fichiers de configuration suivants</strong>.</h3>
<ul>
<li>On crée un fichier de configuration pour le téléchargement d&rsquo;Office.</li>
</ul>
<p><code>downloadOffice.xml</code> :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Configuration&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Add</span> <span class="na">SourcePath=</span><span class="s">&#34;\\192.168.13.222\partage&#34;</span> 
</span></span><span class="line"><span class="cl">       <span class="na">OfficeClientEdition=</span><span class="s">&#34;64&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">Channel=</span><span class="s">&#34;MonthlyEnterprise&#34;</span> <span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Product</span> <span class="na">ID=</span><span class="s">&#34;O365ProPlusRetail&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">	   <span class="nt">&lt;Language</span> <span class="na">ID=</span><span class="s">&#34;fr-fr&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/Product&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Add&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Updates</span> <span class="na">Enabled=</span><span class="s">&#34;TRUE&#34;</span> 
</span></span><span class="line"><span class="cl">           <span class="na">UpdatePath=</span><span class="s">&#34;\\192.168.13.222\partage&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;Display</span> <span class="na">Level=</span><span class="s">&#34;None&#34;</span> <span class="na">AcceptEULA=</span><span class="s">&#34;TRUE&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Configuration&gt;</span>
</span></span></code></pre></div><ul>
<li>Un fichier pour la configuration de l&rsquo;installation.</li>
</ul>
<p><code>installOffice.xml</code> :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Configuration</span> <span class="na">ID=</span><span class="s">&#34;d3297aa9-1a8d-4c14-af9b-9e243abb0f12&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Add</span> <span class="na">OfficeClientEdition=</span><span class="s">&#34;64&#34;</span> <span class="na">Channel=</span><span class="s">&#34;MonthlyEnterprise&#34;</span> <span class="na">SourcePath=</span><span class="s">&#34;\\192.168.13.222\partage&#34;</span> <span class="na">AllowCdnFallback=</span><span class="s">&#34;TRUE&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Product</span> <span class="na">ID=</span><span class="s">&#34;O365ProPlusRetail&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;Language</span> <span class="na">ID=</span><span class="s">&#34;fr-fr&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;ExcludeApp</span> <span class="na">ID=</span><span class="s">&#34;Bing&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/Product&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Add&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Property</span> <span class="na">Name=</span><span class="s">&#34;SharedComputerLicensing&#34;</span> <span class="na">Value=</span><span class="s">&#34;0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Property</span> <span class="na">Name=</span><span class="s">&#34;FORCEAPPSHUTDOWN&#34;</span> <span class="na">Value=</span><span class="s">&#34;TRUE&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Property</span> <span class="na">Name=</span><span class="s">&#34;DeviceBasedLicensing&#34;</span> <span class="na">Value=</span><span class="s">&#34;0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Property</span> <span class="na">Name=</span><span class="s">&#34;SCLCacheOverride&#34;</span> <span class="na">Value=</span><span class="s">&#34;0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Updates</span> <span class="na">Enabled=</span><span class="s">&#34;TRUE&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;AppSettings&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;User</span> <span class="na">Key=</span><span class="s">&#34;software\microsoft\office\16.0\excel\options&#34;</span> <span class="na">Name=</span><span class="s">&#34;defaultformat&#34;</span> <span class="na">Value=</span><span class="s">&#34;60&#34;</span> <span class="na">Type=</span><span class="s">&#34;REG_DWORD&#34;</span> <span class="na">App=</span><span class="s">&#34;excel16&#34;</span> <span class="na">Id=</span><span class="s">&#34;L_SaveExcelfilesas&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;User</span> <span class="na">Key=</span><span class="s">&#34;software\microsoft\office\16.0\powerpoint\options&#34;</span> <span class="na">Name=</span><span class="s">&#34;defaultformat&#34;</span> <span class="na">Value=</span><span class="s">&#34;52&#34;</span> <span class="na">Type=</span><span class="s">&#34;REG_DWORD&#34;</span> <span class="na">App=</span><span class="s">&#34;ppt16&#34;</span> <span class="na">Id=</span><span class="s">&#34;L_SavePowerPointfilesas&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;User</span> <span class="na">Key=</span><span class="s">&#34;software\microsoft\office\16.0\word\options&#34;</span> <span class="na">Name=</span><span class="s">&#34;defaultformat&#34;</span> <span class="na">Value=</span><span class="s">&#34;ODT&#34;</span> <span class="na">Type=</span><span class="s">&#34;REG_SZ&#34;</span> <span class="na">App=</span><span class="s">&#34;word16&#34;</span> <span class="na">Id=</span><span class="s">&#34;L_SaveWordfilesas&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/AppSettings&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Display</span> <span class="na">Level=</span><span class="s">&#34;Full&#34;</span> <span class="na">AcceptEULA=</span><span class="s">&#34;TRUE&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Configuration&gt;</span>
</span></span></code></pre></div>
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Remarque</div>
  <div class="box-content">
<p>Un générateur pour ce fichier <a href="https://config.office.com/deploymentsettings" target="_blank">https://config.office.com/deploymentsettings</a></p>
  </div>
</div>
<p>
<a href="#image-edacafe5a176d56b400a32611fcd77a7" class="lightbox-link">
<img src="../../at3/at3e1/fog/15_0_outil_ms.png" alt="outils_en_ligne" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-edacafe5a176d56b400a32611fcd77a7">
<img src="../../at3/at3e1/fog/15_0_outil_ms.png" alt="outils_en_ligne" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Un script batch pour lancer le téléchargement puis la copie des 2 fichiers dont on aura besoin dans le dossier partagé.</li>
</ul>
<p><code>odt.bat</code> :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-batch" data-lang="batch"><span class="line"><span class="cl"><span class="p">@</span><span class="k">echo</span> off
</span></span><span class="line"><span class="cl">setup /download downloadOffice.xml
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Telechargement des fichiers d&#39;installation d&#39;office termine !&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">pause</span>
</span></span><span class="line"><span class="cl"><span class="k">copy</span> setup.exe  \\192.168.13.222\partage\setup.exe
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Fichier setup.exe copie sur le serveur FOG&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">copy</span> InstallOffice.xml  \\192.168.13.222\partage\InstallOffice.xml
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Fichier de configuration installOffice.xml copie sur le serveur FOG&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Scipt termine !&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">pause</span>
</span></span></code></pre></div><ul>
<li>Et enfin un fichier <code>.cmd</code> d&rsquo;une seule ligne qu&rsquo;on passera en snapin.</li>
</ul>
<p><code>snapinSetupOffice.cmd</code> :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">\\192.168.13.222\partage\setup.exe /configure \\192.168.13.222\partage\InstallOffice.xml
</span></span></code></pre></div><p>On doit obtenir ceci :</p>
<p>
<a href="#image-083d0f7121ba9fc9e8bdd8862da533af" class="lightbox-link">
<img src="../../at3/at3e1/fog/15_1_Dossier_ODT.png" alt="Dossier_ODT" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-083d0f7121ba9fc9e8bdd8862da533af">
<img src="../../at3/at3e1/fog/15_1_Dossier_ODT.png" alt="Dossier_ODT" class="lightbox-image" loading="lazy">
</a></p>
<p>On exécute ensuite le fichier <code>odt.bat</code> et on attend que le téléchargement d&rsquo;Office soit terminé (<em>Appuyer sur une touche pour continer&hellip;</em> apparaît dans le terminal).</p>
<p>On vérifie qu&rsquo;on a bien peuplé notre dossier partagé sur le serveur FOG à l&rsquo;adresse du partage <strong><code>\\192.168.13.222\partage</code></strong> :</p>
<p>
<a href="#image-23bea72aca714dda9a0833a00b279388" class="lightbox-link">
<img src="../../at3/at3e1/fog/15_2_Dossier_partage.png" alt="Dossier_partage" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-23bea72aca714dda9a0833a00b279388">
<img src="../../at3/at3e1/fog/15_2_Dossier_partage.png" alt="Dossier_partage" class="lightbox-image" loading="lazy">
</a></p>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p><strong>Il faut faire passer le dossier <code>Office</code> dans le dossier partagé du serveur FOG en <em>public</em> avec :</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">chmod -R <span class="m">777</span> /var/share
</span></span></code></pre></div>  </div>
</div>
<blockquote>
<p>On peut temporairement désactiver l&rsquo;UAC sur le poste client pour éviter les messages de sécurité <em>(via le panneau de configuration &gt; Sécurité et maintenance &gt; Modifier les paramètres du centre de sécurité et maintenance &gt; et décocher la case Contrôle de compte d&rsquo;utilisateur)</em>.</p>
</blockquote>
<p>On va ensuite créer notre snapin contenant le script <code>snapinSetupOffice.cmd</code> comme ceci :</p>
<p>
<a href="#image-80f7a2b719134c2d9a6202b6319cfab6" class="lightbox-link">
<img src="../../at3/at3e1/fog/15_3_add_office_snapin.png" alt="add_office_snapin" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-80f7a2b719134c2d9a6202b6319cfab6">
<img src="../../at3/at3e1/fog/15_3_add_office_snapin.png" alt="add_office_snapin" class="lightbox-image" loading="lazy">
</a></p>
<p>Puis l&rsquo;affecter à notre hôte cible comme un snapin simple.</p>
<p>
<a href="#image-23408aca59596a3f091e0a6f0ee2637b" class="lightbox-link">
<img src="../../at3/at3e1/fog/15_4_Affect_Office_Snapin.png" alt="Affect_Office_Snapin" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-23408aca59596a3f091e0a6f0ee2637b">
<img src="../../at3/at3e1/fog/15_4_Affect_Office_Snapin.png" alt="Affect_Office_Snapin" class="lightbox-image" loading="lazy">
</a></p>
<p>Et elle doit figurer dans la liste des tâches active.</p>
<p>Avec la configuration choisie, une barre de progression doit apparaître sur le poste client durant l&rsquo;installation d&rsquo;Office <em>(n&rsquo;a pas fonctionné lors de ce test)</em>.</p>
<p>
<a href="#image-7fd06f863d429949244500c4c7c8d70d" class="lightbox-link">
<img src="../../at3/at3e1/fog/15_5_Office_installed.png" alt="Office_Installed" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-7fd06f863d429949244500c4c7c8d70d">
<img src="../../at3/at3e1/fog/15_5_Office_installed.png" alt="Office_Installed" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h2 id="changement-de-nom-de-poste">Changement de nom de poste</h2>
<p>Il est possible de changer le nom d&rsquo;un poste client directement depuis l&rsquo;interface web du serveur FOG.</p>
<p>Il n&rsquo;est pas nécessaire d&rsquo;avoir l&rsquo;agent d&rsquo;installé sur le client.</p>
<p>Dans l&rsquo;interface web de FOG cliquez sur <strong>Services Configuration</strong></p>
<p>Puis <strong>Hostname Changer</strong> pour vérifier l&rsquo;état du service</p>
<p>La case doit être cochée</p>
<p>
<a href="#image-a52162a7944aa04c0b5acc5fee357673" class="lightbox-link">
<img src="../../at3/at3e1/fog/16_1_Hostname_Changer.png" alt="Hostname_Changer" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-a52162a7944aa04c0b5acc5fee357673">
<img src="../../at3/at3e1/fog/16_1_Hostname_Changer.png" alt="Hostname_Changer" class="lightbox-image" loading="lazy">
</a></p>
<p>Ensuite on peut changer le nom de l&rsquo;hôte dans la page de l&rsquo;hôte à Host name.</p>
<p>
<a href="#image-234db4363f3952633d786fb20a55f2f0" class="lightbox-link">
<img src="../../at3/at3e1/fog/16_2_Host_Name_Change.png" alt="Host_Name_Change" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-234db4363f3952633d786fb20a55f2f0">
<img src="../../at3/at3e1/fog/16_2_Host_Name_Change.png" alt="Host_Name_Change" class="lightbox-image" loading="lazy">
</a></p>
<p>Le poste redémarrera automatiquement lors du prochain contact de l&rsquo;agent pour prendre le nom spécifié dans FOG</p>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p>Pour que le poste client puisse redémarrer alors que l&rsquo;utilisateur est logué, il faut cocher l&rsquo;option <strong>ENFORCE HOST CHANGES</strong> dans <strong>FOG Configuration</strong> <em>(barre du haut)</em> &gt; <strong>FOG Settings</strong> <em>(menu de gauche)</em> &gt; section <strong>Active Directory Defaults</strong>, sinon le renommage se fera au prochain démarrage du poste.</p>
  </div>
</div>
<p>
<a href="#image-ac0065259dc3ca0f0e7109c4580f9fc1" class="lightbox-link">
<img src="../../at3/at3e1/fog/16_3_AD_Defaults.png" alt="AD_Defaults" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ac0065259dc3ca0f0e7109c4580f9fc1">
<img src="../../at3/at3e1/fog/16_3_AD_Defaults.png" alt="AD_Defaults" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h2 id="déploiement-de-scripts">Déploiement de scripts</h2>
<p>Pour le déploiement d&rsquo;un script, c&rsquo;est la même chose que pour un logiciel.</p>
<p>Il suffira de sélectionner le type de script et de l&rsquo;uploader.</p>
<p>Exemple création d&rsquo;un dossier toto à la racine de C:
créer un batch &ldquo;script.cmd&rdquo; qui contient :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-batch" data-lang="batch"><span class="line"><span class="cl"><span class="p">@</span><span class="k">echo</span> off
</span></span><span class="line"><span class="cl"><span class="k">mkdir</span> c:\TestScript
</span></span><span class="line"><span class="cl">ping 192.168.13.254 <span class="p">&gt;</span> c:\TestScript\ping_gw.txt
</span></span></code></pre></div><p>
<a href="#image-60fe68b2f34554c22ca91265d9213c36" class="lightbox-link">
<img src="../../at3/at3e1/fog/17_Script_Snapin.png" alt="Script_Snapin" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-60fe68b2f34554c22ca91265d9213c36">
<img src="../../at3/at3e1/fog/17_Script_Snapin.png" alt="Script_Snapin" class="lightbox-image" loading="lazy">
</a></p>
<p>Ensuite il suffira d&rsquo;affecter le snapin au poste client voulu et de planifier la tâche au niveau de l&rsquo;hôte.</p>
<hr>
<h2 id="les-plugins">Les plugins</h2>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p><em>Ce chapitre - texte et images - est entièrement extrait du support de  cours de Bertand Girault - CEFIM Tours</em></p>
  </div>
</div>
<p>Fog project intègre un système de plugin afin de proposer des fonctionnalités supplémentaires (en développement)</p>
<p>Cliquez sur l&rsquo;icone&rsquo; de configuration</p>
<p>
<a href="#image-36de7f170e8d2070da5c216446654ce0" class="lightbox-link">
<img src="../../at3/at3e1/fog/18_1.jpg" alt="18_1" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-36de7f170e8d2070da5c216446654ce0">
<img src="../../at3/at3e1/fog/18_1.jpg" alt="18_1" class="lightbox-image" loading="lazy">
</a></p>
<p>Puis sur &ldquo;plugin system&rdquo; en bas de la liste</p>
<p>
<a href="#image-c0196e84c962d10e5b0009afa80bb580" class="lightbox-link">
<img src="../../at3/at3e1/fog/18_2.jpg" alt="18_2" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-c0196e84c962d10e5b0009afa80bb580">
<img src="../../at3/at3e1/fog/18_2.jpg" alt="18_2" class="lightbox-image" loading="lazy">
</a></p>
<p>Et enfin il faut activer le PlugIn System</p>
<p>
<a href="#image-5688b18e3aaf3d12233058a68dd59337" class="lightbox-link">
<img src="../../at3/at3e1/fog/18_3.jpg" alt="18_3" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-5688b18e3aaf3d12233058a68dd59337">
<img src="../../at3/at3e1/fog/18_3.jpg" alt="18_3" class="lightbox-image" loading="lazy">
</a></p>
<p>Un nouveau menu apparaît maintenant, cliquez dessus pour voir la liste des plugins.</p>
<p>
<a href="#image-3eb32ddc402b9f91d18d1d49b5ad0c08" class="lightbox-link">
<img src="../../at3/at3e1/fog/18_4.jpg" alt="18_4" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-3eb32ddc402b9f91d18d1d49b5ad0c08">
<img src="../../at3/at3e1/fog/18_4.jpg" alt="18_4" class="lightbox-image" loading="lazy">
</a></p>
<p>Il faut commencer par activer le plugin en cliquant dessus.</p>
<p>
<a href="#image-1a146fb9817bcf56588eb77a5c2cb6aa" class="lightbox-link">
<img src="../../at3/at3e1/fog/18_5.jpg" alt="18_5" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1a146fb9817bcf56588eb77a5c2cb6aa">
<img src="../../at3/at3e1/fog/18_5.jpg" alt="18_5" class="lightbox-image" loading="lazy">
</a></p>
<p>cliquez sur le plugin choisi, ici c&rsquo;est Pushbullet un service qui permet de recevoir des notifications des tâches faites sous FOG</p>
<p>Cliquez sur le menu &ldquo;install plugins&rdquo; et enfin sur l&rsquo;icone de &ldquo;Pushbullet&rdquo;</p>
<p>
<a href="#image-5ec97d9b304f4f493e11f39e1ee00ee8" class="lightbox-link">
<img src="../../at3/at3e1/fog/18_6.jpg" alt="18_6" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-5ec97d9b304f4f493e11f39e1ee00ee8">
<img src="../../at3/at3e1/fog/18_6.jpg" alt="18_6" class="lightbox-image" loading="lazy">
</a></p>
<p>Puis sur le menu &ldquo;installer Plugins&rdquo;</p>
<p>
<a href="#image-4f0bd163cce1f7e9ba33c278af75a00d" class="lightbox-link">
<img src="../../at3/at3e1/fog/18_7.jpg" alt="18_7" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-4f0bd163cce1f7e9ba33c278af75a00d">
<img src="../../at3/at3e1/fog/18_7.jpg" alt="18_7" class="lightbox-image" loading="lazy">
</a></p>
<p>Le plugin est installé et apparaît dans le menu</p>
<p>
<a href="#image-9595e8183d6e8b1952fe7aaec7cf61eb" class="lightbox-link">
<img src="../../at3/at3e1/fog/18_8.jpg" alt="18_8" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-9595e8183d6e8b1952fe7aaec7cf61eb">
<img src="../../at3/at3e1/fog/18_8.jpg" alt="18_8" class="lightbox-image" loading="lazy">
</a></p>
<p>Il faut avoir un compte Pushbullet :</p>
<p><a href="https://www.pushbullet.com/" target="_blank">https://www.pushbullet.com/</a></p>
<p>Sur votre compte pushbullet, vous devez créer un &ldquo;access token&rdquo; qui sera copié dans FOG et sur une application installée sur votre smartphone/tablette.</p>
<hr>
<h2 id="créer-un-autre-noeud-de-stockage">Créer un autre noeud de stockage</h2>
<p>Installer FOG sur une autre VM debian en choisissant <strong>[S] Stockage</strong> à la 2ème question de l&rsquo;installeur.
Outre le serveur FOG principal il faudra spécifier les nom et mdp de l&rsquo;utilisateur MySQL qui est renseigné dans l&rsquo;interface web du serveur sous l&rsquo;icone <strong><code>FOG configuration</code></strong> <em>(barre du haut)</em> &gt; <strong><code>FOG Settings</code></strong> <em>(menu de gauche)</em> &gt; section <strong><code>FOG Storage Nodes</code></strong></p>
<p>
<a href="#image-38c2dd2d7117db2336a26d878f5347c5" class="lightbox-link">
<img src="../../at3/at3e1/fog/19_Database_user_Infos.png" alt="Database_User_Infos" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-38c2dd2d7117db2336a26d878f5347c5">
<img src="../../at3/at3e1/fog/19_Database_user_Infos.png" alt="Database_User_Infos" class="lightbox-image" loading="lazy">
</a></p>

<div class="box notices cstyle tip">
  <div class="box-label"><i class="fa-fw fas fa-lightbulb"></i> Astuce</div>
  <div class="box-content">
<p><em>Plus sur <a href="https://chrtophe.developpez.com/tutoriels/deploiement-fogproject/#L9" target="_blank"><strong>cette page</strong></a></em></p>
  </div>
</div>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="chapter">
<div class="article-subheading">Exemple 3</div>
<h1 id="stage-armatis">Stage Armatis</h1>

<hr>
<h2 id="déploiement-armatis"><strong>Déploiement Armatis</strong></h2>
<p>Le déploiement des postes s&rsquo;effectue en 2 étapes :</p>
<ol>
<li>déploiement de l&rsquo;image souche (l&rsquo;hôte) <em>- environ 30 min</em></li>
<li>déploiement de la VM (VMWare) selon l&rsquo;activité à laquelle sera affectée la machine <em>- environ 2 h</em></li>
</ol>
<p>Les machines sont déployées une à une.</p>
<h3 id="déploiement-image-souche"><strong>Déploiement image souche</strong></h3>
<p>Sur chaque machine, le déploiement de l&rsquo;image souche s&rsquo;effectue par boot PXE, puis sélection dans Clonezilla de l&rsquo;image à déployer. Plusieurs scripts de configuration sont ensuite appelés automatiquement.</p>
<ul>
<li><strong>[F10]</strong> au démarrage de la machine pour accès au BIOS
<ul>
<li>Boot Options
<ul>
<li>Mettre un délai de 5 secondes</li>
<li><code>Activer le démarrage sur PXE</code></li>
<li>Désactiver l&rsquo;alerte audio</li>
</ul>
</li>
<li>Sécurité
<ul>
<li><code>Désactiver le Secure Boot (disable-disable)</code></li>
</ul>
</li>
<li><strong>[F10]</strong> pour sauvegarder les modifications et quitter le BIOS
-&gt; La machine reboot</li>
</ul>
</li>
<li><strong>[F9]]</strong> pour le menu de boot
<ul>
<li><code>Démarrer sur PXE IPV4</code></li>
</ul>
</li>
<li>Dans le menu de CloneZilla qui s&rsquo;affiche, choisir <code>TAUX - Direct Restore HP Universal</code>
<ul>
<li>Sur certaine machine (les plus récentes) une demande de confirmation apparaît après environ 1 minute =&gt; [Entrée]</li>
</ul>
</li>
</ul>
<p><em>Cette étape dure environ 1/2 heure.</em></p>
<p>L&rsquo;opération terminée, la machine doit rebooter sur un compte en auto-login ; sinon (administrateur) redémarrer la machine jusqu&rsquo;à l&rsquo;obtenir.</p>
<p>Suivant les machines il y a de petites différence (version BIOS&hellip;) :</p>
<ul>
<li>
<p>400/600-G2 : C&rsquo;est la démarche de base</p>
</li>
<li>
<p>400-G3 : Un code pin est demandé pour désactiver le Secure Boot</p>
</li>
<li>
<p>400-G6 : Secure Boot déjà désactivé, normalement</p>
</li>
<li>
<p>400-G9 :</p>
<ul>
<li>Vérifier Secure Boot + Boot Options + MdP BIOS (à définir si machine neuve)</li>
<li>Il peut être nécessaire de redémarrer la machine plusieurs fois pour obtenir une session avec le compte en auto-login</li>
</ul>
</li>
</ul>
<hr>
<h3 id="déploiement-image-vm"><strong>Déploiement image VM</strong></h3>
<ul>
<li>Une fois la machine démarrée sur le compte en auto-login :
<ul>
<li>Lancer Post-EDF-NG -&gt; Continue + Finish</li>
<li>Fermer VM</li>
</ul>
</li>
<li>Déco + reco en administrateur
<ul>
<li>Post-EDF-NG -&gt; Continue + Finish (éventuellement : Take Ownership)</li>
<li>Fermer VM</li>
<li>Menu Démarrer :
<ul>
<li>TAU-INST-NG-PRO-V2 (pour un poste EDF-PRO)</li>
<li>TAU-INST-NG-PART-V2 (pour un poste EDF-PART)</li>
</ul>
</li>
<li>-&gt; Si hostname en <code>DESKTOP[...]</code> : le PC reboot, il faut alors se re-co en administrateur et relancer le script TAU&hellip;</li>
<li>-&gt; Si clic-auto manqué : le faire manuellement = Clic + [Entrée]</li>
</ul>
</li>
</ul>
<p><em>Cette étape dure approximativement 2h30.</em></p>
<h3 id="configuration-dune-machine-pour-le-tad-travail-a-distance-structurel"><strong>Configuration d&rsquo;une machine pour le TAD (Travail A Distance) structurel</strong></h3>
<p>Une fois le déploiement de la VM terminé ou sur une machine déjà en production sur site :</p>
<ol>
<li>Fermer la VM</li>
<li>Se déconnecter du compte utilisateur actif (en auto-login)</li>
<li>Se connecter en administrateur</li>
<li>Menu démarrer &gt; TAU-INST-TAD</li>
</ol>
<p><em>L&rsquo;opération dure environ une minute.</em></p>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>        </div>
      </main>
    </div>
    <script src="../../js/clipboard.min.js" defer></script>
    <script src="../../js/perfect-scrollbar.min.js" defer></script>
    <script src="../../js/theme.js" defer></script>
  </body>
</html>
