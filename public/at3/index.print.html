<!DOCTYPE html>
<html lang="fr" dir="ltr">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="height=device-height, width=device-width, initial-scale=1.0, minimum-scale=1.0">
    <meta name="description" content="Docs formation Cefim TSSR">
    <meta name="author" content="Olivier Duhamel">
    <title>Maintenir et exploiter une infrastructure distribuée et contribuer à sa sécurisation - TSSOC</title>
    <link href="https://www.tssoc.oliduha.fr/at3/index.html" rel="canonical" type="text/html" title="Maintenir et exploiter une infrastructure distribuée et contribuer à sa sécurisation - TSSOC">
    <link href="../at3/index.xml" rel="alternate" type="application/rss+xml" title="Maintenir et exploiter une infrastructure distribuée et contribuer à sa sécurisation - TSSOC">
    <link href="../images/logo.svg" rel="icon" type="image/svg+xml">
    <!-- https://github.com/filamentgroup/loadCSS/blob/master/README.md#how-to-use -->
    <link href="../css/fontawesome-all.min.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../css/fontawesome-all.min.css" rel="stylesheet"></noscript>
    <link href="../css/nucleus.css" rel="stylesheet">
    <link href="../css/auto-complete.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../css/auto-complete.css" rel="stylesheet"></noscript>
    <link href="../css/perfect-scrollbar.min.css" rel="stylesheet">
    <link href="../css/fonts.css" rel="stylesheet" media="print" onload="this.media='all';this.onload=null;"><noscript><link href="../css/fonts.css" rel="stylesheet"></noscript>
    <link href="../css/theme.css" rel="stylesheet">
    <link href="../css/theme-auto.css" rel="stylesheet" id="variant-style">
    <link href="../css/variant.css" rel="stylesheet">
    <link href="../css/print.css" rel="stylesheet" media="print">
    <link href="../css/format-print.css" rel="stylesheet">
    <link href="../css/ie.css" rel="stylesheet">
    <script src="../js/url.js"></script>
    <script src="../js/variant.js"></script>
    <script>
      // hack to let hugo tell us how to get to the root when using relativeURLs, it needs to be called *url= for it to do its magic:
      // https://github.com/gohugoio/hugo/blob/145b3fcce35fbac25c7033c91c1b7ae6d1179da8/transform/urlreplacers/absurlreplacer.go#L72
      window.index_js_url="../index.search.js";
      var root_url="../";
      var baseUri=root_url.replace(/\/$/, '');
      // translations
      window.T_Copy_to_clipboard = 'Copier dans le presse-papiers';
      window.T_Copied_to_clipboard = 'Copié dans le presse-papiers !';
      window.T_Copy_link_to_clipboard = 'Copier le lien dans le presse-papiers';
      window.T_Link_copied_to_clipboard = 'Lien copié dans le presse-papiers !';
      window.T_No_results_found = 'Aucun résultat trouvé pour \u0022{0}\u0022';
      window.T_N_results_found = '{1} résultats trouvés pour \u0022{0}\u0022';
      // some further base stuff
      var baseUriFull='https:\/\/www.tssoc.oliduha.fr/';
      window.variants && variants.init( [ 'auto', 'relearn-bright', 'relearn-light', 'relearn-dark', 'learn', 'neon', 'blue', 'green', 'red' ] );
    </script>
    <style>
      #body img.bg-white {
        background-color: white;
      }
    </style>
  </head>
  <body class="mobile-support print disableInlineCopyToClipboard" data-url="../at3/index.html">
    <div id="body" class="default-animation">
      <div id="sidebar-overlay"></div>
      <div id="toc-overlay"></div>
      <nav id="topbar" class="highlightable">
        <div>
          <div id="breadcrumbs">
            <span id="sidebar-toggle-span">
              <a href="#" id="sidebar-toggle" class="topbar-link" title='Menu (CTRL+ALT+n)'><i class="fas fa-bars fa-fw"></i></a>
            </span>
            <ol class="links" itemscope itemtype="http://schema.org/BreadcrumbList">
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><a itemprop="item" href="../index.html"><span itemprop="name">TSSOC</span></a><meta itemprop="position" content="1"> > </li>
              <li itemscope itemtype="https://schema.org/ListItem" itemprop="itemListElement"><span itemprop="name">Maintenir et exploiter une infrastructure distribuée et contribuer à sa sécurisation</span><meta itemprop="position" content="2"></li>
            </ol>
          </div>
        </div>
      </nav>
      <main id="body-inner" class="highlightable chapter narrow" tabindex="-1">
        <div class="flex-block-wrapper">
          <div id="head-tags">
          </div>
          <article class="chapter">
<div class="article-subheading">Activité-Type 3</div>
<h1 id="maintenir-et-exploiter-une-infrastructure-distribuée-et-contribuer-à-sa-sécurisation">Maintenir et exploiter une infrastructure distribuée et contribuer à sa sécurisation</h1>

<hr>
<h4 id="1-configurer-serveur-de-déploiement-et-de-terminaux-légersat3at3e1">1. <a href="../at3/at3e1/">Configurer serveur de déploiement et de terminaux légers</a></h4>
<h4 id="2-automatiser-les-tâches-à-laide-de-scriptsat3at3e2">2. <a href="../at3/at3e2/">Automatiser les tâches à l&rsquo;aide de scripts</a></h4>
<h4 id="3-maintenir-et-sécuriser-les-accès-réseaux-distantsat3at3e3">3. <a href="../at3/at3e3/">Maintenir et sécuriser les accès réseaux distants</a></h4>
<h4 id="4-superviser-linfrastructureat3at3e4">4. <a href="../at3/at3e4/">Superviser l&rsquo;infrastructure</a></h4>
<h4 id="5-intervenir-dans-un-environnement-de-cloud-computingat3at3e5">5. <a href="../at3/at3e5/">Intervenir dans un environnement de Cloud Computing</a></h4>
<h4 id="6-assurer-sa-veille-technologiqueat3at3e6">6. <a href="../at3/at3e6/">Assurer sa veille technologique</a></h4>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Sous-sections de Maintenir et exploiter une infrastructure distribuée et contribuer à sa sécurisation</h1>
          <article class="chapter">
<div class="article-subheading">Chapitre 1</div>
<h1 id="configurer-serveur-de-déploiement-et-de-terminaux-légers">Configurer serveur de déploiement et de terminaux légers</h1>

<hr>
<h4 id="1-wds---mdtat3at3e1wds-mdt">1. <a href="../at3/at3e1/wds-mdt/">WDS - MDT</a></h4>
<h4 id="2-fogat3at3e1fog">2. <a href="../at3/at3e1/fog/">FOG</a></h4>
<h4 id="3-stage-armatisat3at3e1stage-armatis">3. <a href="../at3/at3e1/stage-armatis/">stage Armatis</a></h4>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Sous-sections de Configurer serveur de déploiement et de terminaux légers</h1>
          <article class="chapter">
<div class="article-subheading">Exemple 1</div>
<h1 id="wds---mdt">WDS - MDT</h1>

<hr>
<h1 id="wds">WDS</h1>
<h2 id="window-deployment-system">Window Deployment System</h2>
<p><strong>TP</strong></p>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p>Avec VMWare :</p>
<ul>
<li>1 VM IPFire avec la carte &ldquo;green&rdquo; sur 192.168.13.0/24 en Host Only côté lan</li>
<li>1 VM Windows Server AD-DS + DHCP en Host Only</li>
<li>1 VM Windows CLient vierge en Host Only</li>
</ul>
  </div>
</div>
<hr>
<h2 id="1---serveur-ad-ds-et-dhcp">1 - Serveur AD-DS et DHCP</h2>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<ul>
<li>Une VM Windows Server 2022 avec :
<ul>
<li>3-4 Go Ram</li>
<li>1 DD 40 GO (C:)</li>
<li>1 DD 60 GO (D:)</li>
<li>Host Only en 192.168.13.250/24 (fixe)</li>
<li>Rôle AD-DS puis</li>
<li>Rôle DHCP puis</li>
<li>Rôle WDS</li>
</ul>
</li>
</ul>
  </div>
</div>
<h3 id="installation-des-rôle">Installation des rôle</h3>
<p>Avant d&rsquo;installer le moindre rôle, on s&rsquo;assure de paramétrer le nom de la machine et sa carte réseau en IP fixe (192.168.13.250/24 ici) et on la reboot.</p>
<p>On installe d&rsquo;abord le rôle AD-DS puis promotion en Domain Controler et configuration d&rsquo;une forêt pour notre réseau local.</p>
<p>Ensuite vient le rôle DHCP et sa configuration.</p>
<p>Et enfin le rôle WDS et sa configuration :</p>
<blockquote>
<p>Durant l&rsquo;installation, à l&rsquo;étape de sélection des services de rôle, bien cocher les 2 options :</p>
<ul>
<li><code>Serveur de déploiement</code><br>
et</li>
<li><code>Serveur de transport</code></li>
</ul>
</blockquote>
<h3 id="configuration-initiale-de-wds">Configuration initiale de WDS</h3>
<ul>
<li>Une fois l&rsquo;installation du rôle WDS achevée, dans le  Gestionnaire de serveur, menu Outils, choisir <strong>Services de déploiement Windows</strong></li>
<li>Cliquer droit sur le serveur pour le configurer (il a une icone d&rsquo;alerte).</li>
<li>La 1ère fenêtre rappelle les prérequis pour le service. <em>Suivant</em></li>
<li>Choisir <strong>Intégré à Active Directory</strong>. <em>Suivant</em></li>
<li>Entrer le chemin où les images seront stoquées. Lui indiquer de créer le dossier <code>RemoteInstall</code> à la racine du disque <strong>D:</strong> <em>Suivant</em></li>
<li>Choisir <strong>Répondre à tous les ordinateurs clients (connus et inconnus)</strong>. <em>Suivant</em></li>
<li>Attentre que la configuration se termine et une nouvelle fenêtre apparaît. Ne pas sélectionner &ldquo;Ajouter les images au serveur maintenant&rdquo; et <em>Terminer</em></li>
</ul>
<p>
<a href="#image-7ef42d4d95c53238b31a9e95b2f4202b" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/01_1_Gestionnaire_WDS.png" alt="Gestionnaire_wds" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-7ef42d4d95c53238b31a9e95b2f4202b">
<img src="../at3/at3e1/wds-mdt/01_1_Gestionnaire_WDS.png" alt="Gestionnaire_wds" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="ajout-dimages">Ajout d&rsquo;images</h2>
<p>Il faut ajouter une image d&rsquo;un Windows qui servira de modèle pour nos futures déploiements :</p>
<ul>
<li>Ouvrir les &ldquo;Settings&rdquo; de la machine virtuelle (dans VMWare) et insérer l&rsquo;iso souhaité dans le lecteur CD-ROm de la VM.</li>
<li>Dans le gestionnaire WDS du serveur, sous le nom de notre serveur : clique droit sur <strong>Images d&rsquo;installation</strong> &gt; <strong>Ajouter une image d&rsquo;installation&hellip;</strong></li>
<li>Créer un groupe d&rsquo;images nommé : <code>nom_du_groupe</code> puis bouton <em>Suivant</em></li>
<li><em>Parcourir</em> puis, dans le dossier <strong>sources</strong> du CD-Rom, sélectionner le fichier <strong>install.wim</strong> et <em>Suivant</em></li>
<li>Si l&rsquo;ISO contient plusieurs versions, sélectionner uniquement celle que l&rsquo;on souhaite en décochant les autres, puis <em>Suivant</em></li>
<li>L&rsquo;assistant nous présente la version choisie, cliquer <em>Suivant</em></li>
<li>Après chargement du fichier, cliquer <em>Terminer</em></li>
</ul>
<p>
<a href="#image-38fe821fc9cf6df11295cd5abb7cd9a1" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/01_2_Image_Install.png" alt="Image_install_ajoutée" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-38fe821fc9cf6df11295cd5abb7cd9a1">
<img src="../at3/at3e1/wds-mdt/01_2_Image_Install.png" alt="Image_install_ajoutée" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Répéter le même principe pour l&rsquo;image de démarrage qui correspont au fichier <strong>boot.wim</strong> situé dans le même dossier du CD-Rom (pas de groupe ici).</li>
</ul>
<p>
<a href="#image-ebd53278c9bcd20deaabd74dd7066653" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/01_3_Image_Boot.png" alt="Image_boot_ajoutée" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ebd53278c9bcd20deaabd74dd7066653">
<img src="../at3/at3e1/wds-mdt/01_3_Image_Boot.png" alt="Image_boot_ajoutée" class="lightbox-image" loading="lazy">
</a></p>

<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Remarque</div>
  <div class="box-content">
<p>Pour une machine physique, il est possible que l’image de démarrage ne se charge pas du à une erreur de pilote, nous verrons plus loin comment ajouter des drivers aux services WDS et comment les intégrés aux images de démarrage et de capture.</p>
  </div>
</div>
<hr>
<h2 id="2---client-windows-10-vierge">2 - CLient Windows 10 vierge</h2>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p>Une VM Windows 10 vierge avec :</p>
<ul>
<li>1-2 GO Ram</li>
<li>1 DD de 30 GO</li>
<li>Host Only en DHCP</li>
<li>UEFI <em>(sans problème à partir de WinSrv 2022)</em></li>
<li>Boot en PXE</li>
<li>faire un snapshot pour éviter de recréer une VM pour chacun des tests.</li>
</ul>
  </div>
</div>
<p>Démarrer la machine sans OS ni ISO dans le lecteur CD et attendre qu&rsquo;elle boot en PXE.</p>
<p>Après choix de la langue et authentification (<a href="mailto:user@domaine.lan">user@domaine.lan</a> + mdp), l&rsquo;installation doit démarrer comme avec une version CD ordinaire. Si tout se passe bien l&rsquo;installation se poursuit jusqu&rsquo;à la fin, WDS est fonctionnel !</p>
<hr>
<h2 id="3---optimisation-avec-un-fichier-de-réponses">3 - Optimisation avec un fichier de réponses</h2>
<h5 id="prérequis-">Prérequis :</h5>
<ul>
<li>ADK et son outil WSIM (<strong>Assitant Gestion d&rsquo;Installation</strong>)</li>
<li>Une copie du fichier install.win (l&rsquo;image) de notre version de Windows à configurer</li>
</ul>
<p>
<a href="#image-069ce7787d799f15e70e4fe6a99d7bf7" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/02_1_WDSIM.png" alt="Assistant_Gestion_Installation" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-069ce7787d799f15e70e4fe6a99d7bf7">
<img src="../at3/at3e1/wds-mdt/02_1_WDSIM.png" alt="Assistant_Gestion_Installation" class="lightbox-image" loading="lazy">
</a></p>
<p>Il faut d&rsquo;abord ouvrir une image Windows : <code>Menu Fichier &gt; Sélectionner l'image Windows</code> et indiquer le fichier <strong>install.wim</strong> puis la verion souhaitée et enfin Valider la création du catalogue. La zone en bas à gauche <em>(Image Windows)</em> doit se peupler.</p>
<p>
<a href="#image-9a9b5f3d28ec64dbb05dd478c396c6dd" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/02_2_Image_Windows.png" alt="WSIM_image_win" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-9a9b5f3d28ec64dbb05dd478c396c6dd">
<img src="../at3/at3e1/wds-mdt/02_2_Image_Windows.png" alt="WSIM_image_win" class="lightbox-image" loading="lazy">
</a></p>
<h3 id="créer-un-nouveau-fichier-de-réponse">Créer un nouveau fichier de réponse</h3>
<p><strong>Paramètres régionaux</strong></p>
<p>Ajouter les paramètres amd64_Microsoft-Windows-International-Core-WinPE et configurer les propriétés suivantes :</p>
<ul>
<li>InputLocale : fr-FR</li>
<li>SystemLocale : fr-FR</li>
<li>UILanguage : fr-FR</li>
<li>UserLocale : fr-FR</li>
<li>SeteupUILanguage / UILanguage : fr-FR</li>
</ul>
<p><strong>Crédentials WDS</strong></p>
<p>Ajouter le paramètre WindowsDeploymentServices dans amd64_Microsoft-Windows-Setup et configurer les propriétés suivantes :</p>
<ul>
<li>Login / Credentials / Domain</li>
<li>Login / Credentials / Password</li>
<li>Login / Credentials / username</li>
</ul>
<p><strong>Licence et fuseau horaire</strong></p>
<p>Ajouter le paramètre WindowsDeploymentServices dans amd64_Microsoft-Windows-Shell-Setup et configurer les propriétés suivantes :</p>
<ul>
<li>TimeZone : (GMT+01:00) Brussels, Copenhagen, Madrid, Paris</li>
<li>OOBE / HideEULAPage : true</li>
<li>OOBE / NetworkLocation : Work</li>
<li>OOBE / SkipMachineOOBE : true</li>
<li>OOBE / SkipUserOOBE : true</li>
</ul>
<p><strong>Mot de passe de l’administrateur local</strong></p>
<p>Ajouter les paramètres UserAccounts qui se trouve dans amd64_Microsoft-Windows-Shell-Setup et configurer les propriétés suivantes :</p>
<ul>
<li>AdministratorPassword / Value : mot de passe</li>
</ul>
<blockquote>
<p>Enregistrer le fichier de réponse en unatended.xml <em>(par exemple)</em></p>
</blockquote>
<p>Fichier de réponse complet :</p>
<p><code>WDS_w10Pro_unatended.xml</code></p>
<p>
<a href="#image-bd692f514e1a3291b03a3950d7c9859e" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/02_3_WSIM_Comolet.png" alt="WSIM_complet" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-bd692f514e1a3291b03a3950d7c9859e">
<img src="../at3/at3e1/wds-mdt/02_3_WSIM_Comolet.png" alt="WSIM_complet" class="lightbox-image" loading="lazy">
</a></p>
<p>et son code xml :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="cp">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;unattend</span> <span class="na">xmlns=</span><span class="s">&#34;urn:schemas-microsoft-com:unattend&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;settings</span> <span class="na">pass=</span><span class="s">&#34;windowsPE&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&#34;Microsoft-Windows-International-Core-WinPE&#34;</span> <span class="na">processorArchitecture=</span><span class="s">&#34;amd64&#34;</span> <span class="na">publicKeyToken=</span><span class="s">&#34;31bf3856ad364e35&#34;</span> <span class="na">language=</span><span class="s">&#34;neutral&#34;</span> <span class="na">versionScope=</span><span class="s">&#34;nonSxS&#34;</span> <span class="na">xmlns:wcm=</span><span class="s">&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;SetupUILanguage&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;UILanguage&gt;</span>fr-FR<span class="nt">&lt;/UILanguage&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/SetupUILanguage&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;InputLocale&gt;</span>fr-FR<span class="nt">&lt;/InputLocale&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;SystemLocale&gt;</span>fr-FR<span class="nt">&lt;/SystemLocale&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UILanguage&gt;</span>fr-FR<span class="nt">&lt;/UILanguage&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UILanguageFallback&gt;</span>fr-FR<span class="nt">&lt;/UILanguageFallback&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UserLocale&gt;</span>fr-FR<span class="nt">&lt;/UserLocale&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/component&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&#34;Microsoft-Windows-Setup&#34;</span> <span class="na">processorArchitecture=</span><span class="s">&#34;amd64&#34;</span> <span class="na">publicKeyToken=</span><span class="s">&#34;31bf3856ad364e35&#34;</span> <span class="na">language=</span><span class="s">&#34;neutral&#34;</span> <span class="na">versionScope=</span><span class="s">&#34;nonSxS&#34;</span> <span class="na">xmlns:wcm=</span><span class="s">&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;DiskConfiguration&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;WillShowUI&gt;</span>OnError<span class="nt">&lt;/WillShowUI&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Disk</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;CreatePartitions&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;CreatePartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>1<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Size&gt;</span>500<span class="nt">&lt;/Size&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Type&gt;</span>Primary<span class="nt">&lt;/Type&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/CreatePartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;CreatePartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>2<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Size&gt;</span>100<span class="nt">&lt;/Size&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Type&gt;</span>EFI<span class="nt">&lt;/Type&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/CreatePartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;CreatePartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>3<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Size&gt;</span>16<span class="nt">&lt;/Size&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Type&gt;</span>MSR<span class="nt">&lt;/Type&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/CreatePartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;CreatePartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>4<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Type&gt;</span>Primary<span class="nt">&lt;/Type&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Extend&gt;</span>true<span class="nt">&lt;/Extend&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/CreatePartition&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/CreatePartitions&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;ModifyPartitions&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ModifyPartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Format&gt;</span>NTFS<span class="nt">&lt;/Format&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Label&gt;</span>WinRE<span class="nt">&lt;/Label&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>1<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;PartitionID&gt;</span>1<span class="nt">&lt;/PartitionID&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;TypeID&gt;</span>DE94BBA4-06D1-4D40-A16A-BFD50179D6AC<span class="nt">&lt;/TypeID&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/ModifyPartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ModifyPartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Format&gt;</span>FAT32<span class="nt">&lt;/Format&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Label&gt;</span>System<span class="nt">&lt;/Label&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>2<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;PartitionID&gt;</span>2<span class="nt">&lt;/PartitionID&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/ModifyPartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ModifyPartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>3<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;PartitionID&gt;</span>3<span class="nt">&lt;/PartitionID&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/ModifyPartition&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ModifyPartition</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Format&gt;</span>NTFS<span class="nt">&lt;/Format&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Label&gt;</span>Windows<span class="nt">&lt;/Label&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Letter&gt;</span>C<span class="nt">&lt;/Letter&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Order&gt;</span>4<span class="nt">&lt;/Order&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;PartitionID&gt;</span>4<span class="nt">&lt;/PartitionID&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/ModifyPartition&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/ModifyPartitions&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;DiskID&gt;</span>0<span class="nt">&lt;/DiskID&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;WillWipeDisk&gt;</span>true<span class="nt">&lt;/WillWipeDisk&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/Disk&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/DiskConfiguration&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;WindowsDeploymentServices&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Login&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;Credentials&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Domain&gt;</span>wds.local<span class="nt">&lt;/Domain&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Password&gt;</span>1nfr@2022NG<span class="nt">&lt;/Password&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Username&gt;</span>Administrateur<span class="nt">&lt;/Username&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/Credentials&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/Login&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;ImageSelection&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;InstallImage&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Filename&gt;</span>install.wim<span class="nt">&lt;/Filename&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ImageGroup&gt;</span>ImageGroup1<span class="nt">&lt;/ImageGroup&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;ImageName&gt;</span>Windows 10 Pro<span class="nt">&lt;/ImageName&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/InstallImage&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;InstallTo&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;DiskID&gt;</span>0<span class="nt">&lt;/DiskID&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;PartitionID&gt;</span>4<span class="nt">&lt;/PartitionID&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/InstallTo&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/ImageSelection&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/WindowsDeploymentServices&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/component&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/settings&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;settings</span> <span class="na">pass=</span><span class="s">&#34;oobeSystem&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&#34;Microsoft-Windows-International-Core&#34;</span> <span class="na">processorArchitecture=</span><span class="s">&#34;amd64&#34;</span> <span class="na">publicKeyToken=</span><span class="s">&#34;31bf3856ad364e35&#34;</span> <span class="na">language=</span><span class="s">&#34;neutral&#34;</span> <span class="na">versionScope=</span><span class="s">&#34;nonSxS&#34;</span> <span class="na">xmlns:wcm=</span><span class="s">&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;InputLocale&gt;</span>fr-FR<span class="nt">&lt;/InputLocale&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;SystemLocale&gt;</span>fr-FR<span class="nt">&lt;/SystemLocale&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UILanguage&gt;</span>fr-FR<span class="nt">&lt;/UILanguage&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UILanguageFallback&gt;</span>fr-FR<span class="nt">&lt;/UILanguageFallback&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UserLocale&gt;</span>fr-FR<span class="nt">&lt;/UserLocale&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/component&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;component</span> <span class="na">name=</span><span class="s">&#34;Microsoft-Windows-Shell-Setup&#34;</span> <span class="na">processorArchitecture=</span><span class="s">&#34;amd64&#34;</span> <span class="na">publicKeyToken=</span><span class="s">&#34;31bf3856ad364e35&#34;</span> <span class="na">language=</span><span class="s">&#34;neutral&#34;</span> <span class="na">versionScope=</span><span class="s">&#34;nonSxS&#34;</span> <span class="na">xmlns:wcm=</span><span class="s">&#34;http://schemas.microsoft.com/WMIConfig/2002/State&#34;</span> <span class="na">xmlns:xsi=</span><span class="s">&#34;http://www.w3.org/2001/XMLSchema-instance&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;OOBE&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;HideEULAPage&gt;</span>true<span class="nt">&lt;/HideEULAPage&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;HideLocalAccountScreen&gt;</span>true<span class="nt">&lt;/HideLocalAccountScreen&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;HideOEMRegistrationScreen&gt;</span>true<span class="nt">&lt;/HideOEMRegistrationScreen&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;HideOnlineAccountScreens&gt;</span>true<span class="nt">&lt;/HideOnlineAccountScreens&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;HideWirelessSetupInOOBE&gt;</span>true<span class="nt">&lt;/HideWirelessSetupInOOBE&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;ProtectYourPC&gt;</span>1<span class="nt">&lt;/ProtectYourPC&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/OOBE&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;UserAccounts&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;AdministratorPassword&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;Value&gt;</span>MQBuAGYAcgBAADIAMAAyADIATgBHAEEAZABtAGkAbgBpAHMAdAByAGEAdABvAHIAUABhAHMAcwB3AG8AcgBkAA==<span class="nt">&lt;/Value&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;PlainText&gt;</span>false<span class="nt">&lt;/PlainText&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/AdministratorPassword&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;LocalAccounts&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;LocalAccount</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Password&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Value&gt;</span>MQBuAGYAcgBAADIAMAAyADIATgBHAFAAYQBzAHMAdwBvAHIAZAA=<span class="nt">&lt;/Value&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;PlainText&gt;</span>false<span class="nt">&lt;/PlainText&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/Password&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;DisplayName&gt;</span>adissoir<span class="nt">&lt;/DisplayName&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Group&gt;</span>Administrateurs<span class="nt">&lt;/Group&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Name&gt;</span>adissoir<span class="nt">&lt;/Name&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/LocalAccount&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/LocalAccounts&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;DomainAccounts&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;DomainAccountList</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;Domain&gt;</span>wds.local<span class="nt">&lt;/Domain&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;DomainAccount</span> <span class="na">wcm:action=</span><span class="s">&#34;add&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Group&gt;</span>Administrateurs<span class="nt">&lt;/Group&gt;</span>
</span></span><span class="line"><span class="cl">                            <span class="nt">&lt;Name&gt;</span>adissoir<span class="nt">&lt;/Name&gt;</span>
</span></span><span class="line"><span class="cl">                        <span class="nt">&lt;/DomainAccount&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;/DomainAccountList&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/DomainAccounts&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/UserAccounts&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;AutoLogon&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Password&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;Value&gt;</span>MQBuAGYAcgBAADIAMAAyADIATgBHAFAAYQBzAHMAdwBvAHIAZAA=<span class="nt">&lt;/Value&gt;</span>
</span></span><span class="line"><span class="cl">                    <span class="nt">&lt;PlainText&gt;</span>false<span class="nt">&lt;/PlainText&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;/Password&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Domain&gt;</span>wds.local<span class="nt">&lt;/Domain&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Enabled&gt;</span>true<span class="nt">&lt;/Enabled&gt;</span>
</span></span><span class="line"><span class="cl">                <span class="nt">&lt;Username&gt;</span>adissoir<span class="nt">&lt;/Username&gt;</span>
</span></span><span class="line"><span class="cl">            <span class="nt">&lt;/AutoLogon&gt;</span>
</span></span><span class="line"><span class="cl">        <span class="nt">&lt;/component&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/settings&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;cpi:offlineImage</span> <span class="na">cpi:source=</span><span class="s">&#34;wim:c:/users/olivier/d/iso/windows_10_pro_cefim_21h2_fev22/sources/install.wim#Windows 10 Pro&#34;</span> <span class="na">xmlns:cpi=</span><span class="s">&#34;urn:schemas-microsoft-com:cpi&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/unattend&gt;</span>
</span></span></code></pre></div><h3 id="ajour-du-fichier-de-réponse-à-wds">Ajour du fichier de réponse à WDS</h3>
<ul>
<li>
<p>Copier le fichier dans le dossier <strong><code>RemoteInstall</code></strong> du serveur WDS.</p>
</li>
<li>
<p>Depuis la console faire un clic droit sur le serveur et cliquer sur <code>Propriétés</code> &gt; onglet <code>Client</code> et ajouter le fichier de réponse aux 2 sections de l&rsquo;architecture adéquate (x86 ou x64) normale et UEFI. Puis Valider.</p>
</li>
</ul>
<p>
<a href="#image-f9127ad2ec4f741e9acd497d74f3712f" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/03_1_Propri%C3%A9t%C3%A9s_WDS_Clients.png" alt="Propriétés_WDS_Clients" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-f9127ad2ec4f741e9acd497d74f3712f">
<img src="../at3/at3e1/wds-mdt/03_1_Propri%C3%A9t%C3%A9s_WDS_Clients.png" alt="Propriétés_WDS_Clients" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Clique droit sur l&rsquo;image et <code>Propriétés</code>. Sélectionner <code>Autoriser l'image à s'installer en mode sans assistance</code> et <code>Selectionner un fichier...</code> pour indiquer le fichier de réponse. Valider.</li>
</ul>
<p>
<a href="#image-819a87a5c53dc08215693b1c49fcb220" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/03_2_Propri%C3%A9t%C3%A9s_Image.png" alt="Propriétés_Image" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-819a87a5c53dc08215693b1c49fcb220">
<img src="../at3/at3e1/wds-mdt/03_2_Propri%C3%A9t%C3%A9s_Image.png" alt="Propriétés_Image" class="lightbox-image" loading="lazy">
</a></p>
<blockquote>
<p>Tester le fichier de réponse</p>
</blockquote>
<hr>
<h3 id="ajout-de-pilotes-pour-des-machines-réelleshttpsrdr-itcomwds-installation-et-configuration9"><a href="https://rdr-it.com/wds-installation-et-configuration/9/" target="_blank">Ajout de pilotes pour des machines réelles</a></h3>
<hr>
<h2 id="créer-une-image-de-capture">Créer une image de capture</h2>
<p>Pour créer une capture d&rsquo;une VM existante, il faut préparer le serveur et la machine à capturer.</p>
<p><em><code>Sur le serveur WDS</code></em> :</p>
<p>Ajouter une image de capture (boot) sur le serveur :</p>
<p>Cliquer droit sur l&rsquo;image de boot créée précédemment et choisir <strong>Créer une image de capture&hellip;</strong> ; lui donner un nom (capture), une description et lui indiquer le chemin du dossier partagé du serveur et un nom de fichier : <code>D:\RemoteInstall\WdsClientUnattend\capture.wim</code>.</p>
<p>
<a href="#image-adfb5e36df3dc90ac974a5a584a3cde5" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/04_capture_wim.png" alt="capture.wim" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-adfb5e36df3dc90ac974a5a584a3cde5">
<img src="../at3/at3e1/wds-mdt/04_capture_wim.png" alt="capture.wim" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-e663575dcc7624f792d7af8a3f4ee584" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/05_capture_image_boot.png" alt="capture_image_boot.png" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-e663575dcc7624f792d7af8a3f4ee584">
<img src="../at3/at3e1/wds-mdt/05_capture_image_boot.png" alt="capture_image_boot.png" class="lightbox-image" loading="lazy">
</a></p>
<p><em><code>Sur la machine à capturer</code></em> :</p>
<ul>
<li>
<p>Aller dans le dossier <code>C:\Windows\system32\sysprep</code> et exécuter <code>sysprep.exe</code></p>
</li>
<li>
<p>Dans la fenêtre de sysprep, sélectionner <strong>Audit</strong> et <strong>ne pas cocher Generalize</strong>, et <strong>Redémarrer</strong> puis Valider.</p>
</li>
</ul>
<p>Sysprep prépare la machine puis la reboot. Une fois redémarrée, installer sur la machine les logiciels à intégrer à l&rsquo;image qui sera capturée.</p>
<p>Une fois tous les logiciels souhaités installés, relancer l&rsquo;outil <code>sysprep</code> en choisissant <strong>OOBE</strong>, <strong>Generalize</strong> et <strong>Eteindre</strong> (<code>ne pas choisir redémarrer</code> ici, car la machine devra booter en PXE au prochain démarrage).</p>
<ul>
<li>À la fin de l&rsquo;opération, la machine doit s&rsquo;éteindre. La redémarrer en forçant le boot sur le firmware (BIOS/UEFI - avec l&rsquo;option de démarrage <code>Power On to Firmware</code> de VMWare), et choisir le démarrage <code>Network</code> (PXE) pour que le serveur puisse l&rsquo;intercepter.</li>
</ul>
<p>Si demandé durant le boot PXE, appuyer sur F12 ou Entrée puis choisir l&rsquo;option de boot <strong>capture</strong>.</p>
<p>L&rsquo;Assistant de Capture d&rsquo;image des services de déploiement Windows affiche une fenêtre de démarrage, cliquer <code>Suivant &gt;</code>.</p>
<ul>
<li>
<p>1 - <code>Répertoire à capturer</code></p>
<ul>
<li>Volume : <strong>C:\</strong></li>
<li>Nom de l&rsquo;image : Un nom pour l&rsquo;image capturée (<strong>win10master</strong>)</li>
<li>Description de l&rsquo;image (<strong>Windows 10 - Master</strong>)</li>
<li>Cliquer <code>Suivant &gt;</code></li>
</ul>
</li>
<li>
<p>2 - <code>Nouvel emplacement de l'image</code></p>
<ul>
<li>Nom et emplacement : Parcourir : <strong>C:\Users\Public\Documents\</strong> et <code>win10master</code> (.wim automatiquement ajouté).</li>
<li><strong>Cocher</strong> Charger l&rsquo;image sur un serveur[&hellip;]</li>
<li>Nom du serveur : Le nom ou l&rsquo;adresse IP du serveur (<strong>winsrv22wds</strong>) puis <code>Connexion</code>
Se rendre sur le serveur &gt; AD Utilisateurs et Ordinateurs et Propriétés de l&rsquo;utilisateur <code>Administrateur</code>, onglet Compte : indiquer <strong>administrateur</strong> et domaine (<strong>wds.local</strong>) puis valider
<ul>
<li>Nom d&rsquo;utilisateur : <strong><a href="mailto:administrateur@wds.local">administrateur@wds.local</a></strong></li>
<li>Mot de passe : Le mote de passe de l&rsquo;administrateur du serveur</li>
<li><code>OK</code></li>
</ul>
</li>
<li>Si la connexion réussit, les groupes d&rsquo;images du serveur sont chargées dans la liste déroulante : choisir celle souhaitée.</li>
<li>Cliquer <code>Suivant &gt;</code></li>
</ul>
</li>
<li>
<p>3 - La capture de l&rsquo;image démarre</p>
</li>
<li>
<p>4 - Une fois terminé, Cliquer <code>Terminer</code></p>
</li>
</ul>
<p>
<a href="#image-9f77a454744daaf67959e312c0e3f0c0" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/07_machine_capture.png" alt="machine_capture" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-9f77a454744daaf67959e312c0e3f0c0">
<img src="../at3/at3e1/wds-mdt/07_machine_capture.png" alt="machine_capture" class="lightbox-image" loading="lazy">
</a></p>
<p>La machine redémarre et la nouvelle image d&rsquo;installation apparaît dans le groupe choisi du Gestionnaire WDS sur le serveur.</p>
<p>Il ne reste plus qu&rsquo;à lui créer son propre fichier de réponse à partir d&rsquo;une copie du 1er ficher dont on modifie uniquement les propriétés propres à l&rsquo;image WDS (Nom, Groupe et Nom de fichier), copier de xml sur le serveur dans <code>RemoteInstall\WdsClientUnattend\</code> et l&rsquo;affecter à la nouvelle image par ses propriétés.</p>
<p>
<a href="#image-ecb60021c9be9bc0fb7cc56fb6ee9a68" class="lightbox-link">
<img src="../at3/at3e1/wds-mdt/08_capture_ready_to_deploy.png" alt="capture_ready_to_deploy" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ecb60021c9be9bc0fb7cc56fb6ee9a68">
<img src="../at3/at3e1/wds-mdt/08_capture_ready_to_deploy.png" alt="capture_ready_to_deploy" class="lightbox-image" loading="lazy">
</a></p>
<p>Lors du prochain déploiement, une nouvelle fenêtre apparaitra permettant de choisir l&rsquo;image à déployer et proposant notre image nouvellement crée. Si le fichier de réponse est correct, l&rsquo;installation se poursuivra sans intervention jusqu&rsquo;au 1er login du système.</p>
<hr>
<h2 id="ajout-de-logiciel-via-une-gpo-dans-ad">Ajout de logiciel via une GPO dans AD</h2>
<p>Il faut, en 1er lieu, intégrer la machine au domaine, et la placer dans une UO (par ex : <code>Ordinateurs</code>). Puis créer un dossier partagé accessible à tous les ordinateurs du domaine et tous les utilisateurs du domaine en Lecture et y placer le logiciel à déployer.</p>
<p>Dans la console Gestion des stratégies de groupe, créer une nouvelle GPO sur cette UO :
Configuration ordinateur/Stratégies/Paramètres du logiciel/ clique droit sur Installation de logiciel &gt; Nouveau &gt; Package&hellip;</p>
<p>Indiquer l&rsquo;emplacement du logiciel <strong>sur le réseau</strong> (ex : \WINSRV22WDS\Share) puis à l&rsquo;onglet <code>Déploiement</code> indiquer le type <strong>Attribué</strong>. Valider et fermer le gestionnaire de GPO.</p>
<p>Patienter quelques minutes, le logiciel devrait s&rsquo;installer sur les postes présents dans l&rsquo;UO concernée.</p>
<p><em>Il est toujours possible de forcer la mise à jour des stratégies via un terminal sur le poste client :</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">gpupdate /Force
</span></span></code></pre></div><hr>
<h1 id="mdt">MDT</h1>
<h2 id="microsoft-deployment-toolkit">Microsoft Deployment Toolkit</h2>
<h2 id="1-déployer-windows-avec-wds-et-mdthttpsrdr-itcomdeployer-windows-avec-mdt-et-wds">1. <a href="https://rdr-it.com/deployer-windows-avec-mdt-et-wds/" target="_blank">Déployer Windows avec WDS et MDT</a></h2>
<h2 id="2-mdt--utilisation-avec-une-base-de-donnéeshttpsrdr-itcommdt-utilisation-base-de-donnees">2. <a href="https://rdr-it.com/mdt-utilisation-base-de-donnees/" target="_blank">MDT : utilisation avec une base de données</a></h2>
<h2 id="3-mdt-installation-des-applications-lors-du-déploiement-de-windowshttpsrdr-itcommdt-installation-des-applications-lors-du-deploiement-de-windows">3. <a href="https://rdr-it.com/mdt-installation-des-applications-lors-du-deploiement-de-windows/" target="_blank">MDT installation des applications lors du déploiement de Windows</a></h2>
<h2 id="4-mdt--personnaliser-les-fenetres-de-lassistant-winpe-ltihttpsrdr-itcommdt-personnaliser-les-fenetres-de-lassistant-winpe-lti">4. <a href="https://rdr-it.com/mdt-personnaliser-les-fenetres-de-lassistant-winpe-lti/" target="_blank">MDT : personnaliser les fenetres de l’assistant WinPE (LTI)</a></h2>
<hr>
<h2 id="les-bonnes-pratiques-itil-lors-de-vos-déploiementshttpsopenclassroomscomfrcourses2013451-mettez-en-place-les-bonnes-pratiques-itil-lors-de-vos-deploiements"><a href="https://openclassrooms.com/fr/courses/2013451-mettez-en-place-les-bonnes-pratiques-itil-lors-de-vos-deploiements" target="_blank">Les bonnes pratiques ITIL lors de vos déploiements</a></h2>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="chapter">
<div class="article-subheading">Exemple 2</div>
<h1 id="fog">FOG</h1>

<hr>
<h2 id="-fog-projecthttpsfogprojectorg">&gt; <a href="https://fogproject.org/" target="_blank">FOG Project</a></h2>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p>TP : On crée 4 VMs dans un réseau en &ldquo;Host Only&rdquo; :</p>
<ul>
<li>1 IPFire avec 2 cartes réseau qui ont des adresses MAC différentes.
<ul>
<li>1 carte RED en Bridge vers l&rsquo;extérieur du réseau (DHCP ou fixe)</li>
<li>1 carte GREEN en Host Only comme passerelle du réseau H.O. en 192.168.13.254 fixe</li>
</ul>
</li>
<li>1 Debian 11 en Serveur FOG (DD 60 GO) en Host Only en 192.168.13.222 fixe - Serveur DHCP ! (+ TFTP &amp;  iPXE)</li>
<li>1 Poste &ldquo;Master&rdquo; Windows 10 en H.O. DHCP</li>
<li>1 Poste sans OS (config pour win10 - DD &gt;= au master)</li>
</ul>
  </div>
</div>
<p>
<a href="#image-0174fd912a27f888e53c642635150736" class="lightbox-link">
<img src="../at3/at3e1/fog/00_schema_reseau.png" alt="reseau" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-0174fd912a27f888e53c642635150736">
<img src="../at3/at3e1/fog/00_schema_reseau.png" alt="reseau" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h2 id="1---ipfire">1 - IPFire</h2>
<p>Télécharger l&rsquo;ISO et en faire une VM.</p>
<p>Doc : <a href="https://wiki.ipfire.org/installation" target="_blank">Installation d&rsquo;IPFire</a> ou sur <a href="https://neptunet.fr/ipfire-install/" target="_blank">neptunet</a></p>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<blockquote>
<p>Ne pas activer le DHCP et configurer les cartes réseau comme demandé (noter les adresses MAC de chaque carte pour bien les différencier)</p>
</blockquote>
  </div>
</div>
<p>
<a href="#image-addfcbdded91ef5b3da7a04c37549684" class="lightbox-link">
<img src="../at3/at3e1/fog/01_ipfire.png" alt="IPFire" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-addfcbdded91ef5b3da7a04c37549684">
<img src="../at3/at3e1/fog/01_ipfire.png" alt="IPFire" class="lightbox-image" loading="lazy">
</a></p>
<blockquote>
<p>En cas de besoin, on peux entrer dans la configuration d&rsquo;IPFire à posteriori via la commande :</p>
</blockquote>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">setup
</span></span></code></pre></div><hr>
<h2 id="2---fog">2 - FOG</h2>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p>Bien être en <strong>Bridge</strong> jusqu&rsquo;à la fin du téléchargement, puis repasser en <strong>Host Only AVANT</strong> de lancer l&rsquo;installation !</p>
  </div>
</div>

<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Remarque</div>
  <div class="box-content">
<p><em>Une doc en ligne sur <a href="https://chrtophe.developpez.com/tutoriels/deploiement-fogproject/" target="_blank">https://chrtophe.developpez.com/tutoriels/deploiement-fogproject/</a></em></p>
  </div>
</div>
<p>Partir d&rsquo;une debian 11 vierge.</p>
<p>Se logger en root :</p>
<p><strong>Configurer IP Fixe, masque (192.168.13.222/24) et gateway (192.168.13.254)</strong></p>
<p>Puis :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install git -y
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /root
</span></span><span class="line"><span class="cl">git clone https://github.com/fogproject/fogproject.git
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> fogproject-dev-branch
</span></span></code></pre></div>
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Remarque</div>
  <div class="box-content">
<p>Pour debian 11 il faut passer sur la dev-branch (pour la version actuelle 1.5.9)</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">git checkout dev-branch
</span></span></code></pre></div>  </div>
</div>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p>Passer la carte réseau en Host Only <strong>MAINTENANT</strong> !</p>
  </div>
</div>
<p>Installation :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> bin
</span></span></code></pre></div><p>&hellip;si toujours dans /root/fogproject-dev-branch ; sinon : <code>cd /root/fogproject-dev-branch/bin</code></p>
<p>puis</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">./installfog.sh
</span></span></code></pre></div>
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p><em>Les réponses en MAJUSCULES sont celles par défaut</em></p>
  </div>
</div>
<p><strong><code>Choisir : Debian</code></strong></p>
<p><strong><code>Choisir : installation Normale</code></strong></p>
<p><strong><code>Configurer l'IP</code></strong></p>
<p><strong><code>Ne pas changer la carte réseau par défaut</code></strong></p>
<p><strong><code>Activer DNS et DHCP</code></strong></p>
<p><strong><code>Installer les packs de langues</code></strong></p>
<p><strong><code>Activer HTTPS</code></strong></p>
<p><strong><code>Renommer la machine si besoin (Hostname)</code></strong></p>
<p>Récap. + validation =&gt; le script d&rsquo;install se lance&hellip;</p>
<p>Lorque c&rsquo;est terminé, il affiche une URL qu&rsquo;il demande d&rsquo;ouvrir dans le navigateur avant de pouvoir finaliser l&rsquo;install : <code>https://ip_du_serveur/fog/management</code></p>
<p>Une fois l&rsquo;url ouverte dans le navigateur de notre hôte (la machine qui fait tourner VMWare) on doit cliquer <code>Install/Update Database</code>.</p>
<p>
<a href="#image-ead7b4a0f5901a4a2c69ebe5c44644b3" class="lightbox-link">
<img src="../at3/at3e1/fog/02_1_Fog_Validate_Database.png" alt="Fog_Validate_Database" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ead7b4a0f5901a4a2c69ebe5c44644b3">
<img src="../at3/at3e1/fog/02_1_Fog_Validate_Database.png" alt="Fog_Validate_Database" class="lightbox-image" loading="lazy">
</a></p>
<p>On peut ensuite retourner sur la VM FOG pour finaliser l&rsquo;installation avec &ldquo;Entrée&rdquo;.</p>
<p>
<a href="#image-f139018fc29e900d03096affa3849215" class="lightbox-link">
<img src="../at3/at3e1/fog/02_2_Fog_Install_End.png" alt="Fog_Install_End" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-f139018fc29e900d03096affa3849215">
<img src="../at3/at3e1/fog/02_2_Fog_Install_End.png" alt="Fog_Install_End" class="lightbox-image" loading="lazy">
</a></p>
<p>Il faut ensuite se rendre dans le navigateur à <code>https://ip_du_serveur/fog/</code></p>
<p>&hellip;et se logger avec <strong><code>fog/password</code></strong> <em>(par défaut)</em> pour atterrir sur le Dashboard de FOG.</p>
<p>
<a href="#image-5e333ae575f68a5c23a1c678c75ff3ca" class="lightbox-link">
<img src="../at3/at3e1/fog/02_3_fog_dashboard.png" alt="Dashboard FOG" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-5e333ae575f68a5c23a1c678c75ff3ca">
<img src="../at3/at3e1/fog/02_3_fog_dashboard.png" alt="Dashboard FOG" class="lightbox-image" loading="lazy">
</a></p>
<h3 id="serveur-dhcp">Serveur DHCP</h3>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p><strong>Il faut impérativement désactiver tout DHCP présent sur le réseau local.</strong> Ici c&rsquo;est notre serveur FOG qui servira de DHCP.<br>
<em>Si ce n&rsquo;est pas possible, le client lors du boot PXE demandera l&rsquo;IP du serveur TFTP, il faudra indiquer l&rsquo;IP de FOG</em></p>
  </div>
</div>
<h3 id="désinstallationreconfiguration-de-fog">Désinstallation/Reconfiguration de fog</h3>
<p>En cas d&rsquo;erreur ou simplement de besoin de reconfiguration du serveur FOG, il suffit de renommer le fichier .fogsettings situé dans le dossier /opt/fog/</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mv /opt/fog/.fogsettings /opt/fog/fogsettings.bak
</span></span></code></pre></div><p>On peut ensuite relancer le script shell d&rsquo;installation</p>
<p><strong>En Production il est important de créer un nouvel utilisateur pour remplacer celui par défaut qui doit être ensuite désactivé.</strong></p>
<hr>
<h2 id="3---enregistrement-et-inventaire-du-master">3 - Enregistrement et inventaire du Master</h2>
<hr>
<blockquote>
<p>Un master est une machine qui servira de modèle pour le déploiement sur les autres postes. Elle doit avoir un OS installé et configuré de manière générique (réseau en DHCP&hellip;) et peut contenir des logiciels et/ou des scripts à répliquer sur toutes les autres machines.<br>
<em>Les possibilités de FOG dans ce domaine en font un outil très puissant</em>.</p>
</blockquote>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p><strong>Ne PAS spécifier de domaine dans le master ! Celui-ci devra être intégré post-déploiement, machine par machine, avec nom utilisateur, mdp, et en forçant le reboot.</strong></p>
  </div>
</div>
<p>Pour enregistrer un poste de travail dans fog, il faut le faire démarrer sur la carte réseau en PXE (Network boot dans le bios ou UEFI de la machine).</p>
<p>
<a href="#image-c6f7d7189767b2bcbc1defc0ba98d585" class="lightbox-link">
<img src="../at3/at3e1/fog/03_vmw_master_bios_pxe.png" alt="Config_Bios" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-c6f7d7189767b2bcbc1defc0ba98d585">
<img src="../at3/at3e1/fog/03_vmw_master_bios_pxe.png" alt="Config_Bios" class="lightbox-image" loading="lazy">
</a></p>
<blockquote>
<p><em>Une autre méthode pour inventorier le Master (uniquement) automatiquement est d&rsquo;y installer le &ldquo;FOG client smart installer&rdquo; au préalable, en lui spécifiant l&rsquo;IP du serveur FOG à l&rsquo;install.</em></p>
<p><em>Le poste sera alors reconnu et inventorié automatiquement après un redémarrage ordinaire.</em></p>
<p><em>Autre avantage de cette méthode, le client sera intégré à l&rsquo;image de déploiement !</em></p>
<p><em>SmartInstaller à télécharger sur</em> <strong><a href="https://github.com/FOGProject/fog-client/releases" target="_blank">https://github.com/FOGProject/fog-client/releases</a></strong></p>
</blockquote>
<p>Lors du boot PXE, la machine est interceptée par FOG et arrive sur un menu spécifique :</p>
<p>
<a href="#image-50fe88c5ff700e6ed17d7d8c2b8a8ba4" class="lightbox-link">
<img src="../at3/at3e1/fog/04_1_vwm_master_fog_menu_1.png" alt="Menu_Fog_unregistered" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-50fe88c5ff700e6ed17d7d8c2b8a8ba4">
<img src="../at3/at3e1/fog/04_1_vwm_master_fog_menu_1.png" alt="Menu_Fog_unregistered" class="lightbox-image" loading="lazy">
</a></p>
<p>Sélectionner <strong><code>Quick Registration and Inventory</code></strong> pour lancer la procédure d&rsquo;enregistrement de la machine qui va se dérouler sans autre intervention, et après un reboot, revenir à ce menu en indiquant le nom qui lui a été affecté par FOG, en en-têtte <em>(peut être son adresse MAC)</em> :</p>
<p>
<a href="#image-56f4053282d8e36a8dffa12de6ea8f80" class="lightbox-link">
<img src="../at3/at3e1/fog/04_2_vwm_master_fog_menu_2.png" alt="Menu_fog_registered" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-56f4053282d8e36a8dffa12de6ea8f80">
<img src="../at3/at3e1/fog/04_2_vwm_master_fog_menu_2.png" alt="Menu_fog_registered" class="lightbox-image" loading="lazy">
</a></p>
<p>On peut vérifier dans l&rsquo;interface web de FOG que la machine est enregistrée en cliquant l&rsquo;icone <strong>Hosts</strong> dans la barre du haut puis <strong>List All Hosts</strong> dans le menu de gauche.</p>
<p>
<a href="#image-2d6981eeee20955707a026e0f01bcc94" class="lightbox-link">
<img src="../at3/at3e1/fog/05_1_fog_host_master.png" alt="Fog_hosts_master" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-2d6981eeee20955707a026e0f01bcc94">
<img src="../at3/at3e1/fog/05_1_fog_host_master.png" alt="Fog_hosts_master" class="lightbox-image" loading="lazy">
</a></p>
<p>On peut changer ses nom et description en cliquant dessus :</p>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p><strong>Ne pas oublier de valider chaque action effectuée dans l&rsquo;interface web</strong></p>
  </div>
</div>
<p>
<a href="#image-a06a814d8b14148c71c195ceb5bf99fa" class="lightbox-link">
<img src="../at3/at3e1/fog/05_2_fog_host_master_details.png" alt="Fog_hosts_master_details" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-a06a814d8b14148c71c195ceb5bf99fa">
<img src="../at3/at3e1/fog/05_2_fog_host_master_details.png" alt="Fog_hosts_master_details" class="lightbox-image" loading="lazy">
</a></p>
<h3 id="4---capture-de-limage-du-master">4 - Capture de l&rsquo;image du Master</h3>
<p><strong>On doit ensuite faire une <em>image</em> de notre master&hellip; Mais avant, il faut créer un conteneur pour la stocker.</strong></p>
<p>Il faut donc cliquer sur l&rsquo;icone <strong>Images</strong> <em>(barre du haut)</em> puis <strong>Create New Image</strong> <em>(menu de gauche)</em> et lui donner un nom explicite. Il faut également lui spécifier le système d&rsquo;exploitation ainsi que le type d&rsquo;image.</p>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p>Pour une image windows 10 il faut choisir l&rsquo;option 3 (ou 2 si 1 seul dd) : <strong>Multiple partition image - All disks (not resizable)</strong></p>
  </div>
</div>
<p>
<a href="#image-dd88007788db9a4b42e752547357852e" class="lightbox-link">
<img src="../at3/at3e1/fog/06_1_fog_image_master_details.png" alt="Master_Image" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-dd88007788db9a4b42e752547357852e">
<img src="../at3/at3e1/fog/06_1_fog_image_master_details.png" alt="Master_Image" class="lightbox-image" loading="lazy">
</a></p>
<p>Ce qui donne :</p>
<p>
<a href="#image-adf1b9552d849b00b34fe65818ccd94e" class="lightbox-link">
<img src="../at3/at3e1/fog/06_2_fog_images_master.png" alt="Imges" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-adf1b9552d849b00b34fe65818ccd94e">
<img src="../at3/at3e1/fog/06_2_fog_images_master.png" alt="Imges" class="lightbox-image" loading="lazy">
</a></p>
<p>Nous pouvons à présent créer une tâche de capture assignée à notre master : de retours sur la page <strong>Host Management</strong> cliquer sur le nom du master pour lui indiquer le conteneur où stocker l&rsquo;image à la ligne <strong>Host image</strong>. Sélectionner ensuite <strong>Basic Tasks</strong> dans les onglets juste au-dessus et enfin l&rsquo;icone <strong>Capture</strong> :</p>
<p>
<a href="#image-ca3c728dd6887d21b8c40a5c82b2489b" class="lightbox-link">
<img src="../at3/at3e1/fog/07_1_fog_host_task.png" alt="Master_Capture" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ca3c728dd6887d21b8c40a5c82b2489b">
<img src="../at3/at3e1/fog/07_1_fog_host_task.png" alt="Master_Capture" class="lightbox-image" loading="lazy">
</a></p>
<p>Dans la fenêtre suivante, sélectionner <strong>Wake On Lan</strong> et <strong>Schedule Instant</strong>. Valider.</p>
<p>La tâche doit apparaître dans la page Task Management acessible via l&rsquo;icone <strong>Tasks</strong> <em>(barre du haut)</em> &gt; <strong>Active Tasks</strong> <em>(menu de gauche)</em>. On peut également suivre sont avancement à cet endroit.</p>
<p>Il suffit désormais de (re)démarrer la VM master en PXE pour obtenir le menu FOG et y choisir l&rsquo;option <strong>Capture</strong> pour démarrer la procédure automatique :</p>
<p>
<a href="#image-3855cfd23539a5c1ba7efd487e641efd" class="lightbox-link">
<img src="../at3/at3e1/fog/07_2_master_capture.png" alt="Master_Capture_VM" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-3855cfd23539a5c1ba7efd487e641efd">
<img src="../at3/at3e1/fog/07_2_master_capture.png" alt="Master_Capture_VM" class="lightbox-image" loading="lazy">
</a></p>
<p>Opération qu&rsquo;on peut donc aussi suivre sur l&rsquo;interface web (et donc à distance) :</p>
<p>
<a href="#image-1c4f73432850cbbaf9722314c400e578" class="lightbox-link">
<img src="../at3/at3e1/fog/07_3_fog_master_capture.png" alt="Master_Capture_Fog" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1c4f73432850cbbaf9722314c400e578">
<img src="../at3/at3e1/fog/07_3_fog_master_capture.png" alt="Master_Capture_Fog" class="lightbox-image" loading="lazy">
</a></p>
<p>Une fois l&rsquo;opération terminée, l&rsquo;image est disponible pour déploiement&hellip;</p>
<p>
<a href="#image-3471cb9215682d5e44911a23ebbbfc99" class="lightbox-link">
<img src="../at3/at3e1/fog/07_4_Master_capture_done.png" alt="Master_Capture_Done" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-3471cb9215682d5e44911a23ebbbfc99">
<img src="../at3/at3e1/fog/07_4_Master_capture_done.png" alt="Master_Capture_Done" class="lightbox-image" loading="lazy">
</a></p>
<p>À ce stade, nous n&rsquo;avons plus besoin de la machine Master. On peut lui remettre son mode de boot précédent et/ou l&rsquo;éteindre.</p>
<hr>
<h2 id="déploiement">Déploiement</h2>
<blockquote>
<p>Nous n&rsquo;allons ici déployer l&rsquo;image créée précédemment que sur une seule machine ; dans le cas d&rsquo;un déploiement sur un parc entier, nous stockerions nos enregistrements de machines dans un groupe afin de l&rsquo;effectuer en une seule opération.</p>
</blockquote>
<p>Nous créons une VM en Host Only, sans OS mais configurée pour recevoir un Windows 10 et avec au moins autant de capacité de disque dur que le master.</p>
<p>Les machines cibles du déploiement doivent au préalable être enregistrées et inventoriées dans FOG par la même procédure que pour le Master (boot en PXE et Quick registration and Inventory).</p>
<p>
<a href="#image-4110266e2c66617f63799c2d2784d984" class="lightbox-link">
<img src="../at3/at3e1/fog/08_vmw_client_apres_enreg.png" alt="VMW_Client_Inventaire" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-4110266e2c66617f63799c2d2784d984">
<img src="../at3/at3e1/fog/08_vmw_client_apres_enreg.png" alt="VMW_Client_Inventaire" class="lightbox-image" loading="lazy">
</a></p>
<p>Une fois notre machine inventoriée, on clique sur <strong>Hosts</strong> <em>(barre du haut)</em>, <strong>List All Hosts</strong> <em>(menu de gauche)</em> puis sur notre nouvelle machine pour la renommer et lui spécifier notre image précédemment créée <em>(Host image)</em>. Enfin on clique sur <strong>Basic Tasks</strong> <em>(onglet)</em> et l&rsquo;icone <strong>Deploy</strong> puis les options <strong>Wake On Lan</strong> et <strong>Schedule Instant</strong> dans la fenêtre suivante. On valide cette tâche qui se retrouve à présent dans la liste des tâches actives <em>(comme pour la tâche de capture du master)</em>.</p>
<p>
<a href="#image-1783dc445623e2492817478bc7cb22f8" class="lightbox-link">
<img src="../at3/at3e1/fog/09_Fog_Hosts_Client.png" alt="Fog_Hosts_Client" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1783dc445623e2492817478bc7cb22f8">
<img src="../at3/at3e1/fog/09_Fog_Hosts_Client.png" alt="Fog_Hosts_Client" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-d657cabf6a73f2fc90431e0e74ce8cfc" class="lightbox-link">
<img src="../at3/at3e1/fog/10_1_Client_Deploy_New_Task_.png" alt="Fog_Client_Task_Deploy" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-d657cabf6a73f2fc90431e0e74ce8cfc">
<img src="../at3/at3e1/fog/10_1_Client_Deploy_New_Task_.png" alt="Fog_Client_Task_Deploy" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-f650122ad20a087ad267e79ea5180268" class="lightbox-link">
<img src="../at3/at3e1/fog/10_2_Client_Deploy_Task_Options.png" alt="Fog_Client_Tasks_Deploy_Options" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-f650122ad20a087ad267e79ea5180268">
<img src="../at3/at3e1/fog/10_2_Client_Deploy_Task_Options.png" alt="Fog_Client_Tasks_Deploy_Options" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-7ee0830dc9ea3ad7d4d4de36a8e3c236" class="lightbox-link">
<img src="../at3/at3e1/fog/10_3_Client_Deploy_Task_Added.png" alt="Fog_Client_Task_added" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-7ee0830dc9ea3ad7d4d4de36a8e3c236">
<img src="../at3/at3e1/fog/10_3_Client_Deploy_Task_Added.png" alt="Fog_Client_Task_added" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-33b3c1689865f7824b4a962d7e507231" class="lightbox-link">
<img src="../at3/at3e1/fog/10_4_Client_Active_Tasks.png" alt="fog_Client_Deploy_Active_Tasks" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-33b3c1689865f7824b4a962d7e507231">
<img src="../at3/at3e1/fog/10_4_Client_Active_Tasks.png" alt="fog_Client_Deploy_Active_Tasks" class="lightbox-image" loading="lazy">
</a></p>
<p>On (re)démarre la machine cliente et le déploiement démarre automatiquement :</p>
<p>
<a href="#image-44f61aa87f1a3fd82b1e023510cbfaee" class="lightbox-link">
<img src="../at3/at3e1/fog/10_5_Client_VMW_Deploy_Running.png" alt="VMW_Client_Deploy_Running" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-44f61aa87f1a3fd82b1e023510cbfaee">
<img src="../at3/at3e1/fog/10_5_Client_VMW_Deploy_Running.png" alt="VMW_Client_Deploy_Running" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-4581cf91a20c9c73b2d27770dbf6139a" class="lightbox-link">
<img src="../at3/at3e1/fog/10_6_Client_Deploy_fog_Running.png" alt="Fog_Client_Deploy_Running" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-4581cf91a20c9c73b2d27770dbf6139a">
<img src="../at3/at3e1/fog/10_6_Client_Deploy_fog_Running.png" alt="Fog_Client_Deploy_Running" class="lightbox-image" loading="lazy">
</a></p>
<p>** Pour déployer une machine sans avoir créé de tâche au préalable :**</p>
<p>On (re)démarre la machine à déployer et on choisi <strong>Deploy Image</strong> dans le menu FOG pour démarrer la tâche de déploiement. Le processus demande alors un login/mot de passe qu&rsquo;on renseigne avec <code>fog/pqsszord</code> (pour fog/password, le clavier étant en disposition QWERTY à ce moment là).</p>
<p>
<a href="#image-fa503157df35a40c84342359ea6025be" class="lightbox-link">
<img src="../at3/at3e1/fog/11_1_Client_VMW_Menu_Deploy.png" alt="VMW_Client_Deploy_Menu" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-fa503157df35a40c84342359ea6025be">
<img src="../at3/at3e1/fog/11_1_Client_VMW_Menu_Deploy.png" alt="VMW_Client_Deploy_Menu" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-1d58d165490e4ed9938d3726db9eeeb4" class="lightbox-link">
<img src="../at3/at3e1/fog/11_2_Client_VMW_Deploy_Login.png" alt="VMW_Client_Deploy_login" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1d58d165490e4ed9938d3726db9eeeb4">
<img src="../at3/at3e1/fog/11_2_Client_VMW_Deploy_Login.png" alt="VMW_Client_Deploy_login" class="lightbox-image" loading="lazy">
</a></p>
<p>Une fois l&rsquo;opération terminée, on reboot la machine clonée pour modifier son BIOS afin qu&rsquo;elle boot sur son disque dur. Elle possède la même configuration que la master avec cependant un nom d&rsquo;hôte correspondant au nom qu&rsquo;on a spécifié dans FOG <em>(tout comme le master)</em>.</p>
<p>
<a href="#image-b16e49097d41a02a9105b1dd38b39240" class="lightbox-link">
<img src="../at3/at3e1/fog/12_Master-Client.png.png" alt="Master-Client" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-b16e49097d41a02a9105b1dd38b39240">
<img src="../at3/at3e1/fog/12_Master-Client.png.png" alt="Master-Client" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h2 id="installation-de-lagent-fog-client">Installation de l&rsquo;agent FOG Client</h2>
<p><strong>L&rsquo;agent FOG permet de changer le nom de la machine via l&rsquo;interface web, d&rsquo;y ajouter des logiciels, des scripts et d&rsquo;autres fonctionnalités avancées (AD&hellip;)</strong></p>
<p>Sur le(s) poste(s) client(s), l&rsquo;agent FOG peut :</p>
<ul>
<li>avoir été installé sur le master donc automatiquement déployé</li>
<li>être téléchargé manuellement via <em>SmartInstaller sur</em> <strong><a href="https://github.com/FOGProject/fog-client/releases" target="_blank">https://github.com/FOGProject/fog-client/releases</a></strong> <em>(ou avec git)</em></li>
<li>être téléchargé depuis l&rsquo;interface web de FOG dans un navigateur (éviter Edge) par le bouton en bas à gaughe.</li>
</ul>
<p>Durant l&rsquo;installation <em>(procédure classique)</em> il faut renseigner l&rsquo;adresse IP du serveur FOG :</p>
<p>
<a href="#image-e4e8ac6d5ff055efd40046ddfa68d513" class="lightbox-link">
<img src="../at3/at3e1/fog/13_Install_Agent.png" alt="Install_Agent_Fog" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-e4e8ac6d5ff055efd40046ddfa68d513">
<img src="../at3/at3e1/fog/13_Install_Agent.png" alt="Install_Agent_Fog" class="lightbox-image" loading="lazy">
</a></p>
<p>&hellip; et sélectionner <code>HTTPS</code> si c&rsquo;est le cas.</p>
<p>Une fois l&rsquo;agent installé, un redémarrage est nécessaire, un fichier log.fog est créé à la racine du disque C:</p>
<p>Si le fichier log n’apparaît pas après un redémarrage, on peut lancer le service &ldquo;FOGService&rdquo; à la main.</p>
<hr>
<h2 id="déploiement-de-logiciels">Déploiement de logiciels</h2>
<p><strong>Pour déployer des logiciels post-déploiement, on utilise les <code>snapins</code></strong></p>
<p>On y accède via l&rsquo;icone <strong>snapin</strong> <em>(barre du haut)</em> et on crée un nouveau via le menu de gauche <strong>Create New Snapin</strong>.</p>
<p>Il faut au minimum lui donner un nom, un template, un fichier d&rsquo;installation + les éventuels arguments de ligne de commande pour installation silencieuse (se référer à la doc du logiciel) et valider.</p>
<p>
<a href="#image-318ba3ecd7353f76a91355791b9ac88b" class="lightbox-link">
<img src="../at3/at3e1/fog/14_1_New_Snapin.png" alt="New_Snapin" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-318ba3ecd7353f76a91355791b9ac88b">
<img src="../at3/at3e1/fog/14_1_New_Snapin.png" alt="New_Snapin" class="lightbox-image" loading="lazy">
</a></p>
<p>Ensuite, il faut affecter notre nouveau snapin au(x) poste(s) client(s) en cliquant  <strong>Membership</strong> dans les onglets de la page</p>
<p>
<a href="#image-f6806b34c70942df6765619f2f28f7e2" class="lightbox-link">
<img src="../at3/at3e1/fog/14_2_Snapin_Membership.png" alt="Snapin_Membership" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-f6806b34c70942df6765619f2f28f7e2">
<img src="../at3/at3e1/fog/14_2_Snapin_Membership.png" alt="Snapin_Membership" class="lightbox-image" loading="lazy">
</a></p>
<p>On le retrouve dans la liste <strong>All Snapins</strong></p>
<p>
<a href="#image-325061c8700dff6201a85931d9d4e76b" class="lightbox-link">
<img src="../at3/at3e1/fog/14_3_All_Snapins.png" alt="All_Snapins" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-325061c8700dff6201a85931d9d4e76b">
<img src="../at3/at3e1/fog/14_3_All_Snapins.png" alt="All_Snapins" class="lightbox-image" loading="lazy">
</a></p>
<p>De retour sur le poste client dans la gestion des hôtes, on clique sur &ldquo;Basic Tasks&rdquo; puis sur &ldquo;Advanced&rdquo;</p>
<p>
<a href="#image-b0c78ebf856621b7fbcbef20448a9a6e" class="lightbox-link">
<img src="../at3/at3e1/fog/14_4_Snapin_Host_New_Task.png" alt="Snapin_Host_New_Task" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-b0c78ebf856621b7fbcbef20448a9a6e">
<img src="../at3/at3e1/fog/14_4_Snapin_Host_New_Task.png" alt="Snapin_Host_New_Task" class="lightbox-image" loading="lazy">
</a></p>
<p>Et enfin, dans la liste, sur &ldquo;Single Snapin&rdquo; car nous n&rsquo;avons qu&rsquo;un logiciel à installer.</p>
<p>
<a href="#image-1bc74bc7fdf8f37249dbb12ea4978b11" class="lightbox-link">
<img src="../at3/at3e1/fog/14_5_Snapin_Host_New_Task_Config.png" alt="Snapin_Host_New_Task_Config" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1bc74bc7fdf8f37249dbb12ea4978b11">
<img src="../at3/at3e1/fog/14_5_Snapin_Host_New_Task_Config.png" alt="Snapin_Host_New_Task_Config" class="lightbox-image" loading="lazy">
</a></p>
<p>Sélectionner le package à installer et valider</p>
<p>
<a href="#image-51161974d3c0a0dbe9865475cd64347f" class="lightbox-link">
<img src="../at3/at3e1/fog/14_6_Single_Snapin_Task.png" alt="Single_Snapin_Task" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-51161974d3c0a0dbe9865475cd64347f">
<img src="../at3/at3e1/fog/14_6_Single_Snapin_Task.png" alt="Single_Snapin_Task" class="lightbox-image" loading="lazy">
</a></p>
<p>La tâche apparaît dans les tâches actives</p>
<p>Quand l&rsquo;agent entrera en contact avec le serveur FOG, il recevra l&rsquo;ordre de télécharger le snapin sur le serveur FOG et l&rsquo;installera sur le poste client.</p>
<p>Le fichier log.fog contiendra un rapport d&rsquo;installation</p>
<hr>
<h2 id="déploiement-doffice">Déploiement d&rsquo;Office</h2>
<p>Pour office on crée un dossier partagé Samba publique sur le serveur FOG.</p>
<h3 id="samba"><strong>Samba</strong></h3>
<ul>
<li>Création et configuration du dossier partagé sur le serveur FOG :</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /
</span></span><span class="line"><span class="cl">mkdir share
</span></span><span class="line"><span class="cl"><span class="nb">cd</span> share
</span></span><span class="line"><span class="cl">mkdir partage
</span></span><span class="line"><span class="cl">chmod <span class="m">777</span> partage
</span></span></code></pre></div><ul>
<li>Installation et configuration de Samba :</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install samba
</span></span><span class="line"><span class="cl">nano /etc/samba/smb.conf
</span></span></code></pre></div><p>smb.conf :</p>
<pre tabindex="0"><code>[global]
   workgroup = WORKGROUP
   log file = /var/log/samba/log.%m
   max log size = 1000
   logging = file
   panic action = /usr/share/samba/panic-action %d
   server role = standalone server
   obey pam restrictions = yes
   unix password sync = yes
   passwd program = /usr/bin/passwd %u
   passwd chat = *Enter\snew\s*\spassword:* %n\n *Retype\snew\s*\spassword:* %n\n *password\supdated\ssuccessfully* .
   pam password change = yes
   map to guest = bad user
   usershare allow guests = yes
[partage]
   comment = Partage de fichiers
   path = /share/partage
   guest ok = yes
   read only = no
   browseable = yes
</code></pre><h3 id="odt"><strong>ODT</strong></h3>
<h3 id="sur-la-machine-hôte-qui-fait-tourner-les-vms-télécharger-et-décompresser-odt-dans-un-dossier-où-on-mettra-tous-nos-scripts-et-fichiers-de-configuration-suivants">Sur la machine hôte qui fait tourner les VMs, télécharger et décompresser ODT <strong>dans un dossier où on mettra tous nos scripts et fichiers de configuration suivants</strong>.</h3>
<ul>
<li>On crée un fichier de configuration pour le téléchargement d&rsquo;Office.</li>
</ul>
<p><code>downloadOffice.xml</code> :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Configuration&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Add</span> <span class="na">SourcePath=</span><span class="s">&#34;\\192.168.13.222\partage&#34;</span> 
</span></span><span class="line"><span class="cl">       <span class="na">OfficeClientEdition=</span><span class="s">&#34;64&#34;</span>
</span></span><span class="line"><span class="cl">       <span class="na">Channel=</span><span class="s">&#34;MonthlyEnterprise&#34;</span> <span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Product</span> <span class="na">ID=</span><span class="s">&#34;O365ProPlusRetail&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">	   <span class="nt">&lt;Language</span> <span class="na">ID=</span><span class="s">&#34;fr-fr&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/Product&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Add&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Updates</span> <span class="na">Enabled=</span><span class="s">&#34;TRUE&#34;</span> 
</span></span><span class="line"><span class="cl">           <span class="na">UpdatePath=</span><span class="s">&#34;\\192.168.13.222\partage&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">   <span class="nt">&lt;Display</span> <span class="na">Level=</span><span class="s">&#34;None&#34;</span> <span class="na">AcceptEULA=</span><span class="s">&#34;TRUE&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Configuration&gt;</span>
</span></span></code></pre></div><ul>
<li>Un fichier pour la configuration de l&rsquo;installation.</li>
</ul>
<p><code>installOffice.xml</code> :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-xml" data-lang="xml"><span class="line"><span class="cl"><span class="nt">&lt;Configuration</span> <span class="na">ID=</span><span class="s">&#34;d3297aa9-1a8d-4c14-af9b-9e243abb0f12&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Add</span> <span class="na">OfficeClientEdition=</span><span class="s">&#34;64&#34;</span> <span class="na">Channel=</span><span class="s">&#34;MonthlyEnterprise&#34;</span> <span class="na">SourcePath=</span><span class="s">&#34;\\192.168.13.222\partage&#34;</span> <span class="na">AllowCdnFallback=</span><span class="s">&#34;TRUE&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;Product</span> <span class="na">ID=</span><span class="s">&#34;O365ProPlusRetail&#34;</span><span class="nt">&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;Language</span> <span class="na">ID=</span><span class="s">&#34;fr-fr&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">      <span class="nt">&lt;ExcludeApp</span> <span class="na">ID=</span><span class="s">&#34;Bing&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;/Product&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/Add&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Property</span> <span class="na">Name=</span><span class="s">&#34;SharedComputerLicensing&#34;</span> <span class="na">Value=</span><span class="s">&#34;0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Property</span> <span class="na">Name=</span><span class="s">&#34;FORCEAPPSHUTDOWN&#34;</span> <span class="na">Value=</span><span class="s">&#34;TRUE&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Property</span> <span class="na">Name=</span><span class="s">&#34;DeviceBasedLicensing&#34;</span> <span class="na">Value=</span><span class="s">&#34;0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Property</span> <span class="na">Name=</span><span class="s">&#34;SCLCacheOverride&#34;</span> <span class="na">Value=</span><span class="s">&#34;0&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Updates</span> <span class="na">Enabled=</span><span class="s">&#34;TRUE&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;AppSettings&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;User</span> <span class="na">Key=</span><span class="s">&#34;software\microsoft\office\16.0\excel\options&#34;</span> <span class="na">Name=</span><span class="s">&#34;defaultformat&#34;</span> <span class="na">Value=</span><span class="s">&#34;60&#34;</span> <span class="na">Type=</span><span class="s">&#34;REG_DWORD&#34;</span> <span class="na">App=</span><span class="s">&#34;excel16&#34;</span> <span class="na">Id=</span><span class="s">&#34;L_SaveExcelfilesas&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;User</span> <span class="na">Key=</span><span class="s">&#34;software\microsoft\office\16.0\powerpoint\options&#34;</span> <span class="na">Name=</span><span class="s">&#34;defaultformat&#34;</span> <span class="na">Value=</span><span class="s">&#34;52&#34;</span> <span class="na">Type=</span><span class="s">&#34;REG_DWORD&#34;</span> <span class="na">App=</span><span class="s">&#34;ppt16&#34;</span> <span class="na">Id=</span><span class="s">&#34;L_SavePowerPointfilesas&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">    <span class="nt">&lt;User</span> <span class="na">Key=</span><span class="s">&#34;software\microsoft\office\16.0\word\options&#34;</span> <span class="na">Name=</span><span class="s">&#34;defaultformat&#34;</span> <span class="na">Value=</span><span class="s">&#34;ODT&#34;</span> <span class="na">Type=</span><span class="s">&#34;REG_SZ&#34;</span> <span class="na">App=</span><span class="s">&#34;word16&#34;</span> <span class="na">Id=</span><span class="s">&#34;L_SaveWordfilesas&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;/AppSettings&gt;</span>
</span></span><span class="line"><span class="cl">  <span class="nt">&lt;Display</span> <span class="na">Level=</span><span class="s">&#34;Full&#34;</span> <span class="na">AcceptEULA=</span><span class="s">&#34;TRUE&#34;</span> <span class="nt">/&gt;</span>
</span></span><span class="line"><span class="cl"><span class="nt">&lt;/Configuration&gt;</span>
</span></span></code></pre></div>
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Remarque</div>
  <div class="box-content">
<p>Un générateur pour ce fichier <a href="https://config.office.com/deploymentsettings" target="_blank">https://config.office.com/deploymentsettings</a></p>
  </div>
</div>
<p>
<a href="#image-edacafe5a176d56b400a32611fcd77a7" class="lightbox-link">
<img src="../at3/at3e1/fog/15_0_outil_ms.png" alt="outils_en_ligne" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-edacafe5a176d56b400a32611fcd77a7">
<img src="../at3/at3e1/fog/15_0_outil_ms.png" alt="outils_en_ligne" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Un script batch pour lancer le téléchargement puis la copie des 2 fichiers dont on aura besoin dans le dossier partagé.</li>
</ul>
<p><code>odt.bat</code> :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-batch" data-lang="batch"><span class="line"><span class="cl"><span class="p">@</span><span class="k">echo</span> off
</span></span><span class="line"><span class="cl">setup /download downloadOffice.xml
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Telechargement des fichiers d&#39;installation d&#39;office termine !&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">pause</span>
</span></span><span class="line"><span class="cl"><span class="k">copy</span> setup.exe  \\192.168.13.222\partage\setup.exe
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Fichier setup.exe copie sur le serveur FOG&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">copy</span> InstallOffice.xml  \\192.168.13.222\partage\InstallOffice.xml
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Fichier de configuration installOffice.xml copie sur le serveur FOG&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">echo</span> <span class="s2">&#34;Scipt termine !&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">pause</span>
</span></span></code></pre></div><ul>
<li>Et enfin un fichier <code>.cmd</code> d&rsquo;une seule ligne qu&rsquo;on passera en snapin.</li>
</ul>
<p><code>snapinSetupOffice.cmd</code> :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">\\192.168.13.222\partage\setup.exe /configure \\192.168.13.222\partage\InstallOffice.xml
</span></span></code></pre></div><p>On doit obtenir ceci :</p>
<p>
<a href="#image-083d0f7121ba9fc9e8bdd8862da533af" class="lightbox-link">
<img src="../at3/at3e1/fog/15_1_Dossier_ODT.png" alt="Dossier_ODT" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-083d0f7121ba9fc9e8bdd8862da533af">
<img src="../at3/at3e1/fog/15_1_Dossier_ODT.png" alt="Dossier_ODT" class="lightbox-image" loading="lazy">
</a></p>
<p>On exécute ensuite le fichier <code>odt.bat</code> et on attend que le téléchargement d&rsquo;Office soit terminé (<em>Appuyer sur une touche pour continer&hellip;</em> apparaît dans le terminal).</p>
<p>On vérifie qu&rsquo;on a bien peuplé notre dossier partagé sur le serveur FOG à l&rsquo;adresse du partage <strong><code>\\192.168.13.222\partage</code></strong> :</p>
<p>
<a href="#image-23bea72aca714dda9a0833a00b279388" class="lightbox-link">
<img src="../at3/at3e1/fog/15_2_Dossier_partage.png" alt="Dossier_partage" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-23bea72aca714dda9a0833a00b279388">
<img src="../at3/at3e1/fog/15_2_Dossier_partage.png" alt="Dossier_partage" class="lightbox-image" loading="lazy">
</a></p>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p><strong>Il faut faire passer le dossier <code>Office</code> dans le dossier partagé du serveur FOG en <em>public</em> avec :</strong></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">chmod -R <span class="m">777</span> /var/share
</span></span></code></pre></div>  </div>
</div>
<blockquote>
<p>On peut temporairement désactiver l&rsquo;UAC sur le poste client pour éviter les messages de sécurité <em>(via le panneau de configuration &gt; Sécurité et maintenance &gt; Modifier les paramètres du centre de sécurité et maintenance &gt; et décocher la case Contrôle de compte d&rsquo;utilisateur)</em>.</p>
</blockquote>
<p>On va ensuite créer notre snapin contenant le script <code>snapinSetupOffice.cmd</code> comme ceci :</p>
<p>
<a href="#image-80f7a2b719134c2d9a6202b6319cfab6" class="lightbox-link">
<img src="../at3/at3e1/fog/15_3_add_office_snapin.png" alt="add_office_snapin" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-80f7a2b719134c2d9a6202b6319cfab6">
<img src="../at3/at3e1/fog/15_3_add_office_snapin.png" alt="add_office_snapin" class="lightbox-image" loading="lazy">
</a></p>
<p>Puis l&rsquo;affecter à notre hôte cible comme un snapin simple.</p>
<p>
<a href="#image-23408aca59596a3f091e0a6f0ee2637b" class="lightbox-link">
<img src="../at3/at3e1/fog/15_4_Affect_Office_Snapin.png" alt="Affect_Office_Snapin" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-23408aca59596a3f091e0a6f0ee2637b">
<img src="../at3/at3e1/fog/15_4_Affect_Office_Snapin.png" alt="Affect_Office_Snapin" class="lightbox-image" loading="lazy">
</a></p>
<p>Et elle doit figurer dans la liste des tâches active.</p>
<p>Avec la configuration choisie, une barre de progression doit apparaître sur le poste client durant l&rsquo;installation d&rsquo;Office <em>(n&rsquo;a pas fonctionné lors de ce test)</em>.</p>
<p>
<a href="#image-7fd06f863d429949244500c4c7c8d70d" class="lightbox-link">
<img src="../at3/at3e1/fog/15_5_Office_installed.png" alt="Office_Installed" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-7fd06f863d429949244500c4c7c8d70d">
<img src="../at3/at3e1/fog/15_5_Office_installed.png" alt="Office_Installed" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h2 id="changement-de-nom-de-poste">Changement de nom de poste</h2>
<p>Il est possible de changer le nom d&rsquo;un poste client directement depuis l&rsquo;interface web du serveur FOG.</p>
<p>Il n&rsquo;est pas nécessaire d&rsquo;avoir l&rsquo;agent d&rsquo;installé sur le client.</p>
<p>Dans l&rsquo;interface web de FOG cliquez sur <strong>Services Configuration</strong></p>
<p>Puis <strong>Hostname Changer</strong> pour vérifier l&rsquo;état du service</p>
<p>La case doit être cochée</p>
<p>
<a href="#image-a52162a7944aa04c0b5acc5fee357673" class="lightbox-link">
<img src="../at3/at3e1/fog/16_1_Hostname_Changer.png" alt="Hostname_Changer" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-a52162a7944aa04c0b5acc5fee357673">
<img src="../at3/at3e1/fog/16_1_Hostname_Changer.png" alt="Hostname_Changer" class="lightbox-image" loading="lazy">
</a></p>
<p>Ensuite on peut changer le nom de l&rsquo;hôte dans la page de l&rsquo;hôte à Host name.</p>
<p>
<a href="#image-234db4363f3952633d786fb20a55f2f0" class="lightbox-link">
<img src="../at3/at3e1/fog/16_2_Host_Name_Change.png" alt="Host_Name_Change" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-234db4363f3952633d786fb20a55f2f0">
<img src="../at3/at3e1/fog/16_2_Host_Name_Change.png" alt="Host_Name_Change" class="lightbox-image" loading="lazy">
</a></p>
<p>Le poste redémarrera automatiquement lors du prochain contact de l&rsquo;agent pour prendre le nom spécifié dans FOG</p>

<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p>Pour que le poste client puisse redémarrer alors que l&rsquo;utilisateur est logué, il faut cocher l&rsquo;option <strong>ENFORCE HOST CHANGES</strong> dans <strong>FOG Configuration</strong> <em>(barre du haut)</em> &gt; <strong>FOG Settings</strong> <em>(menu de gauche)</em> &gt; section <strong>Active Directory Defaults</strong>, sinon le renommage se fera au prochain démarrage du poste.</p>
  </div>
</div>
<p>
<a href="#image-ac0065259dc3ca0f0e7109c4580f9fc1" class="lightbox-link">
<img src="../at3/at3e1/fog/16_3_AD_Defaults.png" alt="AD_Defaults" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-ac0065259dc3ca0f0e7109c4580f9fc1">
<img src="../at3/at3e1/fog/16_3_AD_Defaults.png" alt="AD_Defaults" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h2 id="déploiement-de-scripts">Déploiement de scripts</h2>
<p>Pour le déploiement d&rsquo;un script, c&rsquo;est la même chose que pour un logiciel.</p>
<p>Il suffira de sélectionner le type de script et de l&rsquo;uploader.</p>
<p>Exemple création d&rsquo;un dossier toto à la racine de C:
créer un batch &ldquo;script.cmd&rdquo; qui contient :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-batch" data-lang="batch"><span class="line"><span class="cl"><span class="p">@</span><span class="k">echo</span> off
</span></span><span class="line"><span class="cl"><span class="k">mkdir</span> c:\TestScript
</span></span><span class="line"><span class="cl">ping 192.168.13.254 <span class="p">&gt;</span> c:\TestScript\ping_gw.txt
</span></span></code></pre></div><p>
<a href="#image-60fe68b2f34554c22ca91265d9213c36" class="lightbox-link">
<img src="../at3/at3e1/fog/17_Script_Snapin.png" alt="Script_Snapin" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-60fe68b2f34554c22ca91265d9213c36">
<img src="../at3/at3e1/fog/17_Script_Snapin.png" alt="Script_Snapin" class="lightbox-image" loading="lazy">
</a></p>
<p>Ensuite il suffira d&rsquo;affecter le snapin au poste client voulu et de planifier la tâche au niveau de l&rsquo;hôte.</p>
<hr>
<h2 id="les-plugins">Les plugins</h2>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p><em>Ce chapitre - texte et images - est entièrement extrait du support de  cours de Bertand Girault - CEFIM Tours</em></p>
  </div>
</div>
<p>Fog project intègre un système de plugin afin de proposer des fonctionnalités supplémentaires (en développement)</p>
<p>Cliquez sur l&rsquo;icone&rsquo; de configuration</p>
<p>
<a href="#image-36de7f170e8d2070da5c216446654ce0" class="lightbox-link">
<img src="../at3/at3e1/fog/18_1.jpg" alt="18_1" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-36de7f170e8d2070da5c216446654ce0">
<img src="../at3/at3e1/fog/18_1.jpg" alt="18_1" class="lightbox-image" loading="lazy">
</a></p>
<p>Puis sur &ldquo;plugin system&rdquo; en bas de la liste</p>
<p>
<a href="#image-c0196e84c962d10e5b0009afa80bb580" class="lightbox-link">
<img src="../at3/at3e1/fog/18_2.jpg" alt="18_2" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-c0196e84c962d10e5b0009afa80bb580">
<img src="../at3/at3e1/fog/18_2.jpg" alt="18_2" class="lightbox-image" loading="lazy">
</a></p>
<p>Et enfin il faut activer le PlugIn System</p>
<p>
<a href="#image-5688b18e3aaf3d12233058a68dd59337" class="lightbox-link">
<img src="../at3/at3e1/fog/18_3.jpg" alt="18_3" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-5688b18e3aaf3d12233058a68dd59337">
<img src="../at3/at3e1/fog/18_3.jpg" alt="18_3" class="lightbox-image" loading="lazy">
</a></p>
<p>Un nouveau menu apparaît maintenant, cliquez dessus pour voir la liste des plugins.</p>
<p>
<a href="#image-3eb32ddc402b9f91d18d1d49b5ad0c08" class="lightbox-link">
<img src="../at3/at3e1/fog/18_4.jpg" alt="18_4" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-3eb32ddc402b9f91d18d1d49b5ad0c08">
<img src="../at3/at3e1/fog/18_4.jpg" alt="18_4" class="lightbox-image" loading="lazy">
</a></p>
<p>Il faut commencer par activer le plugin en cliquant dessus.</p>
<p>
<a href="#image-1a146fb9817bcf56588eb77a5c2cb6aa" class="lightbox-link">
<img src="../at3/at3e1/fog/18_5.jpg" alt="18_5" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1a146fb9817bcf56588eb77a5c2cb6aa">
<img src="../at3/at3e1/fog/18_5.jpg" alt="18_5" class="lightbox-image" loading="lazy">
</a></p>
<p>cliquez sur le plugin choisi, ici c&rsquo;est Pushbullet un service qui permet de recevoir des notifications des tâches faites sous FOG</p>
<p>Cliquez sur le menu &ldquo;install plugins&rdquo; et enfin sur l&rsquo;icone de &ldquo;Pushbullet&rdquo;</p>
<p>
<a href="#image-5ec97d9b304f4f493e11f39e1ee00ee8" class="lightbox-link">
<img src="../at3/at3e1/fog/18_6.jpg" alt="18_6" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-5ec97d9b304f4f493e11f39e1ee00ee8">
<img src="../at3/at3e1/fog/18_6.jpg" alt="18_6" class="lightbox-image" loading="lazy">
</a></p>
<p>Puis sur le menu &ldquo;installer Plugins&rdquo;</p>
<p>
<a href="#image-4f0bd163cce1f7e9ba33c278af75a00d" class="lightbox-link">
<img src="../at3/at3e1/fog/18_7.jpg" alt="18_7" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-4f0bd163cce1f7e9ba33c278af75a00d">
<img src="../at3/at3e1/fog/18_7.jpg" alt="18_7" class="lightbox-image" loading="lazy">
</a></p>
<p>Le plugin est installé et apparaît dans le menu</p>
<p>
<a href="#image-9595e8183d6e8b1952fe7aaec7cf61eb" class="lightbox-link">
<img src="../at3/at3e1/fog/18_8.jpg" alt="18_8" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-9595e8183d6e8b1952fe7aaec7cf61eb">
<img src="../at3/at3e1/fog/18_8.jpg" alt="18_8" class="lightbox-image" loading="lazy">
</a></p>
<p>Il faut avoir un compte Pushbullet :</p>
<p><a href="https://www.pushbullet.com/" target="_blank">https://www.pushbullet.com/</a></p>
<p>Sur votre compte pushbullet, vous devez créer un &ldquo;access token&rdquo; qui sera copié dans FOG et sur une application installée sur votre smartphone/tablette.</p>
<hr>
<h2 id="créer-un-autre-noeud-de-stockage">Créer un autre noeud de stockage</h2>
<p>Installer FOG sur une autre VM debian en choisissant <strong>[S] Stockage</strong> à la 2ème question de l&rsquo;installeur.
Outre le serveur FOG principal il faudra spécifier les nom et mdp de l&rsquo;utilisateur MySQL qui est renseigné dans l&rsquo;interface web du serveur sous l&rsquo;icone <strong><code>FOG configuration</code></strong> <em>(barre du haut)</em> &gt; <strong><code>FOG Settings</code></strong> <em>(menu de gauche)</em> &gt; section <strong><code>FOG Storage Nodes</code></strong></p>
<p>
<a href="#image-38c2dd2d7117db2336a26d878f5347c5" class="lightbox-link">
<img src="../at3/at3e1/fog/19_Database_user_Infos.png" alt="Database_User_Infos" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-38c2dd2d7117db2336a26d878f5347c5">
<img src="../at3/at3e1/fog/19_Database_user_Infos.png" alt="Database_User_Infos" class="lightbox-image" loading="lazy">
</a></p>

<div class="box notices cstyle tip">
  <div class="box-label"><i class="fa-fw fas fa-lightbulb"></i> Astuce</div>
  <div class="box-content">
<p><em>Plus sur <a href="https://chrtophe.developpez.com/tutoriels/deploiement-fogproject/#L9" target="_blank"><strong>cette page</strong></a></em></p>
  </div>
</div>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="chapter">
<div class="article-subheading">Exemple 3</div>
<h1 id="stage-armatis">Stage Armatis</h1>

<hr>
<h2 id="déploiement-armatis"><strong>Déploiement Armatis</strong></h2>
<p>Le déploiement des postes s&rsquo;effectue en 2 étapes :</p>
<ol>
<li>déploiement de l&rsquo;image souche (l&rsquo;hôte) <em>- environ 30 min</em></li>
<li>déploiement de la VM (VMWare) selon l&rsquo;activité à laquelle sera affectée la machine <em>- environ 2 h</em></li>
</ol>
<p>Les machines sont déployées une à une.</p>
<h3 id="déploiement-image-souche"><strong>Déploiement image souche</strong></h3>
<p>Sur chaque machine, le déploiement de l&rsquo;image souche s&rsquo;effectue par boot PXE, puis sélection dans Clonezilla de l&rsquo;image à déployer. Plusieurs scripts de configuration sont ensuite appelés automatiquement.</p>
<ul>
<li><strong>[F10]</strong> au démarrage de la machine pour accès au BIOS
<ul>
<li>Boot Options
<ul>
<li>Mettre un délai de 5 secondes</li>
<li><code>Activer le démarrage sur PXE</code></li>
<li>Désactiver l&rsquo;alerte audio</li>
</ul>
</li>
<li>Sécurité
<ul>
<li><code>Désactiver le Secure Boot (disable-disable)</code></li>
</ul>
</li>
<li><strong>[F10]</strong> pour sauvegarder les modifications et quitter le BIOS
-&gt; La machine reboot</li>
</ul>
</li>
<li><strong>[F9]]</strong> pour le menu de boot
<ul>
<li><code>Démarrer sur PXE IPV4</code></li>
</ul>
</li>
<li>Dans le menu de CloneZilla qui s&rsquo;affiche, choisir <code>TAUX - Direct Restore HP Universal</code>
<ul>
<li>Sur certaine machine (les plus récentes) une demande de confirmation apparaît après environ 1 minute =&gt; [Entrée]</li>
</ul>
</li>
</ul>
<p><em>Cette étape dure environ 1/2 heure.</em></p>
<p>L&rsquo;opération terminée, la machine doit rebooter sur un compte en auto-login ; sinon (administrateur) redémarrer la machine jusqu&rsquo;à l&rsquo;obtenir.</p>
<p>Suivant les machines il y a de petites différence (version BIOS&hellip;) :</p>
<ul>
<li>
<p>400/600-G2 : C&rsquo;est la démarche de base</p>
</li>
<li>
<p>400-G3 : Un code pin est demandé pour désactiver le Secure Boot</p>
</li>
<li>
<p>400-G6 : Secure Boot déjà désactivé, normalement</p>
</li>
<li>
<p>400-G9 :</p>
<ul>
<li>Vérifier Secure Boot + Boot Options + MdP BIOS (à définir si machine neuve)</li>
<li>Il peut être nécessaire de redémarrer la machine plusieurs fois pour obtenir une session avec le compte en auto-login</li>
</ul>
</li>
</ul>
<hr>
<h3 id="déploiement-image-vm"><strong>Déploiement image VM</strong></h3>
<ul>
<li>Une fois la machine démarrée sur le compte en auto-login :
<ul>
<li>Lancer Post-EDF-NG -&gt; Continue + Finish</li>
<li>Fermer VM</li>
</ul>
</li>
<li>Déco + reco en administrateur
<ul>
<li>Post-EDF-NG -&gt; Continue + Finish (éventuellement : Take Ownership)</li>
<li>Fermer VM</li>
<li>Menu Démarrer :
<ul>
<li>TAU-INST-NG-PRO-V2 (pour un poste EDF-PRO)</li>
<li>TAU-INST-NG-PART-V2 (pour un poste EDF-PART)</li>
</ul>
</li>
<li>-&gt; Si hostname en <code>DESKTOP[...]</code> : le PC reboot, il faut alors se re-co en administrateur et relancer le script TAU&hellip;</li>
<li>-&gt; Si clic-auto manqué : le faire manuellement = Clic + [Entrée]</li>
</ul>
</li>
</ul>
<p><em>Cette étape dure approximativement 2h30.</em></p>
<h3 id="configuration-dune-machine-pour-le-tad-travail-a-distance-structurel"><strong>Configuration d&rsquo;une machine pour le TAD (Travail A Distance) structurel</strong></h3>
<p>Une fois le déploiement de la VM terminé ou sur une machine déjà en production sur site :</p>
<ol>
<li>Fermer la VM</li>
<li>Se déconnecter du compte utilisateur actif (en auto-login)</li>
<li>Se connecter en administrateur</li>
<li>Menu démarrer &gt; TAU-INST-TAD</li>
</ol>
<p><em>L&rsquo;opération dure environ une minute.</em></p>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="chapter">
<div class="article-subheading">Chapitre 2</div>
<h1 id="automatiser-les-tâches-à-laide-de-scripts">Automatiser les tâches à l&#39;aide de scripts</h1>

<hr>
<h4 id="1-batchat3at3e2batch">1. <a href="../at3/at3e2/batch/">Batch</a></h4>
<h4 id="2-bashat3at3e2bash">2. <a href="../at3/at3e2/bash/">Bash</a></h4>
<h4 id="3-powershellat3at3e2powershell">3. <a href="../at3/at3e2/powershell/">PowerShell</a></h4>
<h4 id="4-stage-cefimat3at3e2stage-cefim">4. <a href="../at3/at3e2/stage-cefim/">Stage Cefim</a></h4>
<h4 id="5-pythonat3at3e2python">5. <a href="../at3/at3e2/python/">Python</a></h4>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Sous-sections de Automatiser les tâches à l&#39;aide de scripts</h1>
          <article class="chapter">
<div class="article-subheading">Exemple 1</div>
<h1 id="batch">Batch</h1>

<hr>
<h2 id="scripts-batch"><strong>Scripts batch</strong></h2>

<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Remarque</div>
  <div class="box-content">
<p>Le caractère <code>ESC</code> dans le code s&rsquo;obtient avec <code>ALT+027</code>.</p>
<p><em>Il correpond au caractère d&rsquo;échappement ASCII.</em></p>
  </div>
</div>
<hr>
<h3 id="1-simple-ping">1. Simple ping</h3>
<p>Simple script batch pour un outil de ping qui m&rsquo;a permis d&rsquo;expérimenter le rendu de couleur.</p>
<p>
<a href="#image-10798e371789e0561f48e90d02d5230a" class="lightbox-link">
<img src="../at3/at3e2/batch/myping_bat.png" alt="myping.bat" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-10798e371789e0561f48e90d02d5230a">
<img src="../at3/at3e2/batch/myping_bat.png" alt="myping.bat" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h3 id="2-connexion-ssh">2. Connexion ssh</h3>
<p>Un script offrant un menu permettant de choisir parmi différentes connexions ssh récurentes via cmd ou putty.</p>
<p>
<a href="#image-047b85f474709d8d77468f7d799232bd" class="lightbox-link">
<img src="../at3/at3e2/batch/cssh_bat.png" alt="cssh.bat" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-047b85f474709d8d77468f7d799232bd">
<img src="../at3/at3e2/batch/cssh_bat.png" alt="cssh.bat" class="lightbox-image" loading="lazy">
</a></p>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="chapter">
<div class="article-subheading">Exemple 2</div>
<h1 id="bash">Bash</h1>

<hr>
<h2 id="scripts-bash"><strong>Scripts bash</strong></h2>
<hr>
<h3 id="1-script-de-sauvegarde-des-fichiers-et-de-la-base-de-donnees-du-site-wiki">1. Script de sauvegarde des fichiers et de la base de données du site wiki</h3>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p><strong>Contexte :</strong> 1 VM debian 11 LAMPS avec mediawiki.</p>
<p><em>L&rsquo;objectif est de créer une tâche automatiquement éxecutée quotidiennement qui compresse en zip un dump de la BDD ainsi que le contenu du dossier wiki et le sauvegarde dans un dossier à la date du jour.</em></p>
  </div>
</div>
<ul>
<li>on se log en <code>root</code> on édite le script dans <code>/root</code></li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">su -
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="nb">cd</span>
</span></span><span class="line"><span class="cl">nano backup.sh
</span></span></code></pre></div><ul>
<li>avec :</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1">#Scipt de backup auto de la BDD et du wiki pour le site user</span>
</span></span><span class="line"><span class="cl"><span class="c1">#V1.0 par UserName le Date</span>
</span></span><span class="line"><span class="cl">clear
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> Compression des fichiers...
</span></span><span class="line"><span class="cl">7zip -rq /home/user/<span class="k">$(</span>date +%Y%m%d%H%M%S<span class="k">)</span>_wiki_backup-fichiers.zip /home/user/wiki
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> Dump de la base de données...
</span></span><span class="line"><span class="cl">mysqldump -u root -p <span class="s1">&#39;toor&#39;</span> --databases user &gt; /home/user/_wiki_backup-base.sql
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> Compression de la base de données...
</span></span><span class="line"><span class="cl"><span class="c1"># zip -m supprime l&#39;original / -q quiet</span>
</span></span><span class="line"><span class="cl">zip -qm /home/user/<span class="k">$(</span>date +%Y%m%d%H%M%S<span class="k">)</span>_wiki_backup-base.zip /home/user/_wiki_backup-base.sql
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> Terminé !
</span></span></code></pre></div>
<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p>La chaine <code>'toor'</code> est le mot de passe de root sur MySQL. <em><strong>Choisir un MDP fort pour un usage en production</strong></em></p>
  </div>
</div>
<ul>
<li>on l&rsquo;enregistre <code>[CTRL+S]</code> et on quitte nano <code>[CTRL+X]</code></li>
<li>on lui donne les droits d&rsquo;exécution</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">chmod +x backup.sh
</span></span></code></pre></div><h4 id="pour-tester-le-script">Pour tester le script</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /root
</span></span><span class="line"><span class="cl">./backup.sh
</span></span></code></pre></div><p>ou plus simplement</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">/root/backup.sh
</span></span></code></pre></div><h4 id="pour-automatiser-ce-script">Pour automatiser ce script</h4>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">crontab -e
</span></span></code></pre></div><ul>
<li>
<p>choisir [1] pour ouverture avec nano</p>
</li>
<li>
<p>rajouter la ligne (cf <a href="http://crontab.guru" target="_blank">http://crontab.guru</a>)</p>
</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">*/5 * * * * /root/backup.sh
</span></span></code></pre></div><p>-&gt; cette directive exécute le script toutes les 5 minutes (pour tests)</p>
<p>ou</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="m">0</span> <span class="m">0</span> * * * /root/backup.sh
</span></span></code></pre></div><p>-&gt; exécute le script tous les jours à 00h00</p>
<ul>
<li><strong>sortir du compte root avec <code>[CTRL+D]</code> ou <code>exit</code></strong></li>
</ul>
<hr>
<h3 id="2-script-de-décompression-suivant-le-format-dans-bash_aliases">2. Script de décompression suivant le format dans ~/.bash_aliases</h3>
<p>Sur une machine à mon domicile installée sous Linux Bodhi, une distribution légère basée sur Ubuntu 20.04 et disposant de Moksha Desktop, j&rsquo;ai mis en place ce fichier <code>.bash_aliases</code> pour mon compte utilisateur courant (<em>sudo configuré</em>). Il contient, outre des alias pour diverses commande que j&rsquo;utilise plus ou moins fréquemment, une fonction en bash qui extrait un fichier passé en argument.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">  GNU nano 4.8                                               .bash_aliases
</span></span><span class="line"><span class="cl"><span class="c1"># Personnal aliases</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">maj</span><span class="o">=</span><span class="s2">&#34;sudo apt-get update &amp;&amp; sudo apt-get upgrade -y&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">tt</span><span class="o">=</span><span class="s2">&#34;sudo watch sensors&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">flic</span><span class="o">=</span><span class="s2">&#34;sudo nmap -v -Pn -A&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">pg</span><span class="o">=</span><span class="s2">&#34;ping google.fr&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">p1</span><span class="o">=</span><span class="s2">&#34;ping 1.1.1.1&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">logm</span><span class="o">=</span><span class="s2">&#34;sudo tail -f /var/log/messages | ccze -A&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">logs</span><span class="o">=</span><span class="s2">&#34;sudo tail -f /var/log/syslog | ccze -A&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">logi</span><span class="o">=</span><span class="s2">&#34;sudo tail -f /var/log/iptables.log | ccze -A&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">logii</span><span class="o">=</span><span class="s2">&#34;sudo tail -f /var/log/iptables-input.log | ccze -A&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">logio</span><span class="o">=</span><span class="s2">&#34;sudo tail -f /var/log/iptables-output.log | ccze -A&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">logif</span><span class="o">=</span><span class="s2">&#34;sudo tail -f /var/log/iptables-forward.log | ccze -A&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">iptln</span><span class="o">=</span><span class="s2">&#34;sudo iptables -L --line-numbers&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">beton</span><span class="o">=</span><span class="s2">&#34;mplayer https://stream.radiobeton.com:8001/stream.mp3&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">lynis</span><span class="o">=</span><span class="s2">&#34;/usr/local/lynis/lynis audit system&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">srcali</span><span class="o">=</span><span class="s2">&#34;source ~/.bash_aliases&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">srcrc</span><span class="o">=</span><span class="s2">&#34;source ~/.bashrc&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">rcwgui</span><span class="o">=</span><span class="s2">&#34;rclone rcd --rc-web-gui&#34;</span>
</span></span><span class="line"><span class="cl"><span class="nb">alias</span> <span class="nv">bd</span><span class="o">=</span><span class="s2">&#34;cd ..&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Fonction to extract file passed as arg</span>
</span></span><span class="line"><span class="cl">xtrct <span class="o">()</span>
</span></span><span class="line"><span class="cl"><span class="o">{</span>
</span></span><span class="line"><span class="cl">  <span class="k">if</span> <span class="o">[</span> -f <span class="nv">$1</span> <span class="o">]</span> <span class="p">;</span> <span class="k">then</span>
</span></span><span class="line"><span class="cl">    <span class="k">case</span> <span class="nv">$1</span> in
</span></span><span class="line"><span class="cl">      *.tar.bz2<span class="o">)</span>   tar xjf <span class="nv">$1</span>   <span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *.tar.gz<span class="o">)</span>    tar xzf <span class="nv">$1</span>   <span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *.bz2<span class="o">)</span>       bunzip2 <span class="nv">$1</span>   <span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *.rar<span class="o">)</span>       unrar x <span class="nv">$1</span>   <span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *.gz<span class="o">)</span>        gunzip <span class="nv">$1</span>    <span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *.tar<span class="o">)</span>       tar xf <span class="nv">$1</span>    <span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *.tar.xz<span class="o">)</span>    tar xf <span class="nv">$1</span>    <span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *.tbz2<span class="o">)</span>      tar xjf <span class="nv">$1</span>   <span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *.tgz<span class="o">)</span>       tar xzf <span class="nv">$1</span>   <span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *.zip<span class="o">)</span>       unzip <span class="nv">$1</span>     <span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *.Z<span class="o">)</span>         uncompress <span class="nv">$1</span><span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *.7z<span class="o">)</span>        7z x <span class="nv">$1</span>      <span class="p">;;</span>
</span></span><span class="line"><span class="cl">      *<span class="o">)</span>           <span class="nb">echo</span> <span class="s2">&#34;&#39;</span><span class="nv">$1</span><span class="s2">&#39; ne peut etre extrait par xtrct()&#34;</span> <span class="p">;;</span>
</span></span><span class="line"><span class="cl">    <span class="k">esac</span>
</span></span><span class="line"><span class="cl">  <span class="k">else</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;&#39;</span><span class="nv">$1</span><span class="s2">&#39; : format de fichier invalide&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nb">echo</span> <span class="s2">&#34;Usage : xtrct [fichier]&#34;</span>
</span></span><span class="line"><span class="cl">  <span class="k">fi</span>
</span></span><span class="line"><span class="cl"><span class="o">}</span>
</span></span></code></pre></div><hr>
<h3 id="3-automatisation-du-renouvellement-dun-certificat-lets-encrypt-tous-les-3-mois">3. Automatisation du renouvellement d&rsquo;un certificat Let&rsquo;s Encrypt tous les 3 mois</h3>
<p><em><code>certbot</code> doit être installé sur la machine et un certificat doit être configuré sur son nom de domain.</em></p>
<p>L&rsquo;opération s&rsquo;effectue uniquement via crontab</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">crontab -e
</span></span></code></pre></div><p>on ajoute :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="m">0</span> <span class="m">0</span> <span class="m">1</span> */3 * certbot renew --apache --domain oduhamel.oliduha.fr -n
</span></span></code></pre></div><p><em>La commande sera éxectutée tous les 3 mois, le 1er jour du mois</em></p>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="chapter">
<div class="article-subheading">Exemple 3</div>
<h1 id="powershell">PowerShell</h1>

<hr>
<h2 id="scripts-powershell"><strong>Scripts PowerShell</strong></h2>
<hr>
<h3 id="1-script-powershell-dimport-dutilisateurs-dans-un-ad-à-partir-dun-csv">1. Script PowerShell d’import d’utilisateurs dans un AD à partir d’un .csv</h3>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c"># xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
</span></span><span class="line"><span class="cl"><span class="c"># Script d&#39;import d&#39;utisateur dans un AD depuis un .csv</span>
</span></span><span class="line"><span class="cl"><span class="c"># xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
</span></span><span class="line"><span class="cl"><span class="nv">$users</span> <span class="p">=</span> <span class="nb">import-csv</span> <span class="n">-path</span> <span class="s2">&#34;C:\Users\Olivier\Desktop\import.csv&#34;</span> <span class="n">-delimiter</span> <span class="s2">&#34;;&#34;</span>
</span></span><span class="line"><span class="cl"><span class="k">foreach</span><span class="p">(</span><span class="nv">$user</span> <span class="k">in</span> <span class="nv">$users</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$nom</span> <span class="p">=</span> <span class="nv">$user</span><span class="p">.</span><span class="py">nom</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$prenom</span><span class="p">=</span> <span class="nv">$user</span><span class="p">.</span><span class="py">prenom</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$nomComplet</span> <span class="p">=</span> <span class="nv">$prenom</span> <span class="p">+</span> <span class="s2">&#34; &#34;</span> <span class="p">+</span><span class="nv">$nom</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$idSAM</span> <span class="p">=</span> <span class="nv">$prenom</span><span class="p">.</span><span class="py">substring</span><span class="p">(</span><span class="mf">0</span><span class="p">,</span><span class="mf">1</span><span class="p">)</span> <span class="p">+</span> <span class="nv">$nom</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$id</span> <span class="p">=</span> <span class="nv">$idSAM</span> <span class="p">+</span> <span class="s2">&#34;@tssr.lan&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$pass</span><span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="s2">&#34;1234&#34;</span> <span class="n">-AsPlaintext</span> <span class="n">-Force</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">New-ADuser</span> <span class="n">-name</span> <span class="nv">$idSAM</span> <span class="n">-DisplayName</span> <span class="nv">$nomComplet</span> <span class="n">-givenname</span> <span class="nv">$prenom</span> <span class="n">-surname</span> <span class="nv">$nom</span> <span class="n">-Path</span> <span class="s2">&#34;OU=usagers,DC=tssr,DC=lan&#34;</span> <span class="n">-UserPrincipalName</span> <span class="nv">$id</span> <span class="n">-AccountPassword</span> <span class="nv">$pass</span> <span class="n">-Enabled</span> <span class="vm">$true</span>
</span></span><span class="line"><span class="cl"><span class="p">}</span>
</span></span></code></pre></div>
<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p><strong>Pour l&rsquo;option <code>-Path</code> de la commande <code>New-ADuser</code> l&rsquo;ordre des OU et DC est important (surtout dans le cas d&rsquo;OU imbiquées) : il faut commencer par l&rsquo;extrémité et décrire le chemin en remontant dans l&rsquo;arborescence.</strong></p>
<p><em>Par exemple</em> : pour une sous-OU telle que <code>users\si\network</code> du domaine <code>tssr.lan</code> il faudrait indiquer : <code>-Path &quot;OU=network,OU=si,OU=users,DC=tssr,DC=lan&quot;</code>.</p>
  </div>
</div>
<hr>
<h3 id="2-script-powershell-dajout-dutilisateurs-fictifs-dans-un-ad-pour-tests">2. Script PowerShell d’ajout d’utilisateurs fictifs dans un AD pour tests</h3>
<p><em>Cette variante du script précédent ne nécessite pas de fichier .csv et génère des noms d&rsquo;utilisateurs fictifs</em></p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-powershell" data-lang="powershell"><span class="line"><span class="cl"><span class="c"># xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
</span></span><span class="line"><span class="cl"><span class="c"># Script d’ajout d’utilisateurs fictifs dans un AD pour tests</span>
</span></span><span class="line"><span class="cl"><span class="c"># xxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxxx</span>
</span></span><span class="line"><span class="cl"><span class="k">for</span><span class="p">(</span><span class="nv">$num</span><span class="p">=</span><span class="mf">1</span><span class="p">;</span> <span class="nv">$num</span> <span class="o">-le</span> <span class="mf">50</span><span class="p">;</span> <span class="nv">$num</span><span class="p">++)</span>
</span></span><span class="line"><span class="cl"><span class="p">{</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$nom</span> <span class="p">=</span> <span class="s2">&#34;utilisateur&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$nomComplet</span> <span class="p">=</span> <span class="nv">$nom</span><span class="p">.</span><span class="py">ToTitleCase</span> <span class="p">+</span> <span class="s2">&#34; &#34;</span> <span class="p">+</span> <span class="nv">$num</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$idSAM</span> <span class="p">=</span> <span class="nv">$nom</span> <span class="p">+</span> <span class="nv">$num</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$id</span> <span class="p">=</span> <span class="nv">$idSAM</span> <span class="p">+</span> <span class="s2">&#34;@lyon2024.intra&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$mail</span> <span class="p">=</span> <span class="nv">$idSAM</span> <span class="p">+</span> <span class="s2">&#34;@lyon.com&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$city</span> <span class="p">=</span> <span class="s2">&#34;Lyon&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$company</span> <span class="p">=</span> <span class="s2">&#34;Worldskills&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$group</span> <span class="p">=</span> <span class="s2">&#34;Finances&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="nv">$pass</span><span class="p">=</span> <span class="nb">ConvertTo-SecureString</span> <span class="s2">&#34;P@ssw0rd&#34;</span> <span class="n">-AsPlaintext</span> <span class="n">-Force</span>
</span></span><span class="line"><span class="cl">    
</span></span><span class="line"><span class="cl">    <span class="nb">New-ADuser</span> <span class="n">-name</span> <span class="nv">$idSAM</span> <span class="n">-DisplayName</span> <span class="nv">$nomComplet</span> <span class="n">-Path</span> <span class="s2">&#34;OU=Worldskills,OU=Utilisateurs,OU=auto,DC=lyon2024,DC=intra&#34;</span> <span class="n">-UserPrincipalName</span> <span class="nv">$id</span> <span class="n">-AccountPassword</span> <span class="nv">$pass</span> <span class="n">-Enabled</span> <span class="vm">$true</span> <span class="n">-MailAddress</span> <span class="nv">$mail</span> <span class="n">-City</span> <span class="nv">$city</span> <span class="n">-Company</span> <span class="nv">$company</span>
</span></span><span class="line"><span class="cl">    <span class="nb">Add-ADGroupMember</span> <span class="n">-identity</span> <span class="s2">&#34;Finances&#34;</span> <span class="n">-Members</span> <span class="nv">$idSaAM</span>
</span></span></code></pre></div><hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="chapter">
<div class="article-subheading">Exemple 4</div>
<h1 id="stage-cefim">Stage Cefim</h1>

<hr>
<h2 id="présentation"><strong>Présentation</strong></h2>
<p>Projet de simplification et rationnalisation de l&rsquo;utilisation des vouchers pour le réseau Wifi CEFIM_PEDAGO réalisé sur Google Workspace avec Apps Script :</p>
<p>Voir : <a href="../at2/at2e2/stage-cefim/">Sécuriser les accès à Internet - Stage Cefim</a></p>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <article class="chapter">
<div class="article-subheading">Exemple 5</div>
<h1 id="python">Python</h1>

<hr>
<h2 id="scripts-python"><strong>Scripts python</strong></h2>
<hr>

<div class="box notices cstyle info">
  <div class="box-label"><i class="fa-fw fas fa-info-circle"></i> Information</div>
  <div class="box-content">
<p>Le projet &ldquo;ScrapPy&rdquo; est disponible et documenté sur
<span class="btn cstyle transparent">
<a href="https://github.com/oliduha/scrappy/" target="_blank">
github
</a>
</span></p>
  </div>
</div>
<p>Voici le contenu du module scrapper.py contenant les diverses fonctions appelées depuis le code principal (main.py).</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">bs4</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">csv</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">except</span> <span class="ne">ImportError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Erreur d&#39;import : &#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">requests</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">bs4</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">os</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">json</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">csv</span>
</span></span><span class="line"><span class="cl">    <span class="kn">import</span> <span class="nn">re</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># cf : https://stackoverflow.com/questions/287871/how-do-i-print-colored-text-to-the-terminal</span>
</span></span><span class="line"><span class="cl"><span class="n">col_red</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[91m&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">col_green</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\33</span><span class="s1">[92m&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">col_yellow</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[93m&#39;</span>
</span></span><span class="line"><span class="cl"><span class="n">col_end</span> <span class="o">=</span> <span class="s1">&#39;</span><span class="se">\033</span><span class="s1">[0m&#39;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">scrap</span><span class="p">(</span><span class="n">links</span><span class="p">,</span> <span class="n">make_csv</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">make_json</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">aio</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">list_titre</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">list_a</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">list_csv</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">    <span class="n">dict_json</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="n">file_name</span> <span class="o">=</span> <span class="s2">&#34;&#34;</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">links</span><span class="p">)):</span>
</span></span><span class="line"><span class="cl">        <span class="n">file_name</span> <span class="o">=</span> <span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="n">link</span> <span class="o">=</span> <span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># On récupère le contenu de la page en cours</span>
</span></span><span class="line"><span class="cl">        <span class="n">req_scrap</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">link</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">col_yellow</span> <span class="o">+</span> <span class="s2">&#34;Lecture de la page : &#34;</span> <span class="o">+</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">file_name</span><span class="si">}</span><span class="s2"> [</span><span class="si">{</span><span class="n">links</span><span class="p">[</span><span class="n">i</span><span class="p">]</span><span class="si">}</span><span class="s2">]&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># On parse le html avec BeautifulSoup</span>
</span></span><span class="line"><span class="cl">        <span class="n">table</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">req_scrap</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&#34;html.parser&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;table&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="n">list_b</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;b&#39;</span><span class="p">)</span>  <span class="c1"># On récupère tous les &lt;b&gt; de la table</span>
</span></span><span class="line"><span class="cl">        <span class="n">list_tr</span> <span class="o">=</span> <span class="n">table</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;tr&#39;</span><span class="p">)</span>  <span class="c1"># On récupère tous les &lt;tr&gt; de la table</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># On ajoute le texte des &lt;b&gt; dans la liste</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">t</span> <span class="ow">in</span> <span class="n">list_b</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">list_titre</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">t</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="c1"># Pour chaque ligne</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">tr</span> <span class="ow">in</span> <span class="n">list_tr</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">list_td</span> <span class="o">=</span> <span class="n">tr</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;td&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">for</span> <span class="n">td</span> <span class="ow">in</span> <span class="n">list_td</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">list_p</span> <span class="o">=</span> <span class="n">td</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;p&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">list_p</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                    <span class="c1"># Si le contenu n&#39;est pas un \n</span>
</span></span><span class="line"><span class="cl">                    <span class="k">if</span> <span class="n">p</span> <span class="o">!=</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                        <span class="c1"># Si &lt;a&gt; est présent</span>
</span></span><span class="line"><span class="cl">                        <span class="k">if</span> <span class="n">td</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">                            <span class="n">list_a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">                        <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                            <span class="n">list_a</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">p</span><span class="o">.</span><span class="n">text</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">make_csv</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">col_yellow</span> <span class="o">+</span> <span class="s2">&#34;Préparation des donnée csv...&#34;</span> <span class="o">+</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">i</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">list_csv</span> <span class="o">=</span> <span class="p">[</span><span class="n">list_titre</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">aio</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">list_csv</span> <span class="o">+=</span> <span class="n">prepare_scv</span><span class="p">(</span><span class="n">list_a</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">                <span class="n">file_name</span> <span class="o">=</span> <span class="s2">&#34;Port de 0 à 65535&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">list_csv</span> <span class="o">=</span> <span class="p">[</span><span class="n">list_titre</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">                <span class="n">list_csv</span> <span class="o">+=</span> <span class="n">prepare_scv</span><span class="p">(</span><span class="n">list_a</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">make_json</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="nb">print</span><span class="p">(</span><span class="n">col_yellow</span> <span class="o">+</span> <span class="s2">&#34;Préparation des donnée json...&#34;</span> <span class="o">+</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">            <span class="k">if</span> <span class="n">aio</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dict_json</span> <span class="o">=</span> <span class="p">{</span><span class="o">**</span><span class="n">dict_json</span><span class="p">,</span> <span class="o">**</span><span class="n">prepare_json</span><span class="p">(</span><span class="n">list_tr</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)}</span>
</span></span><span class="line"><span class="cl">                <span class="n">file_name</span> <span class="o">=</span> <span class="s2">&#34;Port de 0 à 65535&#34;</span>
</span></span><span class="line"><span class="cl">            <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">                <span class="n">dict_json</span> <span class="o">=</span> <span class="n">prepare_json</span><span class="p">(</span><span class="n">list_tr</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">make_csv</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">create_scv</span><span class="p">(</span><span class="n">list_csv</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">make_json</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">create_json</span><span class="p">(</span><span class="n">dict_json</span><span class="p">,</span> <span class="n">file_name</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">prepare_scv</span><span class="p">(</span><span class="n">lst_a</span><span class="p">,</span> <span class="n">csv_file_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># CSV FILE #######################</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">col_yellow</span><span class="si">}</span><span class="s2">Traitement des données de </span><span class="si">{</span><span class="n">csv_file_name</span><span class="si">}</span><span class="s2"> pour csv...</span><span class="si">{</span><span class="n">col_end</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># On supprime les 4 premiers éléments (les titres) de la liste</span>
</span></span><span class="line"><span class="cl">    <span class="n">list_elem</span> <span class="o">=</span> <span class="n">lst_a</span><span class="p">[</span><span class="mi">4</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">    <span class="n">list_csv</span> <span class="o">=</span> <span class="p">[]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">list_elem</span><span class="p">),</span> <span class="mi">4</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">list_csv</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">list_elem</span><span class="p">[</span><span class="n">i</span><span class="p">:</span><span class="n">i</span> <span class="o">+</span> <span class="mi">4</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># On vérifie l&#39;existence de l&#39;arborescence et on la crée si besoin</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&#34;exports/csv&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&#34;exports/csv&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">list_csv</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_scv</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">csv_file_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">csv_file_name</span> <span class="o">=</span> <span class="n">csv_file_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34;_&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># On écrit dans le fichier csv les éléments de chaque ligne</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;exports/csv/&#34;</span> <span class="o">+</span> <span class="n">csv_file_name</span> <span class="o">+</span> <span class="s1">&#39;.csv&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">newline</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">csvfile</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">writer</span> <span class="o">=</span> <span class="n">csv</span><span class="o">.</span><span class="n">writer</span><span class="p">(</span><span class="n">csvfile</span><span class="p">,</span> <span class="n">delimiter</span><span class="o">=</span><span class="s1">&#39;;&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">writer</span><span class="o">.</span><span class="n">writerow</span><span class="p">(</span><span class="n">row</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">col_green</span> <span class="o">+</span> <span class="s2">&#34;Fichier &#34;</span> <span class="o">+</span> <span class="n">csv_file_name</span> <span class="o">+</span> <span class="s2">&#34;.csv créé !&#34;</span> <span class="o">+</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">prepare_json</span><span class="p">(</span><span class="n">list_tr</span><span class="p">,</span> <span class="n">json_file_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># JSON FILE ##########################</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">col_yellow</span><span class="si">}</span><span class="s2">Traitement des données de </span><span class="si">{</span><span class="n">json_file_name</span><span class="si">}</span><span class="s2"> pour json...</span><span class="si">{</span><span class="n">col_end</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># Suppression des titres</span>
</span></span><span class="line"><span class="cl">    <span class="n">lines_soups</span> <span class="o">=</span> <span class="n">list_tr</span><span class="p">[</span><span class="mi">1</span><span class="p">:]</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># 3. Structurer les données</span>
</span></span><span class="line"><span class="cl">    <span class="n">dict_json</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">line_soup</span> <span class="ow">in</span> <span class="n">lines_soups</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">columns_soups</span> <span class="o">=</span> <span class="n">line_soup</span><span class="o">.</span><span class="n">find_all</span><span class="p">(</span><span class="s2">&#34;p&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="n">port_name</span> <span class="o">=</span> <span class="n">columns_soups</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">        <span class="n">port_number</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">columns_soups</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">string</span><span class="p">)</span>  <span class="c1"># Ajout du parsing</span>
</span></span><span class="line"><span class="cl">        <span class="n">port_protocol</span> <span class="o">=</span> <span class="n">columns_soups</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;a&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">string</span>
</span></span><span class="line"><span class="cl">        <span class="n">port_description</span> <span class="o">=</span> <span class="n">columns_soups</span><span class="p">[</span><span class="mi">3</span><span class="p">]</span><span class="o">.</span><span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">port_number</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_json</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">dict_json</span><span class="p">[</span><span class="n">port_number</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">port_protocol</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">dict_json</span><span class="p">[</span><span class="n">port_number</span><span class="p">]:</span>
</span></span><span class="line"><span class="cl">            <span class="n">dict_json</span><span class="p">[</span><span class="n">port_number</span><span class="p">][</span><span class="n">port_protocol</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">        <span class="n">dict_json</span><span class="p">[</span><span class="n">port_number</span><span class="p">][</span><span class="n">port_protocol</span><span class="p">][</span><span class="n">port_name</span><span class="p">]</span> <span class="o">=</span> <span class="n">port_description</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">dict_json</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">create_json</span><span class="p">(</span><span class="n">dict_json</span><span class="p">,</span> <span class="n">json_file_name</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">json_file_name</span> <span class="o">=</span> <span class="n">json_file_name</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&#34; &#34;</span><span class="p">,</span> <span class="s2">&#34;_&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># On vérifie l&#39;existence de l&#39;arborescence</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="s2">&#34;exports/json&#34;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Et on la crée si besoin</span>
</span></span><span class="line"><span class="cl">        <span class="n">os</span><span class="o">.</span><span class="n">makedirs</span><span class="p">(</span><span class="s2">&#34;exports/json&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># On écrit dans le fichier json les éléments de dict_json</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="s2">&#34;exports/json/&#34;</span> <span class="o">+</span> <span class="n">json_file_name</span> <span class="o">+</span> <span class="s1">&#39;.json&#39;</span><span class="p">,</span> <span class="s1">&#39;w&#39;</span><span class="p">,</span> <span class="n">encoding</span><span class="o">=</span><span class="s1">&#39;utf8&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">jsonfile</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">dict_json</span><span class="p">,</span> <span class="n">jsonfile</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">col_green</span> <span class="o">+</span> <span class="s2">&#34;Fichier &#34;</span> <span class="o">+</span> <span class="n">json_file_name</span> <span class="o">+</span> <span class="s2">&#34;.json créé !&#34;</span> <span class="o">+</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">test_cnx</span><span class="p">(</span><span class="n">url_cnx</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># On récupère le contenu de la page en cours avec gestion des erreurs</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">req_test</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_cnx</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">er</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">col_red</span> <span class="o">+</span> <span class="s2">&#34;</span><span class="se">\n</span><span class="s2">Erreur : Vérifiez votre connexion à Internet.&#34;</span> <span class="o">+</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">er</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">Timeout</span> <span class="k">as</span> <span class="n">er</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">col_red</span> <span class="o">+</span> <span class="s2">&#34;Erreur : Timeout.&#34;</span> <span class="o">+</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">er</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">er</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">col_red</span> <span class="o">+</span> <span class="s2">&#34;Erreur générale.&#34;</span> <span class="o">+</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">er</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">col_yellow</span> <span class="o">+</span> <span class="s2">&#34;Le programme a été fermé&#34;</span><span class="p">,</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">req_test</span><span class="o">.</span><span class="n">status_code</span> <span class="o">==</span> <span class="mi">200</span><span class="p">:</span>  <span class="c1"># Si le site est en ligne</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">col_green</span> <span class="o">+</span> <span class="s1">&#39;OK, la page est en ligne !&#39;</span><span class="p">,</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">True</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># Si le site est en maintenance ou hors ligne</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">col_red</span> <span class="o">+</span> <span class="s2">&#34;Erreur : La page renvoi le code d&#39;état&#34;</span><span class="p">,</span> <span class="n">req_test</span><span class="o">.</span><span class="n">status_code</span><span class="p">,</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="kc">False</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">read_headers</span><span class="p">(</span><span class="n">url_h</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="n">req_h</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_h</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="n">col_yellow</span> <span class="o">+</span> <span class="s2">&#34;Headers :&#34;</span> <span class="o">+</span> <span class="n">col_end</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">header</span> <span class="ow">in</span> <span class="n">req_h</span><span class="o">.</span><span class="n">headers</span><span class="p">:</span>  <span class="c1"># On affiche les headers</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">header</span><span class="p">,</span> <span class="n">req_h</span><span class="o">.</span><span class="n">headers</span><span class="p">[</span><span class="n">header</span><span class="p">])</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">req_h</span><span class="o">.</span><span class="n">headers</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">cookies</span><span class="p">(</span><span class="n">url_c</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">col_yellow</span><span class="si">}</span><span class="s2">Cookies : </span><span class="si">{</span><span class="n">col_end</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># On récupère la session</span>
</span></span><span class="line"><span class="cl">    <span class="k">with</span> <span class="n">requests</span><span class="o">.</span><span class="n">session</span><span class="p">()</span> <span class="k">as</span> <span class="n">session</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">req_c</span> <span class="o">=</span> <span class="n">session</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_c</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">cok</span> <span class="ow">in</span> <span class="n">req_c</span><span class="o">.</span><span class="n">cookies</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="n">cok</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">req_c</span><span class="o">.</span><span class="n">cookies</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">all_links</span><span class="p">(</span><span class="n">url_l</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">try</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">req_l</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">url_l</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">ConnectionError</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">col_red</span><span class="si">}</span><span class="se">\n</span><span class="s2">Erreur ! Vérifiez l&#39;URL saisie :</span><span class="si">{</span><span class="n">col_end</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;ERREUR&#34;</span><span class="p">:</span> <span class="s2">&#34;Vérifiez l&#39;URL saisie&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">Timeout</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">col_red</span><span class="si">}</span><span class="se">\n</span><span class="s2">Erreur ! Timeout :</span><span class="si">{</span><span class="n">col_end</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;ERREUR&#34;</span><span class="p">:</span> <span class="s2">&#34;Timeout&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="n">requests</span><span class="o">.</span><span class="n">RequestException</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">col_red</span><span class="si">}</span><span class="se">\n</span><span class="s2">Erreur générale :</span><span class="si">{</span><span class="n">col_end</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;ERREUR&#34;</span><span class="p">:</span> <span class="s2">&#34;Générale&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">col_yellow</span><span class="si">}</span><span class="se">\n</span><span class="s2">Le programme a été fermé</span><span class="si">{</span><span class="n">col_end</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;ERREUR&#34;</span><span class="p">:</span> <span class="s2">&#34;Le programme a été fermé&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="s2">&#34;Erreur inconnue !&#34;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="p">{</span><span class="s2">&#34;ERREUR&#34;</span><span class="p">:</span> <span class="s2">&#34;inconnue&#34;</span><span class="p">}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">()</span>
</span></span><span class="line"><span class="cl">    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">col_yellow</span><span class="si">}</span><span class="s2">Liens : </span><span class="si">{</span><span class="n">col_end</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">dict_links</span> <span class="o">=</span> <span class="p">{}</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">    <span class="c1"># On parse le html avec BeautifulSoup</span>
</span></span><span class="line"><span class="cl">    <span class="n">page</span> <span class="o">=</span> <span class="n">bs4</span><span class="o">.</span><span class="n">BeautifulSoup</span><span class="p">(</span><span class="n">req_l</span><span class="o">.</span><span class="n">content</span><span class="p">,</span> <span class="s2">&#34;html.parser&#34;</span><span class="p">)</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&#34;body&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="n">list_links</span> <span class="o">=</span> <span class="n">page</span><span class="o">.</span><span class="n">findAll</span><span class="p">(</span><span class="s1">&#39;a&#39;</span><span class="p">)</span>  <span class="c1"># On récupère toutes les balises &lt;a&gt; de la page</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">link</span> <span class="ow">in</span> <span class="n">list_links</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">url_pattern</span> <span class="o">=</span> <span class="s2">&#34;^https?:</span><span class="se">\\</span><span class="s2">/</span><span class="se">\\</span><span class="s2">/(?:www</span><span class="se">\\</span><span class="s2">.)?[-a-zA-Z0-9@:%._</span><span class="se">\\</span><span class="s2">+~#=]{1,256}</span><span class="se">\\</span><span class="s2">.[a-zA-Z0-9()]{1,6}</span><span class="se">\\</span><span class="s2">b(?:[-a-zA-Z0-9() </span><span class="se">\
</span></span></span><span class="line"><span class="cl"><span class="se"></span><span class="s2">                  @:%_</span><span class="se">\\</span><span class="s2">+.~#?&amp;</span><span class="se">\\</span><span class="s2">/=]*)$&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">link</span><span class="o">.</span><span class="n">string</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">            <span class="n">link</span><span class="o">.</span><span class="n">string</span> <span class="o">=</span> <span class="s2">&#34;N.A.&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># On vérifie si URL est correcte</span>
</span></span><span class="line"><span class="cl">        <span class="k">if</span> <span class="n">re</span><span class="o">.</span><span class="n">match</span><span class="p">(</span><span class="n">url_pattern</span><span class="p">,</span> <span class="n">link</span><span class="p">[</span><span class="s2">&#34;href&#34;</span><span class="p">]):</span>
</span></span><span class="line"><span class="cl">            <span class="n">dict_links</span><span class="p">[</span><span class="n">link</span><span class="o">.</span><span class="n">string</span><span class="p">]</span> <span class="o">=</span> <span class="n">link</span><span class="p">[</span><span class="s2">&#34;href&#34;</span><span class="p">]</span>
</span></span><span class="line"><span class="cl">    <span class="n">nbl</span> <span class="o">=</span> <span class="mi">0</span>
</span></span><span class="line"><span class="cl">    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">dict_links</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="n">nbl</span> <span class="o">+=</span> <span class="mi">1</span>
</span></span><span class="line"><span class="cl">        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&#34;</span><span class="si">{</span><span class="n">nbl</span><span class="si">}</span><span class="s2">-[</span><span class="si">{</span><span class="n">key</span><span class="si">}</span><span class="s2">] </span><span class="si">{</span><span class="n">dict_links</span><span class="p">[</span><span class="n">key</span><span class="p">]</span><span class="si">}</span><span class="s2">&#34;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl">    <span class="k">return</span> <span class="n">dict_links</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Oli ############</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(__name__)</span>
</span></span><span class="line"><span class="cl"><span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&#34;__main__&#34;</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># url = &#34;https://www.frameip.com/liste-des-ports.php/?plage=1&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="n">url</span> <span class="o">=</span> <span class="s2">&#34;https://www.google.com&#34;</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># scrap(url)</span>
</span></span><span class="line"><span class="cl">    <span class="c1"># read_headers(url)</span>
</span></span><span class="line"><span class="cl">    <span class="n">cookies</span><span class="p">(</span><span class="n">url</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="c1">##################</span>
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl"><span class="c1"># Bryan ##########</span>
</span></span><span class="line"><span class="cl"><span class="c1"># print(__name__)</span>
</span></span><span class="line"><span class="cl"><span class="c1"># if __name__ == &#34;__main__&#34;:</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     url = &#34;https://www.frameip.com/liste-des-ports.php&#34;</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     scrap(url)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     read_headers(url)</span>
</span></span><span class="line"><span class="cl"><span class="c1">#     cookies(url)</span>
</span></span><span class="line"><span class="cl"><span class="c1">##################</span>
</span></span></code></pre></div>
            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="chapter">
<div class="article-subheading">Chapitre 3</div>
<h1 id="maintenir-et-sécuriser-les-accès-réseaux-distants">Maintenir et sécuriser les accès réseaux distants</h1>

<hr>
<h4 id="1-stage-armatisat3at3e3stage-armatis">1. <a href="../at3/at3e3/stage-armatis/">Stage Armatis</a></h4>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Sous-sections de Maintenir et sécuriser les accès réseaux distants</h1>
          <article class="chapter">
<div class="article-subheading">Exemple 1</div>
<h1 id="stage-armatis">Stage Armatis</h1>

<h2 id="sécurisation-du-réseau-armatis-sur-un-plateau-edf">Sécurisation du réseau Armatis sur un plateau EDF</h2>
<p>Lors de la mise en place d&rsquo;un poste de travail, le brassage du poste n&rsquo;est pas toujours de fait. Si le poste n&rsquo;a pas de connexion réseau, il faut procéder à divers vérifications :</p>
<p>On connecte un pc portable dont on connaît l&rsquo;adresse MAC au cable Ethernet du poste à vérifier, puis on se connecte en admin à un autre poste et via Putty et le CLI Cisco on recherche à quel port de quel switch le poste est connecté.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">show mac address-table address xxxx.xxxx.xxxx
</span></span></code></pre></div><ul>
<li>Si la réponse indique que l&rsquo;adresse MAC a été trouvée sur un port Gi0/x, cela signifie que la machine est connectée à un autre switch (lien inter-switch).</li>
<li>Si la réponse indique un port du type Fa0/x, nous somme sur le bon switch et nous savons donc sur quel port.</li>
<li>Si la commande ne trouve pas cette adresse MAC, c&rsquo;est que la prise Ethernet n&rsquo;est pas brassée. Il faut alors :
<ol>
<li>Relever le numéro de la prise réseau du poste</li>
<li>Aller en salle blanche contrôler le brassage en suivant le cable correspondant au numéro de prise relevé vers le switch</li>
<li>Si aucun cable ne sort du numéro de prise en salle blanche, on va chercher à connecter le poste à une autre prise disponible proche du poste de travail (certains switchs sont saturés).</li>
<li>alternativement, si au moins un port de switch est libre, on pourra tirer un nouveau cable pour faire la liaison.</li>
<li>Relever le port du switch connecté</li>
<li>Depuis un poste en admin, configurer le port du switch concerné, l&rsquo;activer si besoin et effectuer les réglages de sécurisation (voir ci-après)</li>
</ol>
</li>
</ul>
<hr>
<p>La sécurisation réseau consiste à limiter le nombre d&rsquo;adresses Mac différentes qu&rsquo;il est possible de connecter sur chaque ports du switch (maximum) et une fois qu&rsquo;une machine est connectée au switch, elle n&rsquo;est plus autorisée à utiliser un autre port (mac-address sticky) sous peine de provoquer la désactivation automatique du port.</p>
<p>On différencie 2 cas :</p>
<ul>
<li>Les postes fixes :
<ul>
<li>3 adresses Mac maximum autorisées (souche, VM + administration)</li>
<li>le mode sticky activé</li>
</ul>
</li>
<li>Les postes TAD Structurel :
<ul>
<li>30 adresses Mac</li>
<li>pas de sticky</li>
</ul>
</li>
</ul>
<p>En effet, le TAD structurel mis en place chez Armatis consiste en une alternance de 2 jour à domicile et 3 jours sur site. Les téléconseillé concerné se voient donc attribués une UC qu&rsquo;ils emmènent chez eux et rapportent avec eux lorsqu&rsquo;ils travail sur site. Des postes sont donc aménagés spécifiquement avec une sécurité réseau permettant d&rsquo;accepter différentes machines (contrairement à une poste de travail fixe).</p>
<p>On va reconfigurer tous les ports du switch durant la manipulation. On sait déjà quels ports correspondent à quels cas :</p>
<ol>
<li>Pour accéder a switch, il faut préalablement se connecter sur un poste en admin et créer une règle temporaire de contournement du pare-feu autorisant tous les ports en sortie.</li>
<li>On accède ensuite au switch via Putty et en utilisant le CLI Cisco</li>
<li>On vérifie l&rsquo;état des interfaces : <code>sh int status</code></li>
<li>Puis l&rsquo;état des vlan : <code>sh vlan</code></li>
<li>On réinitialise le port-security sticky pour tous les ports :</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">clear port-security sticky
</span></span></code></pre></div><ol start="6">
<li>On peut vérifier l&rsquo;état d&rsquo;un port en particulier : <code>sh run int fa0/4</code></li>
<li>On passe en mode configuration terminal avec</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">conf t
</span></span></code></pre></div>
<div class="box notices cstyle note">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-circle"></i> Remarque</div>
  <div class="box-content">
<p><em><strong>On commence maintenant la configuration.</strong> On va agir sur des plages de ports consécutifs.</em></p>
  </div>
</div>
<ol>
<li>Cas d&rsquo;une plage des 4 premiers ports pour des postes fixes :</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">int r fa0/1-4
</span></span><span class="line"><span class="cl">switchport port-security maximum <span class="m">3</span>
</span></span><span class="line"><span class="cl">switchport port-security mac-address sticky
</span></span><span class="line"><span class="cl">switchport port-security
</span></span></code></pre></div>
<div class="box notices cstyle warning">
  <div class="box-label"><i class="fa-fw fas fa-exclamation-triangle"></i> Attention</div>
  <div class="box-content">
<p>Cette dernière commande est indispensable pour activer la sécurité</p>
  </div>
</div>
<ol>
<li>Cas d&rsquo;une plage de 2 ports pour des postes TAD</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">int r fa0/5-6
</span></span><span class="line"><span class="cl">switchport port-security maximum <span class="m">30</span>
</span></span><span class="line"><span class="cl">no switchport port-security mac-address sticky
</span></span><span class="line"><span class="cl">switchport port-security
</span></span><span class="line"><span class="cl">description **** TAD STRUCT ****
</span></span></code></pre></div><ol start="10">
<li>On répète ces opérations autant de fois que nécessaire pour configurer tous les ports du switch (24 ou 48)</li>
<li>On sort du mode configuration avec <code>end</code></li>
<li>Pour finir on enregistre la configuration avec</li>
</ol>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">wr mem
</span></span></code></pre></div><ol start="13">
<li>Et on quitte le CLI avec <code>exit</code></li>
</ol>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="chapter">
<div class="article-subheading">Chapitre 4</div>
<h1 id="superviser-linfrastructure">Superviser l&#39;infrastructure</h1>

<hr>
<h4 id="1-zabbixat3at3e4zabbix">1. <a href="../at3/at3e4/zabbix/">Zabbix</a></h4>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Sous-sections de Superviser l&#39;infrastructure</h1>
          <article class="chapter">
<div class="article-subheading">Exemple 1</div>
<h1 id="zabbix">Zabbix</h1>

<hr>
<h2 id="ressources">Ressources</h2>
<ul>
<li><a href="https://www.zabbix.com/download" target="_blank">Installation de Zabbix</a></li>
<li><a href="https://bestmonitoringtools.com/how-to-install-zabbix-server-on-debian/" target="_blank">Tuto ultime d&rsquo;installation Zabbix 6.2 sur Debian</a></li>
<li><a href="https://www.zabbix.com/documentation/current/en/manual/config/notifications/media/webhook" target="_blank">Documentation webhook</a></li>
<li><a href="https://www.tech2tech.fr/monitoring-5-supervision-dun-nas-synology-via-snmp/" target="_blank">Supervision d&rsquo;un NAS Synology via SNMP et Zabbix</a></li>
<li><a href="https://techexpert.tips/fr/zabbix-fr/zabbix-5-installation-sur-ubuntu-linux/" target="_blank">Une liste de tuto Zabbix</a></li>
</ul>
<hr>
<p><em>TP Cefim terminé avec succès :</em></p>
<p>
<a href="#image-c2e31e02185f11817b52b16df57acf65" class="lightbox-link">
<img src="../at3/at3e4/zabbix/final_zabbix_webhook_alert.png" alt="zabbix webhook alerte" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-c2e31e02185f11817b52b16df57acf65">
<img src="../at3/at3e4/zabbix/final_zabbix_webhook_alert.png" alt="zabbix webhook alerte" class="lightbox-image" loading="lazy">
</a></p>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="chapter">
<div class="article-subheading">Chapitre 5</div>
<h1 id="intervenir-dans-un-environnement-de-cloud-computing">Intervenir dans un environnement de Cloud Computing</h1>

<hr>
<h4 id="1-awsat3at3e5aws">1. <a href="../at3/at3e5/aws/">AWS</a></h4>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Sous-sections de Intervenir dans un environnement de Cloud Computing</h1>
          <article class="chapter">
<div class="article-subheading">Exemple 1</div>
<h1 id="aws">AWS</h1>

<h2 id="monter-un-serveur-lamps-avec-nextcloud-sur-aws"><strong>Monter un serveur LAMPS avec NextCloud sur AWS</strong></h2>
<h2 id="préambule">Préambule</h2>
<ul>
<li>se connecter dans AWS</li>
<li>se familiariser avec l’interface</li>
<li>créer ou utiliser une AMI (amazon machine image) d’une debian 10</li>
<li>créer une instance de cette ami en mode t2.micro</li>
<li>se connecter dessus en ssh</li>
<li>paramétrer le firewall de AWS pour les ports concernés (au moins 80,443,22&hellip;)</li>
<li>Migrer le deb10 en deb11 avec la méthode dist-upgrade</li>
<li>installer un service WEB APP de votre choix (Wordpress, GLPI, Nextcloud, Wiki….)</li>
<li>sécuriser la solution (par ex : Fail2Ban)</li>
<li>on doit pouvoir consulter votre service web par une ip publique et par le nom dns générique donné par AWS</li>
<li>vous devrez enregistrer un vrai nom fqdn ans grâce à  votre hébergement ou domaine perso ou un service no-ip</li>
<li>vous devez installer Let’s encrypt  via certbot:-)</li>
<li>automatiser le renouvellement du certificat SSL/TLS tous les 3 mois via cron</li>
</ul>
<h2 id="1---connexion-à-aws-et-instanciation">1 - <strong>Connexion à AWS et instanciation</strong></h2>
<ul>
<li>
<p>Connexion au compte cefimaws / username / mdp fourni par cefim</p>
</li>
<li>
<p>Connexion à la zone eu-west-2 (Londre)</p>
</li>
<li>
<p>Création d&rsquo;une instance</p>
<ul>
<li>t2.micro</li>
<li>AMI debian 10 x86-x64 de juil-22 par FAI</li>
<li>1 processeur</li>
<li>1 GO RAM</li>
<li>8 GO d&rsquo;espace disque</li>
<li>enregistrement clés (username_key.pem)</li>
</ul>
</li>
</ul>
<p>
<a href="#image-c95a16b15560b35ed507bc74f23c07ec" class="lightbox-link">
<img src="../at3/at3e5/aws/01_AWS_instance.png" alt="AWS_instance" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-c95a16b15560b35ed507bc74f23c07ec">
<img src="../at3/at3e5/aws/01_AWS_instance.png" alt="AWS_instance" class="lightbox-image" loading="lazy">
</a></p>
<p>
<a href="#image-8714ee042a572c94a18864a571ceea25" class="lightbox-link">
<img src="../at3/at3e5/aws/01_AWS_instance_reseau.png" alt="AWS_instance_reseau" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-8714ee042a572c94a18864a571ceea25">
<img src="../at3/at3e5/aws/01_AWS_instance_reseau.png" alt="AWS_instance_reseau" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>configuration pare-feu AWS pour les ports nécessaires</li>
</ul>
<p>
<a href="#image-1542bd991dda1cf34c3453d82a2686e1" class="lightbox-link">
<img src="../at3/at3e5/aws/01_AWS_instance_secu.png" alt="AWS_instance_secu" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1542bd991dda1cf34c3453d82a2686e1">
<img src="../at3/at3e5/aws/01_AWS_instance_secu.png" alt="AWS_instance_secu" class="lightbox-image" loading="lazy">
</a></p>
<ul>
<li>Enregistrement FQDN (OVH) avec l&rsquo;IP publique fournie par AWS 18.133.224.112 =&gt; oduhamel.oliduha.fr</li>
</ul>
<h2 id="2---prise-de-contrôle-en-ssh">2 - <strong>Prise de contrôle en SSH</strong></h2>
<ul>
<li>Connexion en ssh avec les clés fournies par AWS</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-cmd" data-lang="cmd"><span class="line"><span class="cl">C<span class="p">:</span><span class="nl">\Uers\Olivier</span><span class="c1">&gt;ssh -i _PEM\oduhamel_key.pem admin@oduhamel.oliduha.fr</span>
</span></span></code></pre></div><ul>
<li>Connexion au compte root</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">sudo su -
</span></span></code></pre></div><ul>
<li>Changement du mot de passe root</li>
</ul>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">passwd
</span></span></code></pre></div><h2 id="3---upgrade-debian-10--11">3 - <strong>Upgrade debian 10 =&gt; 11</strong></h2>
<p><a href="https://www.cyberciti.biz/faq/update-upgrade-debian-10-to-debian-11-bullseye/" target="_blank">https://www.cyberciti.biz/faq/update-upgrade-debian-10-to-debian-11-bullseye/</a></p>
<p>
<a href="#image-531c9445d3ca2215f2c080e8c05743c5" class="lightbox-link">
<img src="../at3/at3e5/aws/03_upgrade_debian_10_11.png" alt="upgrade_debian_10_11" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-531c9445d3ca2215f2c080e8c05743c5">
<img src="../at3/at3e5/aws/03_upgrade_debian_10_11.png" alt="upgrade_debian_10_11" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="4---iptables--iptables-persistent">4 - <strong>Iptables + iptables-persistent</strong></h2>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install iptables 
</span></span></code></pre></div><p>Ajout des règles nécessaires dans iptables</p>
<p>
<a href="#image-1100c5e5fedb1f28aac648b1276f9292" class="lightbox-link">
<img src="../at3/at3e5/aws/04_iptables_conf.png" alt="Iptables_conf" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-1100c5e5fedb1f28aac648b1276f9292">
<img src="../at3/at3e5/aws/04_iptables_conf.png" alt="Iptables_conf" class="lightbox-image" loading="lazy">
</a></p>
<p>puis :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install iptables-persistent
</span></span></code></pre></div><p>Accepter la sauvegarde proposée durant l&rsquo;installation va créer 2 fichiers qui seront automatiquement rechargés après un reboot :</p>
<blockquote>
<p>/etc/iptables/rules.v4<br>
/etc/iptables/rules.v6</p>
</blockquote>
<p>Pour maj de ces fichier après modif :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">iptables-save &gt; /etc/iptables/rules.v4
</span></span></code></pre></div><p><em>Nous travaillerons essentiellement en IPv4.</em></p>
<p>
<a href="#image-800abb849ce9f251057262dc99fd015d" class="lightbox-link">
<img src="../at3/at3e5/aws/04_iptables_save.png" alt="Iptables_save" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-800abb849ce9f251057262dc99fd015d">
<img src="../at3/at3e5/aws/04_iptables_save.png" alt="Iptables_save" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="5---apache">5 - <strong>Apache</strong></h2>
<p>Installer apache2 et activer les modules ssl, rewrite et headers.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install apache2
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">a2enmod ssl rewrite headers
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">service apache2 restart
</span></span></code></pre></div><h2 id="6---certificat-lets-encrypt">6 - <strong>Certificat Let&rsquo;s Encrypt</strong></h2>
<p><strong>Créer un certificat debian pour apache</strong> avec <a href="https://certbot.eff.org/" target="_blank">https://certbot.eff.org/</a></p>
<p>Une fois le certificat crée, on retrouve ses fichiers dans <code>/etc/letsencrypt/live/oduhamel.oliduha.fr/</code></p>
<p>Il est aussi référencé dans le fichier .conf du site default-ssl d&rsquo;apache</p>
<p>On regroupe les 2 configurations par défaut d&rsquo;apache dans une seule</p>
<p>
<a href="#image-c23d9a704853b92e74dba49ac5feee76" class="lightbox-link">
<img src="../at3/at3e5/aws/05_apache_sites.png" alt="Apache_sites" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-c23d9a704853b92e74dba49ac5feee76">
<img src="../at3/at3e5/aws/05_apache_sites.png" alt="Apache_sites" class="lightbox-image" loading="lazy">
</a></p>
<p>et on redémarre apache2</p>
<p>On automatise ensuite le renouvellement du certificat tous les 3 mois via crontab</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">crontab -e
</span></span></code></pre></div><p>et on ajoute :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="m">0</span> <span class="m">0</span> <span class="m">1</span> */3 * certbot renew --apache --domain oduhamel.oliduha.fr -n
</span></span></code></pre></div><h2 id="7---mariadb">7 - <strong>Mariadb</strong></h2>
<p>installation de mariadb</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install mariadb-server mariadb-client
</span></span></code></pre></div><p>puis</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mysql_secure_installation
</span></span></code></pre></div><ul>
<li>passer le PW root [Enter]</li>
<li>activer unix_socket authentication [Y]</li>
<li>Indiquer ici un PW fort pour root et confirmer [&hellip;][&hellip;]</li>
<li>Supprimer l&rsquo;utilisateur anonyme [Y]</li>
<li>désactiver le login à distance root  [Y]</li>
<li>supprimer la base test [Y]</li>
<li>actualiser la table des privilèges [Y]</li>
</ul>
<p>Création BDD et User pour Nextcloud</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">mysql -u root -p
</span></span></code></pre></div><p>puis dans mariadb</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-sql" data-lang="sql"><span class="line"><span class="cl"><span class="k">CREATE</span><span class="w"> </span><span class="k">DATABASE</span><span class="w"> </span><span class="n">nextcloud_db</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">CREATE</span><span class="w"> </span><span class="k">USER</span><span class="w"> </span><span class="n">nextclouduser</span><span class="o">@</span><span class="n">localhost</span><span class="w"> </span><span class="n">IDENTIFIED</span><span class="w"> </span><span class="k">BY</span><span class="w"> </span><span class="s1">&#39;StrongPassword&#39;</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="k">GRANT</span><span class="w"> </span><span class="k">ALL</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="w"> </span><span class="k">ON</span><span class="w"> </span><span class="n">nextcloud_db</span><span class="p">.</span><span class="o">*</span><span class="w"> </span><span class="k">TO</span><span class="w"> </span><span class="n">nextclouduser</span><span class="o">@</span><span class="n">localhost</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">FLUSH</span><span class="w"> </span><span class="k">PRIVILEGES</span><span class="p">;</span><span class="w">
</span></span></span><span class="line"><span class="cl"><span class="w"></span><span class="n">quit</span><span class="w">
</span></span></span></code></pre></div><p>
<a href="#image-949474e9c9c8880390f497449ffa2838" class="lightbox-link">
<img src="../at3/at3e5/aws/07_mariadb.png" alt="mariadb" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-949474e9c9c8880390f497449ffa2838">
<img src="../at3/at3e5/aws/07_mariadb.png" alt="mariadb" class="lightbox-image" loading="lazy">
</a></p>
<h2 id="8---php-8">8 - <strong>Php 8</strong></h2>
<p>Ajout du repository php</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">echo</span> <span class="s2">&#34;deb https://packages.sury.org/php/ </span><span class="k">$(</span>lsb_release -sc<span class="k">)</span><span class="s2"> main&#34;</span><span class="se">\ </span><span class="p">|</span> sudo tee /etc/apt/sources.list.d/sury-php.list
</span></span></code></pre></div><p>Télécharger la clé GPG dans le dossier <code>/etc/apt/trusted.gpg</code>.d</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">curl -o /etc/apt/trusted.gpg.d/sury-php8.gpg https://packages.sury.org/php/apt.gpg
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">apt update
</span></span></code></pre></div><p>Installation de php et les bibliothèques nécéssaires :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install -y php php-curl php-cli php-mysql php-gd php-common php-xml php-json php-intl php-pear php-imagick php-dev php-common php-mbstring php-zip php-soap php-bz2 php-bcmath php-gmp php-apcu
</span></span></code></pre></div><p>puis :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install -y libmagickcore-dev
</span></span></code></pre></div><p>Edition du php.ini</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/php/8.0/apache2/
</span></span><span class="line"><span class="cl">nano php.ini
</span></span></code></pre></div><p>Vérifier et modifier si besoin :</p>
<blockquote>
<p>file_uploads = On<br>
allow_url_fopen = On<br>
memory_limit = 512M<br>
upload_max_filesize = 500M<br>
post_max_size = 600M<br>
max_execution_time = 300<br>
display_errors = Off<br>
date.timezone = Europe/Paris<br>
output_buffering = Off<br>
zend_extension=opcache</p>
</blockquote>
<p>puis à la section <code>[OPCACHE]</code></p>
<blockquote>
<p>opcache.enable = 1<br>
opcache.interned_strings_buffer = 8<br>
opcache.max_accelerated_files = 10000<br>
opcache.memory_consumption = 128<br>
opcache.save_comments = 1<br>
opcache.revalidate_freq = 1</p>
</blockquote>
<p>Sauvegarder et redémarrer le service apache2</p>
<h2 id="9---phpmyadmin">9 - <strong>Phpmyadmin</strong></h2>
<p>Installation habituelle de phpmyadmin</p>
<h2 id="10---nextcloud">10 - <strong>Nextcloud</strong></h2>
<ul>
<li>Téléchargement de Nextcloud latest.zip</li>
<li>installation de unzip</li>
<li>Décompression de l&rsquo;archive dans <code>/var/www/nextcloud</code></li>
</ul>
<p>puis</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">chown -R www-data:www-data nextcloud
</span></span></code></pre></div><p>
<a href="#image-31d357d763ebc971e9578b5ee4c7db30" class="lightbox-link">
<img src="../at3/at3e5/aws/10_nextcloud_folder.png" alt="Nextcloud_folder" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-31d357d763ebc971e9578b5ee4c7db30">
<img src="../at3/at3e5/aws/10_nextcloud_folder.png" alt="Nextcloud_folder" class="lightbox-image" loading="lazy">
</a></p>
<p>configuration et activation du site apache</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> /etc/apache2/sites-available/
</span></span><span class="line"><span class="cl">cp site.conf nextcloud.conf
</span></span><span class="line"><span class="cl">nano nextcloud.conf
</span></span></code></pre></div><p>
<a href="#image-4dcbe2ce7aa7330b62107e740d19c80c" class="lightbox-link">
<img src="../at3/at3e5/aws/10_nextcloud.conf.png" alt="Nextcloud.conf" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-4dcbe2ce7aa7330b62107e740d19c80c">
<img src="../at3/at3e5/aws/10_nextcloud.conf.png" alt="Nextcloud.conf" class="lightbox-image" loading="lazy">
</a></p>
<p>désactiver site.conf et activer nextcloud.conf</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">a2dissite site
</span></span><span class="line"><span class="cl">a2ensite nextcloud.conf
</span></span></code></pre></div><p>tester la config et redémarrer le service apache2</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apachectl configtest
</span></span><span class="line"><span class="cl">
</span></span><span class="line"><span class="cl">systemctl restart apache2
</span></span></code></pre></div><p>La page de configuration de Nextcloud doit s&rsquo;afficher dans le navigateur à l&rsquo;URL :</p>
<blockquote>
<p><a href="https://oduhamel.oliduha.fr" target="_blank">https://oduhamel.oliduha.fr</a></p>
</blockquote>
<p>Créer un 1er utilisateur qui sera admin du site avec un mot de passe fort.
Si demandé, le dossier des données se trouve dans</p>
<blockquote>
<p>/var/www/nextcloud/data</p>
</blockquote>
<p>plus bas, indiquer l&rsquo;utilisateur <code>nextclouduser</code> créé précedemment dans mariadb, le PW associé et <code>nextcloud_db</code> pour la BDD ainsi que &rsquo;localhost'</p>
<p>La page renseignée et validée, on se log et on arrive sur l&rsquo;interface de Nextcloud :</p>
<p>
<a href="#image-838d02017e0c04f04bc0712f5775b0d0" class="lightbox-link">
<img src="../at3/at3e5/aws/10_Nextcloud.png" alt="Nextcloud" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-838d02017e0c04f04bc0712f5775b0d0">
<img src="../at3/at3e5/aws/10_Nextcloud.png" alt="Nextcloud" class="lightbox-image" loading="lazy">
</a></p>
<p>Parcourir les options de configurations pour régler plus finement la webapp</p>
<h2 id="11---sauvegarde-automatique-de-la-bdd">11 - <strong>Sauvegarde automatique de la BDD</strong></h2>
<p>Installer zip et créer un dossier pour stocker les sauvegardes</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">apt install zip
</span></span><span class="line"><span class="cl">mkdir /root/backup
</span></span></code></pre></div><p>On crée un script bash dans le dossier /root/ pour automatiser la sauveagarde des fichiers et de la BDD de Nextcloud et on lui donne les droits d&rsquo;exécution</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="nb">cd</span> root
</span></span><span class="line"><span class="cl">touch backup.sh
</span></span><span class="line"><span class="cl">chmod +x backup.sh
</span></span></code></pre></div><p>Puis on l&rsquo;édite avec :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">nano backup.sh
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="cp">#!/bin/bash
</span></span></span><span class="line"><span class="cl"><span class="cp"></span><span class="c1"># script de sauvegarde de la BDD nextcloud</span>
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> Compression des fichiers...
</span></span><span class="line"><span class="cl">zip -rq /root/backup/<span class="k">$(</span>date +%Y%m%d%H%M<span class="k">)</span>_nextcloud_backup_files.zip /var/www/nextcloud
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> Dump de la BDD...
</span></span><span class="line"><span class="cl">mysqldump -u root -p <span class="s1">&#39;1nfr@2022NG&#39;</span> --database nextcloud_db &gt; /root/backup/nextcloud_backup_bdd.sql
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> Compression de la BDD...
</span></span><span class="line"><span class="cl">zip -q /root/backup/<span class="k">$(</span>date +%Y%m%d%H%M<span class="k">)</span>_nextcloud_backup_bdd.zip /root/backup/nextcloud_backup_bdd.sql
</span></span><span class="line"><span class="cl">rm /root/backup/nextcloud_backup_bdd.sql
</span></span><span class="line"><span class="cl"><span class="nb">echo</span> Terminé !
</span></span></code></pre></div><p>On automatise ensuite l&rsquo;exécution de ce script via crontab pour faire une sauvegarde chaque vendredi soir.</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl">crontab -e
</span></span></code></pre></div><p>et on y ajoute :</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-bash" data-lang="bash"><span class="line"><span class="cl"><span class="m">0</span> <span class="m">23</span> * * <span class="m">5</span> /root/backup.sh
</span></span></code></pre></div><h2 id="12---fail2ban">12 - <strong>Fail2ban</strong></h2>
<p>
<a href="#image-3d46b0fc6a731f568d6076b9c9c5877e" class="lightbox-link">
<img src="../at3/at3e5/aws/12_fail2ban.png" alt="fail2ban" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-3d46b0fc6a731f568d6076b9c9c5877e">
<img src="../at3/at3e5/aws/12_fail2ban.png" alt="fail2ban" class="lightbox-image" loading="lazy">
</a></p>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          <article class="chapter">
<div class="article-subheading">Chapitre 6</div>
<h1 id="assurer-sa-veille-technologique">Assurer sa veille technologique</h1>

<hr>
<h4 id="1-feedlyat3at3e6feedly">1. <a href="../at3/at3e6/feedly/">Feedly</a></h4>
<hr>

            <footer class="footline">
            </footer>
          </article>

          <section>
            <h1 class="a11y-only">Sous-sections de Assurer sa veille technologique</h1>
          <article class="chapter">
<div class="article-subheading">Exemple 1</div>
<h1 id="feedly">Feedly</h1>

<h2 id="agrégation-rss-avec-feedly">Agrégation RSS avec Feedly</h2>
<p><a href="https://feedly.com" target="_blank">Feedly</a> permet de s&rsquo;abonner aux flux RSS de tout site web dont on souhaite suivre l&rsquo;actualité, ce qui en fait un outil efficace pour effectuer sa veille technologique.</p>
<p>Personnellement je suis abonné aux flux suivants répartis en 3 catégories (limite d&rsquo;un compte gratuit) :</p>
<ul>
<li>Cybersecurité :
<ul>
<li><a href="https://www.lemondeinformatique.fr/" target="_blank">Le Monde Informatique - Actualités</a></li>
<li><a href="https://www.cert.ssi.gouv.fr/" target="_blank">CERT-FR</a></li>
<li><a href="https://attack.mitre.org/" target="_blank">Mitre ATT&amp;CK</a></li>
<li><a href="https://nvd.nist.gov/" target="_blank">NIST - National Vulnerability Database</a></li>
<li><a href="https://www.tenable.com/" target="_blank">Newest CVEs from Tenable</a></li>
<li><a href="https://www.01net.com/" target="_blank">01.net - Sécurité</a></li>
<li><a href="https://www.lemonde.fr/" target="_blank">Le Monde - Sécurité Informatique</a></li>
<li><a href="https://www.zataz.com/" target="_blank">zataz</a></li>
</ul>
</li>
<li>Developpement :
<ul>
<li><a href="https://www.developpez.com/" target="_blank">developpez.com</a></li>
<li><a href="https://www.programmez.com/" target="_blank">programmez.com</a></li>
</ul>
</li>
<li>Divers IT :
<ul>
<li><a href="https://www.01net.com/" target="_blank">01.net - Actus</a></li>
<li><a href="https://www.bortzmeyer.org/" target="_blank">Blog de Stephane Bortzmeyer</a></li>
<li><a href="https://distrowatch.com/" target="_blank">DistroWatch</a></li>
<li><a href="https://www.it-connect.fr/" target="_blank">IT-Connect</a></li>
<li><a href="https://www.itespresso.fr/" target="_blank">ITespresso.fr</a></li>
<li><a href="https://www.journaldugeek.com/" target="_blank">Journal du Geek</a></li>
<li><a href="https://www.laquadrature.net/" target="_blank">La Quadrature du Net</a></li>
<li><a href="https://www.lemagit.fr/" target="_blank">LeMagIT</a></li>
<li><a href="https://www.lesnumeriques.com/" target="_blank">Les Numériques - Actualités</a></li>
<li><a href="https://linuxfr.org/" target="_blank">LinuxFr.org</a></li>
<li><a href="https://www.silicon.fr/" target="_blank">Silicon</a></li>
<li><a href="https://www.lemondeinformatique.fr/" target="_blank">Le Monde Informatique - Toutes les actualités</a></li>
<li><a href="https://www.zdnet.fr/" target="_blank">ZDNet Actualités</a></li>
<li><a href="https://zythom-en.blogspot.com/" target="_blank">Zythom</a></li>
</ul>
</li>
</ul>
<p>Feedly sur mon smartphone Android

<a href="#image-927e7e87f00e08927e57a54ba10baf46" class="lightbox-link">
<img src="../at3/at3e6/feedly/feedly_android.jpg" alt="Feedly Android" style="height: auto; width: auto;" loading="lazy">
</a>
<a href="javascript:history.back();" class="lightbox" id="image-927e7e87f00e08927e57a54ba10baf46">
<img src="../at3/at3e6/feedly/feedly_android.jpg" alt="Feedly Android" class="lightbox-image" loading="lazy">
</a></p>
<hr>
<h2 id="newsletters">Newsletters</h2>
<p>De plus, dans le cadre de ma veille technologique, je suis abonné à diverses newsletters telles que <a href="https://www.codeproject.com" target="_blank">CodeProject</a> ou encore <a href="https://itacademy.brightspace.com" target="_blank">VMware IT Academy</a>.</p>
<hr>

            <footer class="footline">
            </footer>
          </article>

          </section>
          </section>        </div>
      </main>
    </div>
    <script src="../js/clipboard.min.js" defer></script>
    <script src="../js/perfect-scrollbar.min.js" defer></script>
    <script src="../js/theme.js" defer></script>
  </body>
</html>
